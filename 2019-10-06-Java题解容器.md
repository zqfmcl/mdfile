---
title: Java题解容器
date: 2019-10-06 10:00:00
tags: 题解
 
---

## 第十七章  容器

public class Ex11 {

​       public static void main(String[] args) {

​              int[] ia = new int[2];

​              ia[0] = new Integer(1);              ia[0] = new Integer(2);                           println(ia.getClass().getName());

​              Integer[] Ia = new Integer[2];

​              Ia[0] = (int)1;              Ia[1] = (int)2;                           println(Ia.getClass().getName());

​              println(Ia[0] instanceof Integer);

​              for(int i = 0; i < Ia.length; i++)

​                     System.out.println(Ia[i].getClass().getName());

​                                        Ia[0] = (int)ia[0];          println(Ia[0].getClass().getName());             

​       }

}

 

public class Ex12 {

​       public static void main(String[] args) {

​              double[] da = new double[10];

​              CountingGenerator.Double dGen = 

​                     new CountingGenerator.Double();

​              for(int i = 0; i < da.length; i++)

​                     da[i] = dGen.next();

​              System.out.println(Arrays.toString(da));     

​       }

}

 

public class Ex13 {

​       public static String fillString(int len) {

​              CountingGenerator.Character cg = new CountingGenerator.Character();

​              char[] ca = new char[len];

​              for(int i = 0; i < len; i++)

​                     ca[i] = cg.next();

​              return new String(ca);          

​       }

​       public static void main(String[] args) {

​              System.out.println(fillString(7));

​              System.out.println(fillString(10));

​       }

}

 

 

public class Ex14 {

​       public static void showCharArray(int len) {

​              CountingGenerator.Character cg = new CountingGenerator.Character();

​              char[] ca = new char[len];

​              for(int i = 0; i < len; i++)

​                     ca[i] = cg.next();

​              System.out.println(Arrays.toString(ca));      

​       }

​       public static void showByteArray(int len) {

​              CountingGenerator.Byte bg = new CountingGenerator.Byte();

​              byte[] ba = new byte[len];

​              for(int i = 0; i < len; i++)

​                     ba[i] = bg.next();

​              System.out.println(Arrays.toString(ba));

​       }

​       public static void showIntArray(int len) {

​              CountingGenerator.Integer ig = new CountingGenerator.Integer();

​              int[] ia = new int[len];

​              for(int i = 0; i < len; i++)

​                     ia[i] = ig.next();

​              System.out.println(Arrays.toString(ia));

​       }

​       public static void showLongArray(int len) {

​              CountingGenerator.Long lg = new CountingGenerator.Long();

​              long[] la = new long[len];

​              for(int i = 0; i < len; i++)

​                     la[i] = lg.next();

​              System.out.println(Arrays.toString(la));

​       }

​       public static void showFloatArray(int len) {

​              CountingGenerator.Float fg = new CountingGenerator.Float();

​              float[] fa = new float[len];

​              for(int i = 0; i < len; i++)

​                     fa[i] = fg.next();

​              System.out.println(Arrays.toString(fa));

​       }

​       public static void showDoubleArray(int len) {

​              CountingGenerator.Double dg = new CountingGenerator.Double();

​              double[] da = new double[len];

​              for(int i = 0; i < len; i++)

​                     da[i] = dg.next();

​              System.out.println(Arrays.toString(da));

​       }

​       public static void main(String[] args) {

​              showCharArray(10);

​              showByteArray(10);

​              showIntArray(10);

​              showLongArray(10);

​              showFloatArray(10);

​              showDoubleArray(10);

​       }

}

 

class BerylliumSphereGenerator implements Generator<BerylliumSphere> {

​       public BerylliumSphere next() {

​              return new BerylliumSphere();

​       }             

}

 

public class ContainerComparison15 {

​       public static void main(String[] args) {

​              BerylliumSphere[] spheres = new BerylliumSphere[5];

​              BerylliumSphereGenerator bsg = new BerylliumSphereGenerator();

​              Generated.array(spheres, bsg);

​              print(Arrays.toString(spheres));

​              print(spheres[4]);

​              List<BerylliumSphere> sphereList =

​                     new ArrayList<BerylliumSphere>();

​              for(int i = 0; i < 5; i++)

​                     sphereList.add(bsg.next());

​              print(sphereList);

​              print(sphereList.get(4));

​       }

}

 

public class TestArrayGeneration16 {

​       public static void main(String[] args) {

​              int size = 6;

​              int skip = 7;

​              boolean[] a1 = ConvertTo.primitive(Generated16.array(

​                     new Boolean[size], new SkipGenerator16.Boolean(skip), skip));

​              print("a1 = " + Arrays.toString(a1));

​              byte[] a2 = ConvertTo.primitive(Generated16.array(

​                     new Byte[size], new SkipGenerator16.Byte(skip), skip));

​              print("a2 = " + Arrays.toString(a2));

​              char[] a3 = ConvertTo.primitive(Generated16.array(

​                     new Character[size], new SkipGenerator16.Character(skip), skip));

​              print("a3 = " + Arrays.toString(a3));

​              short[] a4 = ConvertTo.primitive(Generated16.array(

​                     new Short[size], new SkipGenerator16.Short(skip), skip));

​              print("a4 = " + Arrays.toString(a4));

​              int[] a5 = ConvertTo.primitive(Generated16.array(

​                     new Integer[size], new SkipGenerator16.Integer(skip), skip));

​              print("a5 = " + Arrays.toString(a5));

​              long[] a6 = ConvertTo.primitive(Generated16.array(

​                     new Long[size], new SkipGenerator16.Long(skip), skip));

​              print("a6 = " + Arrays.toString(a6));

​              float[] a7 = ConvertTo.primitive(Generated16.array(

​                     new Float[size], new SkipGenerator16.Float(skip), skip));

​              print("a7 = " + Arrays.toString(a7));

​              double[] a8 = ConvertTo.primitive(Generated16.array(

​                     new Double[size], new SkipGenerator16.Double(skip), skip));

​              print("a8 = " + Arrays.toString(a8));

​       }

}

 

 

 import net.mindview.util.*;

 

interface SkipGenerator<T> extends net.mindview.util.Generator<T> { 

​       T next();  

​       T next(int n); 

}

 

public class SkipGenerator16 {

  public static class

  Boolean implements SkipGenerator<java.lang.Boolean> {  

​    private boolean value = false;

​       private int n;

​       Boolean(int n) { this.n = n; }

​       public java.lang.Boolean next() { return !value; }

​    public java.lang.Boolean next(int n) {

​           value = n % 2 == 0 ? true : false;

​       return value;

​    }

  }

  public static class

  Byte implements SkipGenerator<java.lang.Byte> {

​    private byte value = 0;

​       private int n;

​       Byte(int n) { this.n = n; }

​       public java.lang.Byte next() { return value++; }

​    public java.lang.Byte next(int n) { return value += n; }

  }

  static char[] chars = ("abcdefghijklmnopqrstuvwxyz" +

​    "ABCDEFGHIJKLMNOPQRSTUVWXYZ").toCharArray();

  public static class

  Character implements SkipGenerator<java.lang.Character> {

​    int index = -1;

​       private int n;

​       Character() { int index = -1; }

​       Character(int n) { this.n = n; }

​       public java.lang.Character next() {

​      index = (index + 1) % chars.length;

​      return chars[index];

​    }

​    public java.lang.Character next(int n) {

​      index = (index + 1 + n) % chars.length;

​      return chars[index];

​    }

  }

  public static class

  String implements SkipGenerator<java.lang.String> {

​    private int length = 7;

​    SkipGenerator<java.lang.Character> cg = new Character();

​    public String() {}

​    public String(int length) { this.length = length; }

​    public java.lang.String next() {

​      char[] buf = new char[length];

​      for(int i = 0; i < length; i++)

​        buf[i] = cg.next();

​      return new java.lang.String(buf);

​    }

​       public java.lang.String next(int n) {

​              char[] buf = new char[length];

​              for(int i = 0; i < length; i++)

​                     buf[i] = cg.next(n);

​              return new java.lang.String(buf);

​       }

  }

  public static class

  Short implements SkipGenerator<java.lang.Short> {

​    private short value = 0;

​       private int n;

​       Short(int n) { this.n = n; }

​       public java.lang.Short next() { return value++; }

​    public java.lang.Short next(int n) { return value += n; }

  }

  public static class

  Integer implements SkipGenerator<java.lang.Integer> {

​    private int value = 0;

​       private int n;

​       Integer(int n) { this.n = n; }

​       public java.lang.Integer next() { return value++; }

​    public java.lang.Integer next(int n) { return value += n; }

  }

  public static class

  Long implements SkipGenerator<java.lang.Long> {

​    private long value = 0;

​       private int n;

​       Long(int n) { this.n = n; }

​       public java.lang.Long next() { return value++; }

​    public java.lang.Long next(int n) { return value += n; }

  }

  public static class

  Float implements SkipGenerator<java.lang.Float> {

​    private float value = 0;

​       private int n;

​       Float(int n) { this.n = n; }

​       public java.lang.Float next() {

​             float result = value;

​                 value += 1.0;

​                 return result;

​       }

​    public java.lang.Float next(int n) {

​      float result = value;

​      value += (1.0 * n);

​      return result;

​    }

  }

  public static class

  Double implements SkipGenerator<java.lang.Double> {

​    private double value = 0.0;

​       private int n;

​       Double(int n) { this.n = n; }

​       public java.lang.Double next() {

​      double result = value;

​      value += 1.0;

​      return result;

​    }

​    public java.lang.Double next(int n) {

​      double result = value;

​      value += (1.0 * n);

​      return result;

​    }

  }

} 

 

public class Generated16 {

​      public static <T> T[] array(T[] a, SkipGenerator<T> gen, int skip) {

​    return new CollectionData16<T>(gen, skip, a.length).toArray(a);

  }

} 

 

class CollectionData16<T> extends ArrayList<T> {

  public CollectionData16(SkipGenerator<T> gen, int skip, int quantity) {

​    for(int i = 0; i < quantity; i++)

​      add(gen.next(skip));

  }

}

 

class BigDecimalGenerator implements Generator<BigDecimal> {

​       private BigDecimal bd = new BigDecimal(0.0);

​       public BigDecimal next() {

​              return bd = bd.add(new BigDecimal(1.0));

​       }

}

 

public class Ex17 {

​       public static void main(String[] args) {

​              BigDecimal[] bda1 = new BigDecimal[4];

​              Generated.array(bda1, new BigDecimalGenerator());

​              System.out.println(Arrays.toString(bda1));

​              BigDecimal[] bda2 = Generated.array(

​                     BigDecimal.class, new BigDecimalGenerator(), 5);

​              System.out.println(Arrays.toString(bda2));

​       }

}

 

 

public class Ex18 {

​       public static void main(String[] args) {

​              BerylliumSphere[] bsa1 = new BerylliumSphere[3];

​              for(int i = 0; i < bsa1.length; i++)

​                     bsa1[i] = new BerylliumSphere();

​                           System.out.println(Arrays.toString(bsa1));

​              BerylliumSphere[] bsa2 = new BerylliumSphere[4];

​              System.out.println(Arrays.toString(bsa2));

​              System.arraycopy(bsa1, 0, bsa2, 0, bsa1.length);

​              System.out.println(Arrays.toString(bsa2));

​                                 }

}

 

 

class A {

​       protected int x;

​       A(int x) { this.x = x; }

​       public boolean equals(Object b) {

​              return (b.getClass().getSimpleName() == "A" 

​                     && this.x == ((A)b).x) ? true : false;

​       }

}

 

public class Ex19 {

​       public static void main(String[] args) {

​              A[] a1 = { new A(1), new A(2), new A(3) };

​              A[] a2 = { new A(1), new A(2), new A(3) };

​              print(Arrays.toString(a1));

​              print(Arrays.toString(a2));

​              print(Arrays.equals(a1, a2));

​       }

}

 

 

 

class A {}

 

public class Ex20 {

​       public static void main(String[] args) {

​              int[][][] a1 = new int[4][3][2];

​              int[][][] a2 = new int[4][3][2];

​              print(Arrays.deepToString(a1));

​              print(Arrays.deepEquals(a1, a2));

​              A[][][] aa1 = new A[4][3][2];

​              A[][][] aa2 = new A[4][3][2];

​              print(Arrays.deepToString(aa1));

​              print(Arrays.deepEquals(aa1, aa2));

​              print(Arrays.deepEquals(a1, aa1));      

​       }

}

 

class CompBerylliumSphere 

​       implements Comparable<CompBerylliumSphere> {

​       private static long count;

​       protected final long id = count++;

​       public int compareTo(CompBerylliumSphere c2) {

​              return (this.id < c2.id ? -1 : (this.id == c2.id ? 0 : 1));

​       }

​       

​       public String toString() {

​              return "BerylliumSphere " + id;

​       }

}

 

class CompBerylliumSphereComparator 

​       implements Comparator<CompBerylliumSphere> {

​       public int compare(CompBerylliumSphere c1, CompBerylliumSphere c2) {

​              return (c1.id > c2.id ? -1 : (c1.id == c2.id ? 0 : 1));

​       }

}

 

public class Ex21 {       

​       public static void main(String[] args) {

​              BerylliumSphere[] bsa = new BerylliumSphere[5];

​              for(int i = 0; i < bsa.length; i++)

​                     bsa[i] = new BerylliumSphere();         

​                           CompBerylliumSphere[] cbsa = new CompBerylliumSphere[5];

​              for(int i = 0; i < cbsa.length; i++)

​                     cbsa[i] = new CompBerylliumSphere();

​              print("unsorted:");

​              print(Arrays.toString(cbsa));

​              Arrays.sort(cbsa);

​              print("sorted:");

​              print(Arrays.toString(cbsa));

​              Arrays.sort(cbsa, new CompBerylliumSphereComparator());

​              print("reverse sorted:");

​              print(Arrays.toString(cbsa)); 

​       }

}

 

public class Ex22 {

​       private static Random r = new Random();

​       public static void main(String[] args) {

​              int[] ia = ConvertTo.primitive(Generated.array(new Integer[20],

​                     new RandomGenerator.Integer(10)));

​              System.out.println(Arrays.toString(ia));

​              for(int i = 0; i < 10; i++) {

​                     int index = Arrays.binarySearch(ia, i);

​                     if(index < 0) System.out.println(i + " not found");

​                     else

​                     System.out.println("Index: " + index + ", " + i);

​              }

​              System.out.println("sort");

​              Arrays.sort(ia);

​              System.out.println(Arrays.toString(ia));

​              for(int i = 0; i < 10; i++) {

​                     int index = Arrays.binarySearch(ia, i);

​                     if(index < 0) System.out.println(i + " not found");

​                     else

​                     System.out.println("Index: " + index + ", " + i);

​              }             

​       }

}

 

public class Ex23 {

​       private static Random r = new Random();

​       public static void main(String[] args) {

​              Integer[] ia = Generated.array(new Integer[20],

​                     new RandomGenerator.Integer(10));

​              System.out.println(Arrays.toString(ia));

​              System.out.println("sort");

​              Arrays.sort(ia, Collections.reverseOrder());

​              System.out.println(Arrays.toString(ia));

​       }

}

 

class A implements Comparable<A> {

​       protected int x;

​       A(int x) { this.x = x; }

​       public int compareTo(A b) {

​              return (this.x < b.x ? -1 : (this.x == b.x ? 0 : 1));

​       }

​       public boolean equals(Object b) {

​              return (b.getClass().getSimpleName() == "A" 

​                     && this.x == ((A)b).x) ? true : false;

​       }

}

 

public class Ex24 {

​       public static void main(String[] args) {

​              A[] a = { new A(1), new A(2), new A(3), new A(4), new A(5) };

​              System.out.println(Arrays.toString(a));

​              Arrays.sort(a);

​              int index = Arrays.binarySearch(a, new A(3));

​              System.out.println("Index: " + index + ", " + a[index]);

​       }

}

 

class MyList extends ArrayList<T> {

​       List myList = new ArrayList();

​       MyList(List l) { myList = l; }

​       @SuppressWarnings("unchecked")

​       MyList getReversed() {

​              ListIterator lit = myList.listIterator(myList.size());

​              List reverseMyList = new ArrayList();

​              while(lit.hasPrevious()) {

​                     reverseMyList.add(lit.previous());

​              }

​              return new MyList(reverseMyList);

​       }

}

 

public class Ex25 {

​       public static void main(String[] args) {

​              List<Integer> aList = 

​                     new ArrayList<Integer>(Arrays.asList(1,2,3,4,5));

​              print(aList);

​              print(aList.get(4));

​              aList.add(new Integer(6));

​              aList.addAll(new ArrayList<Integer>(Arrays.asList(7,8)));

​              print(aList);

​              print(aList.subList(2,4));

​              MyList ml = new MyList(aList);

​              print((ml.getReversed()).myList);

​       }

}

public class Ex1 {

​       public static void main(String[] args) {

​              List<String> al = new ArrayList<String>();

​              List<String> ll = new LinkedList<String>();

​              for(int i = 0; i < Countries.DATA.length; i++) {

​                     al.add(Countries.DATA[i][0]);

​                     ll.add(Countries.DATA[i][1]);

​              }

​              Collections.sort(al);

​              Collections.sort(ll);

​              println("Countries: " + al);

​              println("Capitals: " + ll);

​              for(int i = 0; i < 2; i++) {

​                     Collections.shuffle(al);

​                     Collections.shuffle(ll);

​                     println("Countries " + i + ": " + al);

​                     println("Capitals " + i + ": " + ll);

​              }

​              List<String> al2 = new ArrayList<String>();

​              List<String> ll2 = new LinkedList<String>();

​              for(int i = 0; i < 10; i++) {

​                     al2.add(Countries.DATA[i][0]);

​                     ll2.add(Countries.DATA[i][1]);

​              }

​              for(int i = 0; i < 5; i++) {

​                     Collections.shuffle(al2);

​                     Collections.shuffle(ll2);

​                     println("Countries " + i + ": " + al2);

​                     println("Capitals " + i + ": " + ll2);

​                     Collections.sort(al2);

​                     Collections.sort(ll2);

​              }

​       }

}

 

public class Ex2 {

​       public static void main(String[] args) {

​              Map<String,String> hm = new HashMap<String,String>();

​              Set<String> hs = hm.keySet();

​              Pattern p = Pattern.compile("A[a-zA-Z]*");

​              for(int i = 0; i < Countries.DATA.length; i++) {

​                     if(p.matcher(Countries.DATA[i][0]).matches())

​                            hm.put(Countries.DATA[i][0], Countries.DATA[i][1]);

​              }

​              println(hm);    

​              println(hs);     

​       }

}

 

public class Ex3 {

​       public static void main(String[] args) {

​              Set<String> hs = new HashSet<String>();

​              Set<String> lhs = new LinkedHashSet<String>();

​              Set<String> ts = new TreeSet<String>();

​              println("HashSet hs = " + hs);

​              println("LinkedHashSet lhs = " + lhs);

​              println("TreeSet ts = " + ts);

​              Map<String,String> hm = new HashMap<String,String>(0);

​              Pattern p = Pattern.compile("Z[a-zA-Z]*");

​              for(int i = 0; i < Countries.DATA.length; i++) {

​                     if(p.matcher(Countries.DATA[i][0]).matches())

​                     hm.put(Countries.DATA[i][0], Countries.DATA[i][0]);

​              }

​              println("hm.keySet() = " + hm.keySet());

​              println("Adding hm.keySet()");

​              hs.addAll(hm.keySet());

​              lhs.addAll(hm.keySet());

​              ts.addAll(hm.keySet());

​              println("hs: " + hs);

​              println("lhs: " + lhs);

​              println("ts: " + ts);

​              println("Adding 10 more times");

​              for(int i = 0; i < 10; i++) {

​                     hs.addAll(hm.keySet());

​                     lhs.addAll(hm.keySet());

​                     ts.addAll(hm.keySet());

​              }

​              println("hs: " + hs);

​              println("lhs: " + lhs);

​              println("ts: " + ts);                       

​       }

}

  

public class Ex4 {

​       static Collection<String> CollectFromText(String fileName) {        

​              String[] sa = TextFile.read(fileName).split(" ");

​              return Arrays.asList(sa);

​       }

​       static Collection<String> CollectFromText2(String fileName) {              

​              String[] sa = TextFile.read(fileName).split(" ");

​              return new TreeSet<String>(new TextFile(fileName, "\\W+"));

​       }

​       public static void main(String[] args) {

​              println(CollectFromText("Ex4.java"));

​              println(CollectFromText2("Ex4.java"));

​       }

}

 

public class CountingMapData5 extends AbstractMap<Integer,String> {     

​      private static String[] chars =

​                  "A B C D E F G H I J K L M N O P Q R S T U V W X Y Z"

​                  .split(" ");

​       static class Entry implements Map.Entry<Integer,String> {

​                  int index;

​                  Entry(int index) { this.index = index; }

​                  public boolean equals(Object o) {

​                        return Integer.valueOf(index).equals(o);

​                  }

​                  public Integer getKey() { return index; }

​                  public String getValue() {

​                     return chars[index % chars.length] +

​                             Integer.toString(index                   }

​                  public String setValue(String value) {

​                        throw new UnsupportedOperationException();

​                  }

​                  public int hashCode() {

​                        return Integer.valueOf(index).hashCode();

​                  }

​      }

​                 static class EntrySet extends AbstractSet<Map.Entry<Integer,String>> {

​              private int size;

​                 EntrySet(int size) {

​                     if(size < 0) this.size = 0;

​                     else this.size = size;

​               }

​              public int size() { return size; }

​              private class Iter implements Iterator<Map.Entry<Integer,String>> {

​                                           private Entry entry = new Entry(-1);

​                      public boolean hasNext() {

​                            return entry.index < size - 1;

​                      }

​                      public Map.Entry<Integer,String> next() {

​                            entry.index++;

​                            return entry;

​                      }

​                      public void remove() {

​                            throw new UnsupportedOperationException();

​                      }

​                 }

​                 public Iterator<Map.Entry<Integer,String>> iterator() {

​                     return new Iter();

​                 }                    

​       }

​       private static Set<Map.Entry<Integer,String>> entries = 

​              new EntrySet(chars.length);

​       public Set<Map.Entry<Integer,String>> entrySet() { return entries; }

​       static Map<Integer,String> select(final int size) {

​                  return new CountingMapData5() {

​                        public Set<Map.Entry<Integer,String>> entrySet() {

​                             return new EntrySet(size);

​                        }

​                  };

​      }      

​       public static void main(String[] args) {

​              println(new CountingMapData5());

​              println(select(10));

​       }

} 

 

public class Unsupported6 {

​       static void test(String msg, List<String> list) {

​              System.out.println("--- " + msg + " ---");

​              Collection<String> c = list;

​              Collection<String> subList = list.subList(1,8);

​                           Collection<String> c2 = new ArrayList<String>(subList);

​              try { c.retainAll(c2); } catch(Exception e) {

​                     println("retainAll(): " + e);

​              }

​              try { c.removeAll(c2); } catch(Exception e) {

​                     println("removeAll(): " + e);

​              }

​              try { c.clear(); } catch(Exception e) {

​                     println("clear(): " + e);

​              }              

​              try { c.add("X"); } catch(Exception e) {

​                     println("add(): " + e);

​              }

​              try { c.addAll(c2); } catch(Exception e) {

​                     println("addAll(): " + e);

​              }

​              try { c.remove("C"); } catch(Exception e) {

​                     println("remove(): " + e);

​              }

​                                        try {

​                     list.set(0, "X");

​              } catch(Exception e) {

​                     println("List.set(): " + e);

​              }

​                           try { list.add(0, "X"); } catch(Exception e) {

​                     println("List.add(): " + e);

​              }

​              try { list.addAll(0, c2); } catch(Exception e) {

​                     println("List.addAll(): " + e);

​              }

​              try { list.remove(0); } catch(Exception e) {

​                     println("List.remove(): " + e);

​              }

​              try { list.removeAll(c2); } catch(Exception e) {

​                     println("List.removeAll(): " + e);

​              }

​              try { list.retainAll(c2); } catch(Exception e) {

​                     println("List.retainAll(): " + e);

​              }                    

​       }

​       public static void main(String[] args) {

​              List<String> list = 

​                     Arrays.asList("A B C D E F G H I J K L".split(" "));

​              test("Modifiabe Copy", new ArrayList<String>(list));

​              test("Arrays.asList()", list);

​              test("unmodifiableLlist()", 

​                     Collections.unmodifiableList(new ArrayList<String>(list)));

​       }

}

 

public class Ex7 {   

​       @SuppressWarnings("unchecked")    

​       public static void main(String[] args) {

​              List<String> al = new ArrayList<String>(Countries.names(25));

​              List<String> ll = new LinkedList<String>(Countries.names(25));

​              print(al);

​              print(ll);          

​              Iterator alit = al.iterator();

​              Iterator llit = ll.iterator();

​              while(alit.hasNext()) {

​                     printnb(alit.next() + (alit.hasNext() ? ", " : ""));

​              }

​              print();

​              while(llit.hasNext()) {

​                     printnb(llit.next() + (llit.hasNext() ? ", " : ""));

​              }

​              print();

​              print();

​              ListIterator allit = al.listIterator();

​              ListIterator lllit = ll.listIterator();           

​              while(lllit.hasNext()) {                  

​                     allit.add((String)lllit.next());

​                     allit.next();

​              }

​              print(al);

​              print();

​              List<String> al2 = new ArrayList<String>(Countries.names(25));

​              ListIterator allit2 = al2.listIterator();

​              while(lllit.hasPrevious()) lllit.previous();

​              while(allit2.hasNext()) allit2.next();

​              while(lllit.hasNext()) {

​                     allit2.add((String)lllit.next());

​                     allit2.previous();

​                     allit2.previous();

​              }

​              print(al2);

​       }

}

 

class SList<E> {

​       private Link<E> headLink = new Link<E>(null);

​       SListIterator<E> iterator() { return new SListIterator<E>(headLink); }

​       public String toString() { 

​              if(headLink.next == null) return "SList: []";

​              print("SList: [");

​              SListIterator<E> it = this.iterator();

​              StringBuilder s = new StringBuilder(); 

​              while(it.hasNext()) {

​                     s.append(it.next() + (it.hasNext() ? ", " : ""));

​              }

​              return s + "]";

​       }             

}

 

class SListIterator<E> {

​       Link<E> current;

​       SListIterator(Link<E> link) {

​              current = link;

​       }

​       public boolean hasNext() {

​              return current.next != null;

​       }

​       public Link<E> next() {

​              current = current.next;

​              return current;

​       }

​       public void insert(E e) {

​              current.next = new Link<E>(e, current.next);

​              current = current.next;

​       }      

​       public void remove() {

​              if(current.next != null) {

​                     current.next = current.next.next;

​              }

​       }

}

 

class Link<E> {

​       E e;

​       Link<E> next;

​       Link(E e, Link<E> next) { 

​              this.e = e;

​              this.next = next; 

​       }

​       Link(E e) {

​              this(e, null);

​       }     

​       public String toString() {

​              if(e == null) return "null";

​              return e.toString();

​       }

}

 

public class Ex8 {

​       public static void main(String[] args) {

​              SList<String> sl = new SList<String>();

​              println(sl);

​              SListIterator<String> slIter = sl.iterator();

​              println("inserting \"hi\"");

​              slIter.insert("hi");

​              println(sl);

​              println("inserting \"there\"");

​              slIter.insert("there");

​              println(sl);

​              println("inserting \"sweetie\"");

​              slIter.insert("sweetie");

​              println(sl);

​              println("inserting \"pie\"");

​              slIter.insert("pie");

​              println(sl);

​              SListIterator<String> slIter2 = sl.iterator();

​              println("removing \"hi\"");

​              slIter2.remove();

​              println(sl);

​              println("inserting \"hello\"");

​              slIter2.insert("hello");

​              println(sl);

​              println("removing \"there\"");

​              slIter2.remove();

​              println(sl);

​              println("removing \"sweetie\"");

​              slIter2.remove();

​              println(sl);

​              println("removing \"pie\"");

​              slIter2.remove();

​              println(sl);

​              println("removing \"hello\"");

​              SListIterator slIter3 = sl.iterator();

​              slIter3.remove();

​              println(sl);             

​       }

}

 

public class Ex9 {

​       public static void main(String[] args) {

​              TreeSet<String> ts = 

​              new TreeSet<String>(String.CASE_INSENSITIVE_ORDER);

​              RandomGenerator.String rgs = 

​                     new RandomGenerator.String(5);

​              for(int i = 0; i < 20; i++) {

​                     ts.add(rgs.next());

​              }

​              print(ts);

​       }

}

 

 

 

 

​    import java.util.*;

import static net.mindview.util.Print.*;

 

class SortedSet10<E> extends LinkedList<E> {

​       int compare(E e1, E e2) {

​              int c = e1.hashCode() - e2.hashCode();

​              return (c < 0) ? -1 : ((c == 0) ? 0 : 1);

​       }

​       public boolean add(E e) {

​              if(!this.contains(e)) {

​                     Iterator<E> it = this.iterator();

​                     int index = 0;

​                     while(it.hasNext()) {

​                            if(compare(it.next(), e) < 1) 

​                                   index++;

​                     }

​                     add(index, e);

​                     return true;

​              }

​              return false;

​       }

}

 

class T {}

 

public class Ex10 {

​       public static void main(String[] args) {

​              SortedSet10<T> ss = new SortedSet10<T>();

​              ss.add(new T());

​              ss.add(new T());

​              ss.add(new T());     

​              ss.add(new T());

​              print(ss);

​              SortedSet10<Integer> ss2 = new SortedSet10<Integer>();

​              ss2.add(6);

​              ss2.add(8);

​              ss2.add(2);

​              ss2.add(4);

​              ss2.add(2);

​              ss2.add(8);

​              print(ss2);

​              SortedSet10<String> ss3 = new SortedSet10<String>();

​              ss3.add("three");

​              ss3.add("three");

​              ss3.add("seven");

​              ss3.add("hi");

​              ss3.add("two");

​              ss3.add("one");

​              print(ss3);

​       }

 

class IntegerTest implements Comparable<IntegerTest> {

​       Random r = new Random();

​       Integer i = r.nextInt(100);

​       public int compareTo(IntegerTest arg) {

​              int d = this.i - arg.i;

​              return d < 0 ? -1 : d == 0 ? 0 : 1;

​       }

​       public String toString() {

​              return Integer.toString(i);

​       }

}

 

public class Ex11 {

​       public static void main(String[] args) {

​              PriorityQueue<IntegerTest> pt = 

​              new PriorityQueue<IntegerTest>();

​              for(int i = 0; i < 20; i++) {

​                     pt.add(new IntegerTest());

​              }

​              int size = pt.size();

​              for(int i = 0; i < size; i++) {

​                     System.out.print(pt.poll() + " ");

​              }

​       }

} 

 

public class Ex12<K,V> {

​       private Object[][] pairs;

​       private int index;   

​       public Ex12(int length) {

​              pairs = new Object[length][2];

​       }

​       public void put(K key, V value) {

​              if(index >= pairs.length)

​                     throw new ArrayIndexOutOfBoundsException();

​              pairs[index++] = new Object[] { key, value };

​       }

​       @SuppressWarnings("unchecked")

​       public V get(K key) {

​              for(int i = 0; i < index; i++)

​                     if(key.equals(pairs[i][0]))

​                            return (V)pairs[i][1];

​              return null;   }

​       public String toString() {

​              StringBuilder result = new StringBuilder();

​              for(int i = 0; i < index; i++) {

​                     result.append(pairs[i][0].toString());

​                     result.append(" : ");

​                     result.append(pairs[i][1].toString());

​                     if(i < index - 1)

​                            result.append("\n");

​              }             

​              return result.toString();

​       }

​       public static void main(String[] args) {

​              Ex12<String,String> map = 

​                     new Ex12<String,String>(6);

​              map.put("sky", "blue");

​              map.put("grass", "green");

​              map.put("ocean", "dancing");

​              map.put("tree", "tall");

​              map.put("earth", "brown");

​              map.put("sun", "warm");

​              try {

​                     map.put("extra", "object");                } catch(ArrayIndexOutOfBoundsException e) {

​                     print("Too many objects");

​              }

​              print(map);

​              print(map.get("ocean"));

​              HashMap<String,String> hashMap = 

​                     new HashMap<String,String>(6);

​              hashMap.put("sky", "blue");

​              hashMap.put("grass", "green");

​              hashMap.put("ocean", "dancing");

​              hashMap.put("tree", "tall");

​              hashMap.put("earth", "brown");

​              hashMap.put("sun", "warm");

​              try {

​                     hashMap.put("extra", "object");                } catch(ArrayIndexOutOfBoundsException e) {

​                     print("Too many objects");

​              }

​              print(hashMap);

​              print(hashMap.get("ocean"));

​              TreeMap<String,String> treeMap = 

​                     new TreeMap<String,String>();

​              treeMap.put("sky", "blue");

​              treeMap.put("grass", "green");

​              treeMap.put("ocean", "dancing");

​              treeMap.put("tree", "tall");

​              treeMap.put("earth", "brown");

​              treeMap.put("sun", "warm");

​              try {

​                     treeMap.put("extra", "object");          } catch(ArrayIndexOutOfBoundsException e) {

​                     print("Too many objects");

​              }

​              print(treeMap);

​              print(treeMap.get("ocean"));

​              LinkedHashMap<String,String> linkedHashMap = 

​                     new LinkedHashMap<String,String>(6);

​              linkedHashMap.put("sky", "blue");

​              linkedHashMap.put("grass", "green");

​              linkedHashMap.put("ocean", "dancing");

​              linkedHashMap.put("tree", "tall");

​              linkedHashMap.put("earth", "brown");

​              linkedHashMap.put("sun", "warm");

​              try {

​                     linkedHashMap.put("extra", "object");             } catch(ArrayIndexOutOfBoundsException e) {

​                     print("Too many objects");

​              }

​              print(linkedHashMap);

​              print(linkedHashMap.get("ocean"));

​       }

}

 

public class WordCounter13 {

​       public static void main(String[] args) {

​                           String fileName = "WordCounter13.java";

​                           Set<String> words = new TreeSet<String>(new TextFile(fileName, "\\W+"));

​                           AssociativeArray<String,Integer> wordCount =

​                     new AssociativeArray<String,Integer>(words.size());

​                           ArrayList<String> fileList = new TextFile(fileName, "\\W+");

​                           for(String s : words) {

​                     int count = 0;

​                     for(String t : fileList) {

​                            if(t.equals(s)) count++;

​                     }

​                     wordCount.put(s, count);

​              }

​              print(wordCount);

​       }

}

 

 

 

 

   import net.mindview.util.*;     

import static net.mindview.util.Print.*;

import java.util.*;

import java.util.concurrent.*;

 

public class Maps14 {

​       public static void printKeys(Map<Integer,String> map) {

​              printnb("Size = " + map.size() + ", ");

​              printnb("Keys: ");

​              print(map.keySet());    }

​             public static void printKeys2(Map<Object,Object> map) {

​              printnb("Size = " + map.size() + ", ");

​              printnb("Keys: ");

​              print(map.keySet());    }

​       public static void test(Map<Integer,String> map) {

​              print(map.getClass().getSimpleName());

​              map.putAll(new CountingMapData(25));

​                           map.putAll(new CountingMapData(25));

​              printKeys(map);

​                           printnb("Values: ");

​              print(map.values());

​              print(map);

​              print("map.containsKey(11): " + map.containsKey(11));

​              print("map.get(11): " + map.get(11));

​              print("map.containsValue(\"F0\"): " + map.containsValue("F0"));

​              Integer key = map.keySet().iterator().next();

​              print("First key in map: " + key);

​              map.remove(key);

​              printKeys(map);

​              map.clear();

​              print("map.isEmpty(): " + map.isEmpty());

​              map.putAll(new CountingMapData(25));

​                           map.keySet().removeAll(map.keySet());

​              print("map.isEmpty(): " + map.isEmpty());

​       }

​             public static void test2(Map<Object,Object> map) {

​              print(map.getClass().getSimpleName());

​              map.putAll(new CountingMapData(25));

​                           map.putAll(new CountingMapData(25));

​              printKeys2(map);

​                           printnb("Values: ");

​              print(map.values());

​              print(map);

​              print("map.containsKey(11): " + map.containsKey(11));

​              print("map.get(11): " + map.get(11));

​              print("map.containsValue(\"F0\"): " + map.containsValue("F0"));

​              Object key = map.keySet().iterator().next();

​              print("First key in map: " + key);

​              map.remove(key);

​              printKeys2(map);

​              map.clear();

​              print("map.isEmpty(): " + map.isEmpty());

​              map.putAll(new CountingMapData(25));

​                           map.keySet().removeAll(map.keySet());

​              print("map.isEmpty(): " + map.isEmpty());

​       }

​       public static void main(String[] args) {

​                                                                                                                                   Map<Object,Object> moop = new Properties();

​                                                     test2(new Properties());      }

}

 

public class WordCounter15 {

​       public static void main(String[] args) {

​                           String fileName = "WordCounter15.java";

​                           ArrayList<String> wordList = new TextFile(fileName, "\\W+");

​              SlowMap<String,Integer> wordCount = new SlowMap<String,Integer>();

​              Iterator it = wordList.iterator();

​              while(it.hasNext()) {

​                     String s = (String)it.next();

​                     if(!(wordCount.containsKey(s))) wordCount.put(s,1);

​                     else {

​                            int count = wordCount.get(s);

​                            wordCount.put(s, ++count);

​                     }

​              }

​              print(wordCount);        

​       }

}

 

class SlowMap16<K,V> extends AbstractMap<K,V> {

​       private List<K> keys = new ArrayList<K>();      

​       private List<V> values = new ArrayList<V>();

​       private EntrySet entries = new EntrySet();

​       public Set<Map.Entry<K,V>> entrySet() { return entries; }

​       public V put(K key, V value) {

​              V oldValue = get(key);              if(!keys.contains(key)) {

​                     keys.add(key);

​                     values.add(value);

​              } else

​                     values.set(keys.indexOf(key), value);

​              return oldValue;

​       }

​       public V get(Object key) {         if(!keys.contains(key))

​                     return null;

​              return values.get(keys.indexOf(key));

​       }

​       private class EntrySet extends AbstractSet<Map.Entry<K,V>> {

​              public int size() { return keys.size(); }

​              public Iterator<Map.Entry<K,V>> iterator() {

​                     return new Iterator<Map.Entry<K,V>>() {

​                            private int index = -1;

​                            public boolean hasNext() {

​                                   return index < keys.size() - 1; 

​                            }

​                            @SuppressWarnings("unchecked")

​                            public Map.Entry<K,V> next() {

​                                   int i = ++index;

​                                   return new MapEntry(

​                                   keys.get(i), values.get(i));       

​                            }

​                            public void remove() {

​                                   keys.remove(index);

​                                       values.remove(index--);             

​                            }                           

​                     };

​              }                           

​       }      

}

 

public class Maps16 {

​       public static void printKeys(Map<Integer,String> map) {

​              printnb("Size = " + map.size() + ", ");

​              printnb("Keys: ");

​              print(map.keySet());    }

​       public static void test(Map<Integer,String> map) {

​              print(map.getClass().getSimpleName());

​              map.putAll(new CountingMapData(25));

​                           map.putAll(new CountingMapData(25));

​              printKeys(map);

​                           printnb("Values: ");

​              print(map.values());

​              print(map);

​              print("map.containsKey(11): " + map.containsKey(11));

​              print("map.get(11): " + map.get(11));

​              print("map.containsValue(\"F0\"): " + map.containsValue("F0"));

​              Integer key = map.keySet().iterator().next();

​              print("First key in map: " + key);

​              map.remove(key);

​              printKeys(map);

​              map.clear();

​              print("map.isEmpty(): " + map.isEmpty());

​              map.putAll(new CountingMapData(25));

​                           map.keySet().removeAll(map.keySet());

​              print("map.isEmpty(): " + map.isEmpty());

​       }

​       public static void main(String[] args) {

​              test(new HashMap<Integer,String>());

​              print();

​              test(new SlowMap<Integer,String>());

​              print();

​              test(new SlowMap16<Integer,String>());                  

​       }

}

 

public class SlowMap17<K,V> implements Map<K,V> {

​       private List<K> keys = new ArrayList<K>();      

​       private List<V> values = new ArrayList<V>();

​       private EntrySet entries = new EntrySet();

​       private Set<K> keySet = new KeySet();      

​       public Set<Map.Entry<K,V>> entrySet() { return entries; }

​       public Set<K> keySet() { return keySet; }

​       public V put(K key, V value) {

​              V oldValue = get(key);              if(!keys.contains(key)) {

​                     keys.add(key);

​                     values.add(value);

​              } else

​                     values.set(keys.indexOf(key), value);

​              return oldValue;

​       }

​       public V get(Object key) {         if(!keys.contains(key))

​                     return null;

​              return values.get(keys.indexOf(key));

​       }

​       private class EntrySet extends AbstractSet<Map.Entry<K,V>> {

​              public int size() { return keys.size(); }

​              public Iterator<Map.Entry<K,V>> iterator() {

​                     return new Iterator<Map.Entry<K,V>>() {

​                            private int index = -1;

​                            public boolean hasNext() {

​                                   return index < keys.size() - 1; 

​                            }

​                            @SuppressWarnings("unchecked")

​                            public Map.Entry<K,V> next() {

​                                   int i = ++index;

​                                   return new MapEntry(

​                                   keys.get(i), values.get(i));       

​                            }

​                            public void remove() {

​                                   keys.remove(index);

​                                       values.remove(index--);             

​                            }                           

​                     };

​              }                           

​       }

​       public void clear() {

​              keys.clear();

​              values.clear();

​       }

​       public boolean containsKey(Object key) {

​              return keys.contains(key);

​       }

​       public boolean containsValue(Object value) {

​              return values.contains(value);

​       }

​       public boolean equals(Object o) {

​              if(o instanceof SlowMap17) {

​                     if(this.entrySet().equals(((SlowMap17)o).entrySet()))

​                            return true;

​              }

​              return false;

​       }

​       public int hashCode() {

​              return this.entrySet().hashCode();

​       }      

​       public boolean isEmpty() {

​              return this.entrySet().isEmpty();

​       }      

​       private class KeySet extends AbstractSet<K> {

​              public int size() { return keys.size(); }

​              public Iterator<K> iterator() {

​                     return new Iterator<K>() {

​                            private int index = -1;

​                            public boolean hasNext() {

​                                   return index < keys.size() - 1; 

​                            }

​                            public K next() {

​                                   int i = ++index;

​                                   return keys.get(index);   

​                            }

​                            public void remove() {

​                                   keys.remove(index--);

​                                }                           

​                     };

​              }

​              

​       }

​       public void putAll(Map<? extends K,? extends V> m) {

​              for(Map.Entry<? extends K,? extends V> me : m.entrySet())

​                     this.put(me.getKey(), me.getValue());

​       }

​       public V remove(Object key) {

​              V v = this.get(key); 

​              int i = keys.indexOf(key);

​              keys.remove(i);

​              values.remove(i);

​              return v;

​       }

​       public int size() { return keys.size(); }

​       public Collection<V> values() { 

​              return values;

​       }

​       public String toString() {

​              return this.entrySet().toString();

​       }      

​       public static void main(String[] args) {

​              SlowMap17<String,String> m = new SlowMap17<String,String>();

​              m.putAll(Countries.capitals(15));

​              print("m: " + m);

​              print("m.get(\"BURUNDI\"): " + m.get("BURUNDI"));

​              print("m.entrySet(): " + m.entrySet());

​              print("m.keySet(): " + m.keySet());              

​              print("m.values() = " + m.values());

​              print("Two different maps: ");

​              SlowMap17<String,String> m2 = new SlowMap17<String,String>();

​              print("m.equals(m2): " + m.equals(m2));

​              m2.putAll(Countries.capitals(15));

​              print("Maps with same entries: ");

​              print("m.equals(m2): " + m.equals(m2));

​              m.clear();

​              print("After m.clear(), m.isEmpty(): " + 

​                     m.isEmpty() + ", m = " + m);

​              m2.keySet().clear();

​              print("After m2.keySet().clear(), m2.isEmpty(): " 

​                     + m2.isEmpty() + ", m2 = " + m2);

​       }

}

 

public class SlowSet18<E> implements Set<E> {

​       private List<E> elements = new ArrayList<E>();      

​       public boolean add(E e) {

​              if(elements.contains(e)) return false;

​              elements.add(e);

​              return true;

​       }

​       public boolean addAll(Collection<? extends E> c) {

​              return(elements.addAll(c));

​       }      

​       public void clear() {

​              elements.clear();

​       }

​       public boolean contains(Object o) {

​              return elements.contains(o);

​       }

​       public boolean containsAll(Collection<?> c) {

​              int count = 0; 

​              for(Object o : c)

​                     if(elements.contains(o)) count++;

​              if(count == c.size()) return true;

​              return false;           

​       }

​       public boolean equals(Object o) {

​              if(o instanceof SlowSet18) {

​                     if((elements.size() == ((SlowSet18)o).size())) {

​                            int count = 0;

​                            for(int i = 0; i < elements.size(); i++)                                            if(elements.get(i).equals(((SlowSet18)o).elements.get(i)))

​                                          count++;

​                            if(count == elements.size()) return true;

​                     }                                  

​              }

​              return false;           

​       }

​       public int hashCode() {

​              int result = 0;

​              for(int i = 0; i < elements.size(); i++)

​                     result += elements.get(i).hashCode();

​              return result;

​       }      

​       public boolean isEmpty() {

​              return(elements.size() == 0);

​       }

​       public Iterator<E> iterator() {

​              return elements.iterator();

​       }

​       public boolean remove(Object o) {

​              return(elements.remove(o));

​       }

​       public boolean removeAll(Collection<?> c) {

​              int n = elements.size();

​              for(Object o : c) elements.remove(o);

​              if(n != elements.size()) return true;

​              return false;

​       }

​       public boolean retainAll(Collection<?> c) {

​              int n = elements.size();

​              for(int i = 0; i < elements.size(); i++) { 

​                     E e = elements.get(i);

​                     if(!(c.contains(e))) elements.remove(e);

​              }

​              if(n != elements.size()) return true;

​              return false;

​       }

​       public int size() { return elements.size(); }

​       public Object[] toArray() {

​              return elements.toArray();

​       }

​       public <T> T[] toArray(T[] a) {

​              return elements.toArray(a);

​       }

​       

​       public String toString() {

​              if(elements.size() == 0) return "[]";

​              StringBuilder s = new StringBuilder();

​              s.append("[");

​              for(int i = 0; i < elements.size() - 1; i++)

​                     s.append(String.valueOf(elements.get(i)) + ", ");

​              s.append(String.valueOf(elements.get(elements.size() -1)));

​              s.append("]");

​              return s.toString();

​       }

​       

​       public static void main(String[] args) {

​              SlowSet18<String> ss = new SlowSet18<String>();

​              ss.add("hi");

​              print(ss);

​              ss.add("there");

​              print(ss);        

​              List<String> list = Arrays.asList("you", "cutie", "pie");

​              ss.addAll(list);

​              print(ss);

​              print("ss.size() = " + ss.size());

​              print("ss.contains(\"you\"): " + ss.contains("you"));

​              print("ss.contains(\"me\"): " + ss.contains("me"));     

​              print("ss.containsAll(list): " + ss.containsAll(list));

​              SlowSet18<String> ss2 = new SlowSet18<String>();

​              print("ss2 = " + ss2);

​              print("ss.containsAll(ss2): " + ss.containsAll(ss2));

​              print("ss2.containAll(ss): " + ss2.containsAll(ss));

​              ss2.add("you");

​              ss2.add("cutie");

​              ss.removeAll(ss2);

​              print("ss = " + ss);

​              print("ss.hashCode() = " + ss.hashCode());

​              List<String> list2 = Arrays.asList("hi", "there", "pie");

​              ss2.remove("you");

​              print(ss2);

​              print("ss2.isEmpty(): " + ss2.isEmpty());

​              ss2.clear();

​              print("ss2.isEmpty(): " + ss2.isEmpty());

​              ss2.addAll(list2);

​              print("ss2 = " + ss2);

​              print("ss.equals(ss2): " + ss.equals(ss2));

​              String[] sa = new String[3];

​              print("ss.toArray(sa): " + ss.toArray(sa));

​              for(int i = 0; i < sa.length; i++) printnb(sa[i] + " " );                       

​       }

}

 

 

 

 

   import net.mindview.util.*;     

import static net.mindview.util.Print.*;

import java.util.*;

 

public class WordCounter19 {

​       public static void main(String[] args) {

​                           String fileName = "WordCounter19.java";

​                           Set<String> words = new TreeSet<String>(new TextFile(fileName, "\\W+"));

​                           SimpleHashMap<String,Integer> wordCount =

​                     new SimpleHashMap<String,Integer>();           

​                           ArrayList<String> fileList = new TextFile(fileName, "\\W+");

​                           for(String s : words) {

​                     int count = 0;

​                     for(String t : fileList) {

​                            if(t.equals(s)) count++;

​                     }

​                     wordCount.put(s, count);

​              }

​              print(wordCount);

​       }

}

 

 

 

​    import java.util.*;

import net.mindview.util.*;

 

public class SimpleHashMap20<K,V> extends AbstractMap<K,V> {

​                   static final int SIZE = 997;

​                   @SuppressWarnings("unchecked")

​       LinkedList<MapEntry<K,V>>[] buckets =

​              new LinkedList[SIZE];

​       public V put(K key, V value) {

​              V oldValue = null;

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null)

​                     buckets[index] = new LinkedList<MapEntry<K,V>>();

​              LinkedList<MapEntry<K,V>> bucket = buckets[index];

​              MapEntry<K,V> pair = new MapEntry<K,V>(key, value);

​              boolean found = false;

​              ListIterator<MapEntry<K,V>> it = bucket.listIterator();

​              while(it.hasNext()) {

​                     MapEntry<K,V> iPair = it.next();

​                     if(iPair.getKey().equals(key)) {                          System.out.println("Collision: new " +

​                                   pair + " for old " + iPair);

​                            oldValue = iPair.getValue();

​                            it.set(pair);                         found = true;

​                            break;

​                     }

​              }      

​              if(!found)

​                     buckets[index].add(pair);

​              return oldValue;

​       }

​       public V get(Object key) {

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null) return null;

​              for(MapEntry<K,V> iPair : buckets[index])

​                     if(iPair.getKey().equals(key))

​                            return iPair.getValue();

​              return null;

​       }

​       public Set<Map.Entry<K,V>> entrySet() {

​              Set<Map.Entry<K,V>> set = new HashSet<Map.Entry<K,V>>();

​              for(LinkedList<MapEntry<K,V>> bucket : buckets) {

​                     if(bucket == null) continue;

​                     for(MapEntry<K,V> mpair : bucket)

​                            set.add(mpair);

​              }

​              return set;

​       }

​       public static void main(String[] args) {

​              SimpleHashMap20<String,String> m =

​                     new SimpleHashMap20<String,String>();

​              m.putAll(Countries.capitals(10));

​              System.out.println(m);

​              m.put("EGYPT","Berlin?");

​              m.put("EGYPT","Cairo");

​              System.out.println(m);

​              m.putAll(Countries.capitals(10));

​       }

}

 

public class SimpleHashMap21<K,V> extends AbstractMap<K,V> {

​                   static final int SIZE = 997;

​                   @SuppressWarnings("unchecked")

​       LinkedList<MapEntry<K,V>>[] buckets =

​              new LinkedList[SIZE];

​       public V put(K key, V value) {

​              V oldValue = null;

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null)

​                     buckets[index] = new LinkedList<MapEntry<K,V>>();

​              LinkedList<MapEntry<K,V>> bucket = buckets[index];

​              MapEntry<K,V> pair = new MapEntry<K,V>(key, value);

​              boolean found = false;

​              ListIterator<MapEntry<K,V>> it = bucket.listIterator();

​              int probes = 0;

​              while(it.hasNext()) {

​                     MapEntry<K,V> iPair = it.next();

​                     probes++;

​                     if(iPair.getKey().equals(key)) {

​                            oldValue = iPair.getValue();

​                            it.set(pair);                         found = true;

​                            System.out.println("Collision at " + 

​                                   iPair + ": " + probes + " probe" 

​                                   + ((probes == 1) ? "" : "s") +

​                                   " needed");

​                            break;

​                     }

​              }      

​              if(!found)

​                     buckets[index].add(pair);

​              return oldValue;

​       }

​       public V get(Object key) {

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null) return null;

​              for(MapEntry<K,V> iPair : buckets[index])

​                     if(iPair.getKey().equals(key))

​                            return iPair.getValue();

​              return null;

​       }

​       public Set<Map.Entry<K,V>> entrySet() {

​              Set<Map.Entry<K,V>> set = new HashSet<Map.Entry<K,V>>();

​              for(LinkedList<MapEntry<K,V>> bucket : buckets) {

​                     if(bucket == null) continue;

​                     for(MapEntry<K,V> mpair : bucket)

​                            set.add(mpair);

​              }

​              return set;

​       }

​       public static void main(String[] args) {

​              SimpleHashMap21<String,String> m =

​                     new SimpleHashMap21<String,String>();

​              m.putAll(Countries.capitals(5));

​              System.out.println(m);

​              m.put("EGYPT","Berlin?");

​              m.put("EGYPT", "New York?");

​              m.put("EGYPT", "Cairo");

​              System.out.println();

​              m.putAll(Countries.capitals(6));

​              System.out.println(m);

​       }

}

public class SimpleHashMap22<K,V> extends AbstractMap<K,V> {

​                   static final int SIZE = 997;

​                   @SuppressWarnings("unchecked")

​       LinkedList<MapEntry<K,V>>[] buckets =

​              new LinkedList[SIZE];

​       public V put(K key, V value) {

​              V oldValue = null;

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null)

​                     buckets[index] = new LinkedList<MapEntry<K,V>>();

​              LinkedList<MapEntry<K,V>> bucket = buckets[index];

​              MapEntry<K,V> pair = new MapEntry<K,V>(key, value);

​              boolean found = false;

​              ListIterator<MapEntry<K,V>> it = bucket.listIterator();

​              while(it.hasNext()) {

​                     MapEntry<K,V> iPair = it.next();

​                     if(iPair.getKey().equals(key)) {

​                            oldValue = iPair.getValue();

​                            it.set(pair);                         found = true;

​                            break;

​                     }

​              }      

​              if(!found)

​                     buckets[index].add(pair);

​              return oldValue;

​       }

​       public V get(Object key) {

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null) return null;

​              for(MapEntry<K,V> iPair : buckets[index])

​                     if(iPair.getKey().equals(key))

​                            return iPair.getValue();

​              return null;

​       }

​       public void clear() {

​              for(LinkedList<MapEntry<K,V>> bucket : buckets)

​                     if(bucket != null) bucket.clear();          

​       }

​       public V remove(Object o) {

​              V v = null;

​              if(this.get(o) != null) {

​                     int index = Math.abs(o.hashCode()) % SIZE;

​                     for(MapEntry<K,V> iPair : buckets[index])

​                            if(iPair.getKey().equals(o)) {

​                                   v = iPair.getValue();

​                                   int i =

​                                   buckets[index].indexOf(iPair);

​                                   buckets[index].remove(i);

​                                   break;            

​                            }

​              }

​              return v;         

​       }

​       public Set<Map.Entry<K,V>> entrySet() {

​              Set<Map.Entry<K,V>> set = new HashSet<Map.Entry<K,V>>();

​              for(LinkedList<MapEntry<K,V>> bucket : buckets) {

​                     if(bucket == null) continue;

​                     for(MapEntry<K,V> mpair : bucket)

​                            set.add(mpair);

​              }

​              return set;

​       }

​       public static void main(String[] args) {

​              SimpleHashMap22<String,String> m =

​                     new SimpleHashMap22<String,String>();

​              m.putAll(Countries.capitals(5));

​              println(m);

​              println(m.get("ALGERIA"));

​              println(m.remove("ALGERIA"));

​              println(m.get("ALGERIA"));

​              println(m.remove("ANGOLA"));

​              println(m);      

​              m.clear();

​              println(m);                    

​       }

}

 

public class SimpleHashMap23<K,V> implements Map<K,V> {

​                   static final int SIZE = 997;

​                   @SuppressWarnings("unchecked")

​       LinkedList<MapEntry<K,V>>[] buckets = new LinkedList[SIZE];

​       public int size() {

​              int result = 0;

​              for(LinkedList bucket : buckets)

​                     if(bucket != null) result += bucket.size();

​              return result;

​       }

​             private int firstNonEmptyBucket() {

​              if(buckets.length < 1) return -1;

​              for(int j = 0; j < buckets.length; j++) 

​                     if(buckets[j] != null) return j;

​              return -1;              

​       }

​       private int start(int i) {

​              int first = this.firstNonEmptyBucket();

​              if(i < first) return -1;

​              if(i == first) return 0;

​              int result = 0;

​              for(int j = first; j < i; j++) 

​                     if(buckets[j] != null) result += buckets[j].size();

​              return result;

​       }

​       private int end(int i) {

​              int first = this.firstNonEmptyBucket();

​              if(i < first) return -1;

​              return start(i) + ((buckets[i] == null) ? 0 : buckets[i].size()); 

​       }

​       private EntrySet entries = new EntrySet();

​       private KeySet keys = new KeySet();

​       public Set<Map.Entry<K,V>> entrySet() { return entries; }

​       public Set<K> keySet() { return keys; }

​       public boolean isEmpty() {

​              return this.size() == 0;

​       }      

​       public V put(K key, V value) {

​              V oldValue = null;

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null)

​                     buckets[index] = new LinkedList<MapEntry<K,V>>();

​              LinkedList<MapEntry<K,V>> bucket = buckets[index];

​              MapEntry<K,V> pair = new MapEntry<K,V>(key, value);

​              boolean found = false;

​              ListIterator<MapEntry<K,V>> it = bucket.listIterator();

​              while(it.hasNext()) {

​                     MapEntry<K,V> iPair = it.next();

​                     if(iPair.getKey().equals(key)) {

​                            oldValue = iPair.getValue();

​                            it.set(pair);                         found = true;

​                            break;

​                     }

​              }      

​              if(!found)

​                     buckets[index].add(pair);

​              return oldValue;

​       }

​       public void putAll(Map<? extends K, ? extends V> m) {

​              for(Map.Entry<? extends K,? extends V> me : m.entrySet())

​                     this.put(me.getKey(), me.getValue());

​       }

​       public V get(Object key) {

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null) return null;

​              for(MapEntry<K,V> iPair : buckets[index])

​                     if(iPair.getKey().equals(key))

​                            return iPair.getValue();

​              return null;

​       }

​       public void clear() {

​              for(LinkedList<MapEntry<K,V>> bucket : buckets)

​                     if(bucket != null) bucket.clear();          

​       }

​       public boolean containsKey(Object key) {

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null) return false;

​              for(MapEntry<K,V> iPair : buckets[index])

​                     if(iPair.getKey().equals(key))

​                            return true;

​              return false;

​       }      

​       public boolean containsValue(Object value) {

​              for(LinkedList<MapEntry<K,V>> bucket : buckets) {

​                     if(bucket != null) 

​                            for(MapEntry<K,V> iPair : bucket)

​                                   if(iPair.getValue().equals(value)) return true;

​              }

​              return false;

​       }

​       public Collection<V> values() {

​              HashSet<V> vals = new HashSet<V>();

​              for(LinkedList<MapEntry<K,V>> bucket : buckets) {

​                     if(bucket != null) 

​                            for(MapEntry<K,V> iPair : bucket)

​                                   vals.add(iPair.getValue()); 

​              }

​              return vals;

​       }

​       public boolean equals(Object o) {

​              if(o instanceof SimpleHashMap23) {

​                     if(this.entrySet().equals(((SimpleHashMap23)o).entrySet()))

​                            return true;

​              }

​              return false;

​       }

​       public int hashCode() {

​              return this.entrySet().hashCode();

​       }      

​       public V remove(Object o) {

​              V v = null;

​              if(this.get(o) != null) {

​                     int index = Math.abs(o.hashCode()) % SIZE;

​                     for(MapEntry<K,V> iPair : buckets[index])

​                            if(iPair.getKey().equals(o)) {

​                                   v = iPair.getValue();

​                                   int i =

​                                   buckets[index].indexOf(iPair);

​                                   buckets[index].remove(i);

​                                   break;            

​                            }

​              }

​              return v;         

​       }

​       private class EntrySet extends AbstractSet<Map.Entry<K,V>> {

​              public int size() { return SimpleHashMap23.this.size(); }

​              public Iterator<Map.Entry<K,V>> iterator() {

​                     return new Iterator<Map.Entry<K,V>>() {

​                            private int index = -1;

​                            public boolean hasNext() {

​                                   return index < SimpleHashMap23.this.size() - 1; 

​                            }

​                            @SuppressWarnings("unchecked")

​                            public Map.Entry<K,V> next() {

​                                   int i = ++index;

​                                   for(int j = 0; j < SIZE; j++) {

​                                          if((start(j) <= index) && (index < end(j)))

​                                                 return new MapEntry(

​                                                 buckets[j].get(index - start(j)).getKey(),

​                                                 buckets[j].get(index - start(j)).getValue());  

​                                   }

​                                   return null;                                        

​                            }

​                            public void remove() {

​                                   for(int j = 0; j < SIZE; j++)

​                                          if(start(j) <= index && index < end(j))

​                                                 buckets[j].remove(index - start(j));

​                                   index--;                

​                            }                           

​                     };

​              }

​       }      

​       private class KeySet extends AbstractSet<K> {

​              public int size() { return SimpleHashMap23.this.size(); }

​              public Iterator<K> iterator() {

​                     return new Iterator<K>() {

​                            private int index = -1;

​                            public boolean hasNext() {

​                                   return index < SimpleHashMap23.this.size() - 1; 

​                            }

​                            public K next() {

​                                   int i = ++index;

​                                   for(int j = 0; j < SIZE; j++) {

​                                          if((start(j) <= index) && (index < end(j)))

​                                                 return buckets[j].get(index - start(j)).getKey();

​                                   }

​                                   return null;    

​                            }

​                            public void remove() {

​                                   for(int j = 0; j < SIZE; j++)

​                                          if(start(j) <= index && index < end(j))

​                                                 buckets[j].remove(index - start(j));

​                                   index--;                

​                            }

​                     };

​              }

​       } 

​       public String toString() {

​              return this.entrySet().toString();

​       }      

​       public static void main(String[] args) {

​              SimpleHashMap23<String,String> map =

​                     new SimpleHashMap23<String,String>();

​              map.putAll(Countries.capitals(3));

​              print("map = " + map);

​              print("map.entrySet(): " + map.entrySet());

​              print("map.keySet(): " + map.keySet());

​              print("map.values() = " + map.values());

​              print("map.isEmpty(): " + map.isEmpty());

​              print("map.containsKey(\"ALGERIA\"): " + map.containsKey("ALGERIA"));

​              print("map.containsValue(\"Algiers\"): " + map.containsValue("Algiers"));

​              print("map.get(\"ALGERIA\"): " + map.get("ALGERIA"));

​              print("map.remove(\"ALGERIA\"): " + map.remove("ALGERIA"));

​              print("After map.remove(\"ALGERIA\"), map.containsKey(\"ALGERIA\"): " +

​                     map.containsKey("ALGERIA"));

​              print(" and map.get(\"ALGERIA\"): " + map.get("ALGERIA"));

​              print(" and map: = " + map);      

​              map.clear();

​              print("After map.clear(), map = " + map);

​              print(" and map.isEmpty(): " + map.isEmpty());

​              map.putAll(Countries.capitals(3));

​              print("After map.putAll(Countries.capitals(3)), map = " + map);

​              SimpleHashMap23<String,String> map2 = 

​                     new SimpleHashMap23<String,String>();

​              map2.putAll(Countries.capitals(4));

​              print("After map2.putAll(Countries.capitals(4)), map2 = " + map2);

​              print(" and map.equals(map2): " + map.equals(map2));

​              map2.remove("BOTSWANA");     

​              print("After map2.remove(\"BOTSWANT\"), map.equals(map2): " + map.equals(map2));

​              map.entrySet().clear();

​              print("After map.entrySet().clear, map = " + map);

​              map.putAll(Countries.capitals(3));

​              print("After map.putAll(Countries.capitals(3)), map = " + map);

​              map.keySet().clear();

​              print("After map.keySet().clear(), map = " + map);                         

​       }

}

 

public class SimpleHashSet24<E> implements Set<E> {

​       static final int SIZE = 997;

​       @SuppressWarnings("unchecked")

​       LinkedList<E>[] buckets = new LinkedList[SIZE];

​       public int size() {

​              int result = 0;

​              for(LinkedList bucket : buckets)

​                     if(bucket != null) result += bucket.size();

​              return result;

​       }

​       public boolean add(E e) {

​              if(this.contains(e)) return false;

​              int index = Math.abs(e.hashCode()) % SIZE;

​              if(buckets[index] == null)

​                     buckets[index] = new LinkedList<E>();

​              buckets[index].add(e);

​              return true;

​       }      

​       public boolean addAll(Collection<? extends E> c) {

​              int start = this.size();

​              for(E e : c) this.add(e);

​              return(this.size() > start);             

​       }      

​       public void clear() {

​              for(LinkedList<E> bucket : buckets)

​                     if(bucket != null) bucket.clear();          

​       }

​       public boolean contains(Object o) {

​              int index = Math.abs(o.hashCode()) % SIZE;

​              if(buckets[index] == null) return false;

​              for(E e : buckets[index])

​                     if(e.equals(o)) return true;

​              return false;

​       }      

​       public boolean containsAll(Collection<?> c) {

​              int count = 0; 

​              for(Object o : c)

​                     if(this.contains(o)) count++;

​              if(count == c.size()) return true;

​              return false;           

​       }

​       public boolean equals(Object o) {

​              if(o instanceof SimpleHashSet24) {

​                     if((this.size() == ((SimpleHashSet24)o).size())) {

​                            int count = 0;

​                            Iterator it = ((SimpleHashSet24)o).iterator();

​                            while(it.hasNext())

​                                   if(this.contains(it.next())) count++;

​                            if(count == this.size()) return true;

​                     }                                  

​              }

​              return false;           

​       }

​       public int hashCode() {

​              int result = 0;

​              for(LinkedList<E> bucket : buckets)

​                     if(bucket != null)

​                            for(E e : bucket) 

​                                   if(e != null) result += e.hashCode();   

​              return result;

​       }      

​       public boolean isEmpty() {

​              return(this.size() == 0);

​       }

​             private int firstNonEmptyBucket() {

​              if(buckets.length < 1) return -1;

​              for(int j = 0; j < buckets.length; j++) 

​                     if(buckets[j] != null) return j;

​              return -1;              

​       }

​       private int start(int i) {

​              int first = this.firstNonEmptyBucket();

​              if(i < first) return -1;

​              if(i == first) return 0;

​              int result = 0;

​              for(int j = first; j < i; j++) 

​                     if(buckets[j] != null) result += buckets[j].size();

​              return result;

​       }

​       private int end(int i) {

​              int first = this.firstNonEmptyBucket();

​              if(i < first) return -1;

​              return start(i) + ((buckets[i] == null) ? 0 : buckets[i].size()); 

​       }

​       public Iterator<E> iterator() {

​              return new Iterator<E>() {

​                     private int index = -1;

​                     public boolean hasNext() {

​                            return index < SimpleHashSet24.this.size() - 1; 

​                     }

​                     public E next() {

​                            int i = ++index;

​                            for(int j = 0; j < SIZE; j++) {

​                                   if((start(j) <= index) && (index < end(j)))

​                                          return buckets[j].get(index - start(j));

​                            }

​                            return null;    

​                     }

​                     public void remove() {

​                            for(int j = 0; j < SIZE; j++)

​                                   if(start(j) <= index && index < end(j))

​                                          buckets[j].remove(index - start(j));

​                            index--;                

​                     }

​              };

​       }

​       public boolean remove(Object o) {

​              int index = Math.abs(o.hashCode()) % SIZE;

​              if(buckets[index] == null) return false;

​              for(E e : buckets[index]) {

​                     if(e.equals(o)) {

​                            buckets[index].remove(e); 

​                            return true;

​                     }

​              }

​              return false;

​       }      

​       public boolean removeAll(Collection<?> c) {

​              int n = this.size();

​              for(Object o : c) this.remove(o);

​              if(n != this.size()) return true;

​              return false;

​       }

​       public boolean retainAll(Collection<?> c) {

​              int n = this.size();

​              for(LinkedList<E> bucket : buckets) {

​                     for(E e : bucket) 

​                            if(!(c.contains(e))) this.remove(e);

​              }

​              if(n != this.size()) return true;

​              return false;

​       }      

​       public Object[] toArray() {

​              Object[] result = new Object[this.size()];

​              Iterator<E> it = this.iterator();

​              for(int i = 0; i < this.size(); i++) 

​                     result[i] = it.next();                     

​              return result;

​       }

​       @SuppressWarnings("unchecked")    

​       public <T> T[] toArray(T[] a) {

​              Iterator<E> it = this.iterator();

​              for(int i = 0; i < this.size(); i++) {

​                     E x = it.next();

​                            try {

​                                  a[i] = (T)x;

​                            } catch(ClassCastException e) {

​                                   throw new RuntimeException(e);

​                            }

​              }

​              return a;

​       }

​       public String toString() {

​              if(this.size() == 0) return "[]";

​              StringBuilder s = new StringBuilder();

​              s.append("[");

​              for(LinkedList<E> bucket : buckets) {

​                     if(bucket != null)

​                            for(E e : bucket) 

​                                   s.append(String.valueOf(e) + " ");                            

​              }             

​              s.replace(s.length() - 1, s.length(), "]");

​              return s.toString();

​       }      

​       public static void main(String[] args) {

​              SimpleHashSet24<String> shs = new SimpleHashSet24<String>();

​              print("New empty SimpleHashSet24, shs = " + shs);

​              shs.add("hi");

​              shs.add("there");

​              print("After shs.add(\"hi\") and shs.add(\"there\"), shs = " + shs);                

​              List<String> list = Arrays.asList("you", "cutie", "pie");

​              shs.addAll(list);

​              print("After shs.addAll(list) (you, cutie, pie), shs = " + shs);

​              print("shs.size() = " + shs.size());

​              print("shs.contains(\"you\"): " + shs.contains("you"));

​              print("shs.contains(\"me\"): " + shs.contains("me")); 

​              print("shs.containsAll(list): " + shs.containsAll(list));

​              SimpleHashSet24<String> shs2 = new SimpleHashSet24<String>();

​              print("New empty shs2 = " + shs2);           

​              print("shs.containsAll(list): " + shs.containsAll(list));

​              print("shs2.containAll(list): " + shs2.containsAll(list));

​              print("shs.containsAll(shs2): " + shs.containsAll(shs2));

​              print("shs2.containAll(shs2): " + shs2.containsAll(shs2));

​              shs2.add("you");

​              shs2.add("cutie");

​              print("After shs2.add(\"you\"), shs2.add(\"cutie\"), shs2 = " + shs2);

​              shs.removeAll(shs2);

​              print("After shs.removeAll(shs2), shs = " + shs);

​              print("shs.hashCode() = " + shs.hashCode());

​              print("shs2 = " + shs2);

​              print("shs2.isEmpty(): " + shs2.isEmpty());

​              shs2.clear();

​              print("After shs2.clear(), shs2.isEmpty(): " + shs2.isEmpty());

​              List<String> list2 = Arrays.asList("hi", "there", "pie");

​              shs2.addAll(list2);

​              print("After shs2.addAll(list2) (hi, there, pie), shs2 = " + shs2);

​              print("shs.equals(shs2): " + shs.equals(shs2));

​              String[] sa = new String[3];

​              shs.toArray(sa);

​              printnb("After String[] sa = new String[3], shs.toArray(sa), sa holds: "); 

​              for(int i = 0; i < sa.length; i++) printnb(sa[i] + " " );

​       }

}

 

 

 

 

public class SimpleHashMap25<K,V> extends AbstractMap<K,V> {

​       class MapEntry25<K,V> implements Map.Entry<K,V> {

​              private K key;

​              private V value;

​              private MapEntry25<K,V> nextEntry = null;

​              public MapEntry25(K key, V value) {

​                     this.key = key;

​                     this.value = value;

​              }

​              public K getKey() { return key; }

​              public V getValue() { return value; }

​              public V setValue(V v) {

​                     V result = value;

​                     value = v;

​                     return result;

​              }

​              public MapEntry25<K,V> getNextEntry() {

​                     return this.nextEntry;

​              }

​              public void setNextEntry(MapEntry25<K,V> nextEntry) {

​                     this.nextEntry = nextEntry;

​              }

​              public int hashCode() {

​                     return (key == null ? 0 : key.hashCode()) ^

​                            (value == null ? 0 : value.hashCode());

​              }

​              public boolean equals(Object o) {

​                     if(!(o instanceof MapEntry25)) return false;

​                     MapEntry25 me = (MapEntry25)o;

​                     return 

​                            (key == null ?

​                            me.getKey() == null : key.equals(me.getKey())) &&

​                            (value == null ?

​                            me.getValue() == null : value.equals(me.getValue()));

​              }

​              public String toString() { return key + "=" + value; }

​       }

​                   static final int SIZE = 997;

​                   @SuppressWarnings("unchecked")

​       LinkedList<MapEntry25<K,V>>[] buckets =

​              new LinkedList[SIZE];

​       public V put(K key, V value) {

​              V oldValue = null;

​              MapEntry25<K,V> pair = new MapEntry25<K,V>(key, value);

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null) {

​                     buckets[index] = new LinkedList<MapEntry25<K,V>>();

​                     LinkedList<MapEntry25<K,V>> bucket = buckets[index];

​                     bucket.add(pair);

​              }

​              LinkedList<MapEntry25<K,V>> bucket = buckets[index];

​              if(buckets[index].size() > 0) {

​                     for(MapEntry25<K,V> entry = bucket.get(0); entry != null; 

​                     entry = entry.getNextEntry()) {

​                            if(entry.getKey().equals(key)) {

​                            oldValue = entry.getValue();

​                            entry.setValue(value);

​                            return oldValue;

​                            }

​                            }

​                     bucket.add(pair);

​                     int i = bucket.indexOf(pair); 

​                     if(i > 0) bucket.get(i - 1).setNextEntry(pair);

​                     return pair.getValue();   

​              }

​              return oldValue;    

​       }

​       public V get(Object key) {

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null) return null;

​              for(MapEntry25<K,V> iPair : buckets[index])

​                     if(iPair.getKey().equals(key))

​                            return iPair.getValue();

​              return null;

​       }

​       public Set<Map.Entry<K,V>> entrySet() {

​              Set<Map.Entry<K,V>> set = new HashSet<Map.Entry<K,V>>();

​              for(LinkedList<MapEntry25<K,V>> bucket : buckets) {

​                     if(bucket == null) continue;

​                     for(MapEntry25<K,V> mpair : bucket)

​                            set.add(mpair);

​              }

​              return set;

​       }

​       public static void main(String[] args) {

​              SimpleHashMap25<String,String> m =

​                     new SimpleHashMap25<String,String>();

​              m.putAll(Countries.capitals(5));

​              System.out.println(m);

​              System.out.println(m.put("BENIN","New York?"));            

​              System.out.println(m.put("BENIN","Porto-Novo"));

​              System.out.println(m.get("BENIN"));

​              System.out.println(m.entrySet());

​       }

}

 

public class CountedString26 {

​       private static List<String> created =

​              new ArrayList<String>();

​       private String s;

​       private int id = 0;

​       private char c;

​       public CountedString26(String str, char ch) {

​              s = str;

​              c = ch;

​              created.add(s);

​              for(String s2 : created)

​                     if(s2.equals(s)) id++;

​       }

​       public String toString() {

​              return "String: " + s + " id: " + id + ", c: " + c  +

​                     ", hashCode(): " + hashCode();

​       }

​       public int hashCode() {

​              int result = 17;

​              result = 37 * result + s.hashCode();

​              result = 37 * result + id;

​              result = 37 * result + c;

​              return result;

​       }      

​       public boolean equals(Object o) {

​              return o instanceof CountedString26 &&

​                     s.equals(((CountedString26)o).s) &&

​                     id == ((CountedString26)o).id &&

​                     c == ((CountedString26)o).c;

​              }

​       public static void main(String[] args) {

​              Map<CountedString26,Integer> map =

​                     new HashMap<CountedString26,Integer>();

​              CountedString26[] cs = new CountedString26[5];

​              for(int i = 0; i < cs.length; i++) {

​                     cs[i] = new CountedString26("hi", 'x');

​                     map.put(cs[i], i);          }

​              print(map);

​              for(CountedString26 cstring : cs) {

​                     print("Looking up " + cstring);

​                     print(map.get(cstring));

​              }      

​              

​       }

}

 

 

public class CountedString27 {

​       private static List<String> created = 

​              new ArrayList<String>();

​       private String s;

​       private int id = 0;

​       public CountedString27(String str) { 

​              s = str;

​              created.add(s);

​                                        for(String s2: created)

​                     if(s2.equals(s)) id++;

​       }

​       public String toString() {

​              return "String: " + s + " id: " + id +

​                     " hashCode(): " + hashCode();

​       }      

​       public int hashCode() {

​              int result = 17;

​              result = 37 * result + s.hashCode();

​                           return result;

​       }

​       public boolean equals(Object o) {

​              return o instanceof CountedString27 &&

​                     s.equals(((CountedString27)o).s) &&

​                     id == ((CountedString27)o).id;

​       }

​       public static void main(String[] args) {

​              Map<CountedString27,Integer> map =

​                     new HashMap<CountedString27,Integer>();

​              CountedString27[] cs = new CountedString27[5];

​              for(int i = 0; i < cs.length; i++) {

​                     cs[i] = new CountedString27("hi");

​                     map.put(cs[i], i);          }

​              print(map);

​                           for(CountedString27 cstring : cs) {

​                     print("Looking up " + cstring);

​                     print(map.get(cstring));

​              }      

​       }

}

 

class TwoTuple28<A,B> implements Comparable {

​      public final A first;

​      public final B second;

​      public TwoTuple28(A a, B b) { first = a; second = b; }

​       public int hashCode() {

​              int result = 17;

​              result = result * 37 + first.hashCode();

​              result = result * 37 + second.hashCode();

​              return result;

​       }

​       public boolean equals(Object o) {

​              return o instanceof TwoTuple28 &&

​              ((TwoTuple28)o).first.equals(first) &&

​              ((TwoTuple28)o).second.equals(second); 

​       }

​       public int compareTo(Object o) {

​              if(!(o instanceof TwoTuple28)) throw new ClassCastException();

​              TwoTuple28 t = (TwoTuple28)o;

​              return (this.hashCode() - t.hashCode() < 0) ? -1 : 

​              ((this.hashCode() - t.hashCode() > 0 ? 1 : 0));

​       }

​      public String toString() {

​        return "(" + first + ", " + second + ")";

​      }

} 

 

class ThreeTuple28<A,B,C> extends TwoTuple28<A,B> 

implements Comparable {

​      public final C third;

​      public ThreeTuple28(A a, B b, C c) {

​             super(a, b);

​                  third = c;

​      }

​       public int hashCode() {

​              int result = super.hashCode();

​              result = result * 37 + third.hashCode();

​              return result;

​       }

​       public boolean equals(Object o) {

​              return o instanceof ThreeTuple28 &&

​              ((ThreeTuple28)o).first.equals(first) &&

​              ((ThreeTuple28)o).second.equals(second) &&

​              ((ThreeTuple28)o).third.equals(third); 

​       }

​       public int compareTo(Object o) {

​              if(!(o instanceof ThreeTuple28)) throw new ClassCastException();

​              ThreeTuple28 t = (ThreeTuple28)o;

​              return (this.hashCode() - t.hashCode() < 0) ? -1 : 

​              ((this.hashCode() - t.hashCode() > 0 ? 1 : 0));

​       }

​      public String toString() {

​             return "(" + first + ", " + second + ", " + third +")";

​      }

} 

 

class FourTuple28<A,B,C,D> extends ThreeTuple28<A,B,C> 

implements Comparable {

​      public final D fourth;

​      public FourTuple28(A a, B b, C c, D d) {

​                  super(a, b, c);

​                  fourth = d;

​      }

​       public int hashCode() {

​              int result = super.hashCode();

​              result = result * 37 + fourth.hashCode();

​              return result;

​       }

​       public boolean equals(Object o) {

​              return o instanceof FourTuple28 &&

​              ((FourTuple28)o).first.equals(first) &&

​              ((FourTuple28)o).second.equals(second) &&

​              ((FourTuple28)o).third.equals(third) &&

​              ((FourTuple28)o).fourth.equals(fourth);

​       }

​       public int compareTo(Object o) {

​              if(!(o instanceof FourTuple28)) throw new ClassCastException();

​              FourTuple28 t = (FourTuple28)o;

​              return (this.hashCode() - t.hashCode() < 0) ? -1 : 

​              ((this.hashCode() - t.hashCode() > 0 ? 1 : 0));

​       }

​      public String toString() {

​                  return "(" + first + ", " + second + ", " +

​                 third + ", " + fourth + ")";

​      }

} 

 

class FiveTuple28<A,B,C,D,E>

extends FourTuple28<A,B,C,D> 

implements Comparable {

​      public final E fifth;

​      public FiveTuple28(A a, B b, C c, D d, E e) {

​                  super(a, b, c, d);

​                  fifth = e;

​      }

​       public int hashCode() {

​              int result = super.hashCode();

​              result = result * 37 + fifth.hashCode();

​              return result;

​       }

​       public boolean equals(Object o) {

​              return o instanceof FiveTuple28 &&

​              ((FiveTuple28)o).first.equals(first) &&

​              ((FiveTuple28)o).second.equals(second) &&

​              ((FiveTuple28)o).third.equals(third) &&

​              ((FiveTuple28)o).fourth.equals(fourth) &&

​              ((FiveTuple28)o).fifth.equals(fifth);

​       }

​       public int compareTo(Object o) {

​              if(!(o instanceof FiveTuple28)) throw new ClassCastException();

​              FiveTuple28 t = (FiveTuple28)o;

​              return (this.hashCode() - t.hashCode() < 0) ? -1 : 

​              ((this.hashCode() - t.hashCode() > 0 ? 1 : 0));

​       }

​      public String toString() {

​                  return "(" + first + ", " + second + ", " +

​                 third + ", " + fourth + ", " + fifth + ")";

​      }

} 

 

class Tuple28 {

​      public static <A,B> TwoTuple28<A,B> tuple(A a, B b) {

​                  return new TwoTuple28<A,B>(a, b);

​      }

​      public static <A,B,C> ThreeTuple28<A,B,C>

​      tuple28(A a, B b, C c) {

​                  return new ThreeTuple28<A,B,C>(a, b, c);

​      }

​      public static <A,B,C,D> FourTuple28<A,B,C,D>

​      tuple(A a, B b, C c, D d) {

​                  return new FourTuple28<A,B,C,D>(a, b, c, d);

​      }

​      public static <A,B,C,D,E>

​      FiveTuple28<A,B,C,D,E> tuple(A a, B b, C c, D d, E e) {

​                  return new FiveTuple28<A,B,C,D,E>(a, b, c, d, e);

​      }

} 

 

public class Tuple28Test {

​       public static void main(String[] args) {

​              Tuple28 t = new Tuple28();

​              FiveTuple28 t1b = t.tuple(1,1,1,1,1);

​              FiveTuple28 t2b = t.tuple(1,1,1,2,1);

​              FiveTuple28 t3b = t.tuple(1,1,1,1,1);

​              FiveTuple28 t4b = t.tuple(1,1,1,1,0);

​              print(t1b.compareTo(t1b));

​              print(t1b.compareTo(t2b));

​              print(t1b.compareTo(t3b));

​              print(t1b.compareTo(t4b));

​              List<FiveTuple28> list = 

​                     new ArrayList<FiveTuple28>(Arrays.asList(t1b,t2b,t3b,t4b));

​              Set<FiveTuple28> s = new TreeSet<FiveTuple28>();

​              s.addAll(list);

​              print(s);                 

​       }

}

 

public class ListPerformance29 {

​       static RandomGenerator.String randString = new RandomGenerator.String();

​       static Random rand = new Random();

​       static int reps = 1000;

​       static List<Test<List<String>>> tests =

​              new ArrayList<Test<List<String>>>();

​       static List<Test<LinkedList<String>>> qTests =

​              new ArrayList<Test<LinkedList<String>>>();

​       static {

​              tests.add(new Test<List<String>>("add") {

​                     int test(List<String> list, TestParam tp) {

​                            int loops = tp.loops;

​                            int listSize = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   list.clear();

​                                   for(int j = 0; j < listSize; j++)

​                                          list.add(randString.next());

​                            }

​                            return loops * listSize;

​                     }

​              });

​              tests.add(new Test<List<String>>("get") {

​                     int test(List<String> list, TestParam tp) {

​                            int loops = tp.loops * reps;

​                            int listSize = list.size();

​                            for(int i = 0; i < loops; i++)

​                                   list.get(rand.nextInt(listSize));

​                            return loops;

​                     }      

​              });

​              tests.add(new Test<List<String>>("set") {

​                     int test(List<String> list, TestParam tp) {

​                            int loops = tp.loops * reps;

​                            int listSize = list.size();

​                            for(int i = 0; i < loops; i++)

​                                   list.set(rand.nextInt(listSize), "hi");

​                            return loops;

​                     }

​              });

​              tests.add(new Test<List<String>>("iteradd") {

​                     int test(List<String> list, TestParam tp) {

​                            final int LOOPS = 1000000;

​                            int half = list.size()                            ListIterator<String> it = list.listIterator(half);

​                            for(int i = 0; i < LOOPS; i++)

​                                   it.add("hi");

​                            return LOOPS;

​                     }      

​              });

​              tests.add(new Test<List<String>>("insert") {

​                     int test(List<String> list, TestParam tp) {

​                            int loops = tp.loops;

​                            for(int i = 0; i < loops; i++)

​                                   list.add(5, "hi");                         return loops;

​                     }

​              });

​              tests.add(new Test<List<String>>("remove") {

​                     int test(List<String> list, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   list.clear();

​                                   list.addAll(Arrays.asList(Generated.array(String.class, 

​                                          new CountingGenerator.String(), size)));

​                                   while(list.size() > 5)

​                                          list.remove(5);                           } 

​                            return loops * size;              

​                     }

​              });

​                           qTests.add(new Test<LinkedList<String>>("addFirst") {

​                     int test(LinkedList<String> list, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   list.clear();

​                                   for(int j = 0; j < size; j++)

​                                          list.addFirst("hi");

​                            }

​                            return loops * size;

​                     }

​              });

​              qTests.add(new Test<LinkedList<String>>("addLast") {

​                     int test(LinkedList<String> list, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   list.clear();

​                                   for(int j = 0; j < size; j++)

​                                          list.addLast("hi");

​                            }

​                            return loops * size;

​                     }

​              });

​              qTests.add(new Test<LinkedList<String>>("rmFirst") {

​                     int test(LinkedList<String> list, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   list.clear();

​                                   list.addAll(Arrays.asList(Generated.array(String.class, 

​                                          new CountingGenerator.String(), size)));

​                                   while(list.size() > 0)

​                                          list.removeFirst();

​                            }

​                            return loops * size;

​                     }

​              });

​              qTests.add(new Test<LinkedList<String>>("rmLast") {

​                     int test(LinkedList<String> list, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   list.clear();

​                                   list.addAll(Arrays.asList(Generated.array(String.class, 

​                                          new CountingGenerator.String(), size)));

​                                   while(list.size() > 0)

​                                          list.removeLast();

​                            }

​                            return loops * size;

​                     }

​              });           

​       }

​       static class ListTester extends Tester<List<String>> {

​              public ListTester(List<String> container, List<Test<List<String>>> tests) {

​                     super(container, tests);

​              }

​                           @Override protected List<String> initialize(int size) {

​                     container.clear();

​                     container.addAll(Arrays.asList(Generated.array(String.class, 

​                                          new CountingGenerator.String(), size)));

​                     return container;

​              }

​                           public static void run(List<String> list, List<Test<List<String>>> tests) {

​                     new ListTester(list, tests).timedTest();

​              }

​       }      

​       public static void main(String[] args) {

​              if(args.length > 0)

​                     Tester.defaultParams = TestParam.array(args);

​                           Tester<List<String>> arrayTest = 

​                     new Tester<List<String>>(null, tests.subList(1, 3)) {

​                                                             @Override protected List<String> initialize(int size) {

​                            String[] ia = Generated.array(String.class, 

​                                   new CountingGenerator.String(), size);

​                            return Arrays.asList(ia);

​                     }

​              };

​              arrayTest.setHeadline("Array as List");

​              arrayTest.timedTest();

​              Tester.defaultParams = TestParam.array(

​                     10, 5000, 100, 5000, 1000, 1000, 10000, 200);

​              if(args.length > 0)

​                     Tester.defaultParams = TestParam.array(args);

​              ListTester.run(new ArrayList<String>(), tests);

​              ListTester.run(new LinkedList<String>(), tests);

​              ListTester.run(new Vector<String>(), tests);

​              Tester.fieldWidth = 12;

​              Tester<LinkedList<String>> qTest = new Tester<LinkedList<String>>(

​                     new LinkedList<String>(), qTests);

​              qTest.setHeadline("Queue tests");

​              qTest.timedTest();  

​       }

} 

 

public class Ex30Tests {

​       static Random rand = new Random();

​       public static ArrayList<Integer> createFullArrayList(int size) {

​              ArrayList<Integer> list = new ArrayList<Integer>();

​              for(int i = 0; i < size; i++) list.add(rand.nextInt(size));

​              return list;

​       }

​       public static LinkedList<Integer> createFullLinkedList(int size) {

​              LinkedList<Integer> list = new LinkedList<Integer>();

​              for(int i = 0; i < size; i++) list.add(rand.nextInt(size));

​              return list;

​       }

​       public static long meanSortTimeLinkedList(int size, int reps) {

​              long time = 0;

​              for(int i = 0; i < reps; i++) {

​                     LinkedList<Integer> lList = createFullLinkedList(size);

​                     long sortTime = timedLinkedListSort(lList); 

​                     time += sortTime;

​              }

​              return time    }

​       public static long meanSortTimeArrayList(int size, int reps) {

​              long time = 0;

​              for(int i = 0; i < reps; i++) {

​                     ArrayList<Integer> aList = createFullArrayList(size);

​                     long sortTime = timedArrayListSort(aList); 

​                     time += sortTime;

​              }

​              return time    }      

​       public static long timedArrayListSort(ArrayList<Integer> list) {

​                     long start = System.nanoTime();

​                     Collections.sort(list);

​                     long stop = System.nanoTime();

​                     return stop - start;  

​       }

​       public static long timedLinkedListSort(LinkedList<Integer> list) {

​                     long start = System.nanoTime();

​                     Collections.sort(list);

​                     long stop = System.nanoTime();

​                     return stop - start;  

​       }      

​       public static void main(String[] args) {

​              print("Collections.sort() times (nanosecs):");             

​              print();

​              print("Means of 10000 sorts:");

​              print();

​              print("Lists of 10 elements:");

​              print("LinkedList: " + meanSortTimeLinkedList(10,10000));

​              print("ArrayList:  " + meanSortTimeArrayList(10,10000));

​              print();

​              print("Lists of 100 elements:");

​              print("LinkedList: " + meanSortTimeLinkedList(100,10000));

​              print("ArrayList:  " + meanSortTimeArrayList(100,10000));

​              print();

​              print("Means of 1000 sorts:");

​              print();

​              print("Lists of 1000 elements:");

​              print("LinkedList: " + meanSortTimeLinkedList(1000,1000));

​              print("ArrayList:  " + meanSortTimeArrayList(1000,1000));

​       }

}

 

class StringsHolder {

​       private int size = 0;

​       private String[] sArray = new String[size];

​                   public void add(String s) { 

​              size += 1;

​              String[] temp = new String[size];

​              for(int i = 0; i < sArray.length; i++) temp[i] = sArray[i];

​              temp[size - 1] = s;

​              sArray = temp;

​       }

​             public String get(int i) {

​              if(-1 < i && i < size) return sArray[i];

​              else throw new ArrayIndexOutOfBoundsException(i);

​       }      

​       public String toString() {

​              StringBuilder sb = new StringBuilder();

​              for(int i = 0; i < sArray.length; i++) sb.append((sArray[i] + " "));

​              return sb.toString();             

​       }      

}

 

 class StringsHolder2 { 

​       private int size = 1000;

​       private int index = 0;

​       private String[] sArray = new String[size];

​             public void add(String s) {

​              if(index < size) sArray[index++] = s;

​       }

​             public String get(int i) {

​              if(-1 < i && i < size) return sArray[i];

​              else throw new ArrayIndexOutOfBoundsException(i);

​       }      

​       public String toString() {

​              StringBuilder sb = new StringBuilder();

​              for(int i = 0; i < sArray.length; i++) sb.append((sArray[i] + " "));

​              return sb.toString();             

​       }      

}

 

public class Ex31 {

​       static long addTimeTest(StringsHolder sh, int reps) {

​              long start = System.nanoTime();

​              for(int i = 0; i < reps; i++) sh.add("hi");

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       static long addTimeTest(ArrayList<String> list, int reps) {

​              long start = System.nanoTime();

​              for(int i = 0; i < reps; i++) list.add("hi");

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       static long getTimeTest(StringsHolder sh, int reps) {

​              long start = System.nanoTime();

​              for(int i = 0; i < reps; i++) sh.get(i);

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       static long getTimeTest(ArrayList<String> list, int reps) {

​              long start = System.nanoTime();

​              for(int i = 0; i < reps; i++) list.get(i);

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       static long addTimeTest(StringsHolder2 sh, int reps) {

​              long start = System.nanoTime();

​              for(int i = 0; i < reps; i++) sh.add("hi");

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       static long getTimeTest(StringsHolder2 sh, int reps) {

​              long start = System.nanoTime();

​              for(int i = 0; i < reps; i++) sh.get(i);

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       public static void main(String[] args) {       

​              ArrayList<String> list = new ArrayList<String>();

​              StringsHolder sh = new StringsHolder();

​              print("Add times (nanoseconds):");

​              print("Mean of 1000:");  

​              print("ArrayList add(): " + addTimeTest(list, 1000));

​              print("StringsHolder add(): " + addTimeTest(sh, 1000));

​              print("Mean of 10000:");       

​              print("ArrayList add(): " + addTimeTest(list, 10000));

​              print("StringsHolder add(): " + addTimeTest(sh, 10000));

​              print();

​              print("Get times (nanoseconds):");

​              print("Mean of 10000:");

​              print("ArrayList get(): " + getTimeTest(list, 10000));

​              print("StringsHolder get(): " + getTimeTest(sh, 10000));

​              print();

​              print("Using alternate fixed size (1000) StringsHolder2");

​              print("eliminates resizing and copying:");

​              ArrayList<String> list2 = new ArrayList<String>();

​              StringsHolder2 sh2 = new StringsHolder2();

​              print("Add times (nanoseconds):");

​              print("Mean of 1000:");  

​              print("ArrayList add(): " + addTimeTest(list2, 1000));

​              print("StringsHolder2 add(): " + addTimeTest(sh2, 1000));

​              print();

​              print("Get times (nanoseconds):");

​              print("Mean of 1000:");

​              print("ArrayList get(): " + getTimeTest(list2, 1000));

​              print("StringsHolder2 get(): " + getTimeTest(sh2, 1000));                             

​       }

}

class IntsHolder {

​       private int size = 0;

​       private int[] iArray = new int[size];

​       public int size() { return size; }

​                   public void add(int x) { 

​              size += 1;

​              int[] temp = new int[size];

​              for(int i = 0; i < iArray.length; i++) temp[i] = iArray[i];

​              temp[size - 1] = x;

​              iArray = temp;

​       }

​             public int get(int i) {

​              if(-1 < i && i < size) return iArray[i];

​              else throw new ArrayIndexOutOfBoundsException(i);

​       }

​       public void incrementAll() {

​              for(int i = 0; i < size; i++) iArray[i]++;

​       }      

​       public String toString() {

​              StringBuilder sb = new StringBuilder();

​              for(int i = 0; i < iArray.length; i++) sb.append((iArray[i] + " "));

​              return sb.toString();             

​       }      

}

 

 class IntsHolder2 { 

​       private final int SIZE = 1000;

​       private int index = 0;

​       private int[] iArray = new int[SIZE];

​       public int size() { return SIZE; }

​             public void add(int x) {

​              if(index < SIZE) iArray[index++] = x;

​       }

​             public int get(int i) {

​              if(-1 < i && i < SIZE) return iArray[i];

​              else throw new ArrayIndexOutOfBoundsException(i);

​       }

​       public void incrementAll() {

​              for(int i = 0; i < SIZE; i++) iArray[i]++;

​       }      

​       public String toString() {

​              StringBuilder sb = new StringBuilder();

​              for(int i = 0; i < iArray.length; i++) sb.append((iArray[i] + " "));

​              return sb.toString();             

​       }      

}

 

public class Ex32 {

​       static long addTimeTest(IntsHolder ih, int reps) {

​              long start = System.nanoTime();

​              for(int i = 0; i < reps; i++) ih.add(1);

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       static long addTimeTest(ArrayList<Integer> list, int reps) {

​              long start = System.nanoTime();

​              for(int i = 0; i < reps; i++) list.add(1);

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       static long getTimeTest(IntsHolder ih, int reps) {

​              long start = System.nanoTime();

​              for(int i = 0; i < reps; i++) ih.get(i);

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       static long getTimeTest(ArrayList<Integer> list, int reps) {

​              long start = System.nanoTime();

​              for(int i = 0; i < reps; i++) list.get(i);

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       static long addTimeTest(IntsHolder2 ih, int reps) {

​              long start = System.nanoTime();

​              for(int i = 0; i < reps; i++) ih.add(1);

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       static long getTimeTest(IntsHolder2 ih, int reps) {

​              long start = System.nanoTime();

​              for(int i = 0; i < reps; i++) ih.get(i);

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       static long incrementTimeTest(IntsHolder ih) {

​              long start = System.nanoTime();

​              ih.incrementAll();

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       static long incrementTimeTest(ArrayList<Integer> list) {

​              long start = System.nanoTime();

​              for(Integer i : list) i++;

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       static long incrementTimeTest(IntsHolder2 ih) {

​              long start = System.nanoTime();

​              ih.incrementAll();

​              long stop = System.nanoTime();

​              return (stop - start)     }

​       public static void main(String[] args) {       

​              ArrayList<Integer> list = new ArrayList<Integer>();

​              IntsHolder ih = new IntsHolder();

​              print("Add times (nanoseconds):");

​              print("Mean of 1000:");  

​              print("ArrayList add(): " + addTimeTest(list, 1000));

​              print("IntsHolder add(): " + addTimeTest(ih, 1000));

​              print("Mean of 10000:");       

​              print("ArrayList add(): " + addTimeTest(list, 10000));

​              print("IntsHolder add(): " + addTimeTest(ih, 10000));

​              print();

​              print("Get times (nanoseconds):");

​              print("Mean of 10000:");

​              print("ArrayList get(): " + getTimeTest(list, 10000));

​              print("IntsHolder get(): " + getTimeTest(ih, 10000));

​              print();

​              print("Using alternate fixed size (1000) StringsHolder2");

​              print("eliminates resizing and copying:");

​              ArrayList<Integer> list2 = new ArrayList<Integer>();

​              IntsHolder2 ih2 = new IntsHolder2();

​              print("Add times (nanoseconds):");

​              print("Mean of 1000:");  

​              print("ArrayList add(): " + addTimeTest(list2, 1000));

​              print("IntsHolder2 add(): " + addTimeTest(ih2, 1000));

​              print();

​              print("Get times (nanoseconds):");

​              print("Mean of 1000:");

​              print("ArrayList get(): " + getTimeTest(list2, 1000));

​              print("IntsHolder2 get(): " + getTimeTest(ih2, 1000));       

​              print();

​              ArrayList<Integer> list3 = new ArrayList<Integer>();

​              for(int i = 0; i < 1000; i++) list3.add(1);

​              IntsHolder ih3 = new IntsHolder();

​              for(int i = 0; i < 1000; i++) ih3.add(1);

​              IntsHolder2 ih4 = new IntsHolder2();

​              for(int i = 0; i < 1000; i++) ih4.add(1);

​              print("Increment times (1000 elements):");

​              print("ArrayList: " + incrementTimeTest(list3));   

​              print("IntsHolder: " + incrementTimeTest(ih3));

​              print("intsHolder2: " + incrementTimeTest(ih4));                     

​       }

}

 

 

 

class FastTraversalLinkedList<E> {

​       private LinkedList<E> lList = new LinkedList<E>();

​       private ArrayList<E> aList = new ArrayList<E>();

​       private ArrayList<E> toArrayList(LinkedList<E> lList) {

​              aList.clear();

​              aList.addAll(lList);

​              lList.clear();

​              return aList;

​       }

​       private LinkedList<E> toLinkedList(ArrayList<E> aList) {

​              lList.clear();

​              lList.addAll(aList);

​              aList.clear();

​              return lList;

​       }

​       public int size() {

​              return aList.size() < lList.size() ? lList.size() : aList.size();

​       }

​       public void clear() {

​              if(aList.size() < lList.size())

​                     lList.clear();

​              else

​                     toLinkedList(aList).clear();     

​       }

​       public void add(E e) {

​              if(aList.size() < lList.size())

​                     lList.add(e);

​              else

​                     toLinkedList(aList).add(e);    

​       }

​       public void add(int i, E e) {

​              if(aList.size() < lList.size())

​                     lList.add(i, e);

​              else

​                     toLinkedList(aList).add(i, e);  

​       }

​       public boolean addAll(Collection<? extends E> c) {

​              if(aList.size() < lList.size()) 

​                     return lList.addAll(c);                    

​              else

​                     return toLinkedList(aList).addAll(c);

​       }

​       public void addFirst(E e) {

​              if(aList.size() < lList.size())

​                     lList.addFirst(e);

​              else

​                     toLinkedList(aList).addFirst(e);     

​       }

​       public void addLast(E e) {

​              if(aList.size() < lList.size())

​                     lList.addLast(e);

​              else

​                     toLinkedList(aList).addLast(e);     

​       }

​       public E set(int i, E e) {

​              if(lList.size() < aList.size()) 

​                     return aList.set(i,e);

​              else

​                     return toArrayList(lList).set(i,e);

​       }

​       public E remove(int i) {

​              if(aList.size() < lList.size())

​                     return lList.remove(i);

​              else

​                     return toLinkedList(aList).remove(i);    

​       }

​       public E removeFirst() {

​              if(aList.size() < lList.size())

​                     return lList.removeFirst();

​              else

​                     return toLinkedList(aList).removeFirst();     

​       }

​       public E removeLast() {

​              if(aList.size() < lList.size())

​                     return lList.removeLast();

​              else

​                     return toLinkedList(aList).removeLast();     

​       }

​       public E get(int i) {

​              if(lList.size() < aList.size()) 

​                     return aList.get(i);

​              else

​                     return toArrayList(lList).get(i);

​       }

​       public Iterator<E> iterator() {

​              if(lList.size() < aList.size()) 

​                     return aList.iterator();

​              else

​                     return toArrayList(lList).iterator();

​       }

​       public ListIterator<E> listIterator() {

​              if(aList.size() < lList.size()) 

​                     return lList.listIterator();

​              else

​                     return toLinkedList(aList).listIterator();

​       }

​       public ListIterator<E> listIterator(int i) {

​              if(aList.size() < lList.size()) 

​                     return lList.listIterator(i);

​              else

​                     return toLinkedList(aList).listIterator(i);

​       }

​       public String toString() {

​              return aList.size() > lList.size() ? aList.toString() : 

​                     lList.size() == 0 ? aList.toString() : lList.toString();             

​       }      

}

 

public class ListPerformance33 {

​       static Random rand = new Random();

​       static int reps = 1000;

​       static List<Test<FastTraversalLinkedList<Integer>>> tests =

​              new ArrayList<Test<FastTraversalLinkedList<Integer>>>();

​       static List<Test<FastTraversalLinkedList<Integer>>> qTests =

​              new ArrayList<Test<FastTraversalLinkedList<Integer>>>();

​       static {

​              tests.add(new Test<FastTraversalLinkedList<Integer>>("add") {

​                     int test(FastTraversalLinkedList<Integer> list, TestParam tp) {

​                            int loops = tp.loops;

​                            int listSize = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   list.clear();

​                                   for(int j = 0; j < listSize; j++)

​                                          list.add(j);

​                            }

​                            return loops * listSize;

​                     }

​              });           

​              tests.add(new Test<FastTraversalLinkedList<Integer>>("get") {

​                     int test(FastTraversalLinkedList<Integer> list, TestParam tp) {

​                            int loops = tp.loops * reps;

​                            int listSize = list.size();

​                            for(int i = 0; i < loops; i++)

​                                   list.get(rand.nextInt(listSize));

​                            return loops;

​                     }      

​              });           

​              tests.add(new Test<FastTraversalLinkedList<Integer>>("set") {

​                     int test(FastTraversalLinkedList<Integer> list, TestParam tp) {

​                            int loops = tp.loops * reps;

​                            int listSize = list.size();

​                            for(int i = 0; i < loops; i++)

​                                   list.set(rand.nextInt(listSize), 47);

​                            return loops;

​                     }

​              });           

​              tests.add(new Test<FastTraversalLinkedList<Integer>>("iteradd") {

​                     int test(FastTraversalLinkedList<Integer> list, TestParam tp) {

​                            final int LOOPS = 1000000;

​                            int half = list.size()                            ListIterator<Integer> it = list.listIterator(half);

​                            for(int i = 0; i < LOOPS; i++)

​                                   it.add(47);

​                            return LOOPS;

​                     }      

​              });           

​              tests.add(new Test<FastTraversalLinkedList<Integer>>("insert") {

​                     int test(FastTraversalLinkedList<Integer> list, TestParam tp) {

​                            int loops = tp.loops;

​                            for(int i = 0; i < loops; i++)

​                                   list.add(5, 47);                           return loops;

​                     }

​              });           

​              tests.add(new Test<FastTraversalLinkedList<Integer>>("remove") {

​                     int test(FastTraversalLinkedList<Integer> list, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   list.clear();

​                                   list.addAll(new CountingIntegerList(size));

​                                   while(list.size() > 5)

​                                          list.remove(5);                           } 

​                            return loops * size;              

​                     }

​              });           

​                           qTests.add(new Test<FastTraversalLinkedList<Integer>>("addFirst") {

​                     int test(FastTraversalLinkedList<Integer> list, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   list.clear();

​                                   for(int j = 0; j < size; j++)

​                                          list.addFirst(47);

​                            }

​                            return loops * size;

​                     }

​              });           

​              qTests.add(new Test<FastTraversalLinkedList<Integer>>("addLast") {

​                     int test(FastTraversalLinkedList<Integer> list, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   list.clear();

​                                   for(int j = 0; j < size; j++)

​                                          list.addLast(47);

​                            }

​                            return loops * size;

​                     }

​              });           

​              qTests.add(new Test<FastTraversalLinkedList<Integer>>("rmFirst") {

​                     int test(FastTraversalLinkedList<Integer> list, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   list.clear();

​                                   list.addAll(new CountingIntegerList(size));

​                                   while(list.size() > 0)

​                                          list.removeFirst();

​                            }

​                            return loops * size;

​                     }

​              });           

​              qTests.add(new Test<FastTraversalLinkedList<Integer>>("rmLast") {

​                     int test(FastTraversalLinkedList<Integer> list, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   list.clear();

​                                   list.addAll(new CountingIntegerList(size));

​                                   while(list.size() > 0)

​                                          list.removeLast();

​                            }

​                            return loops * size;

​                     }

​              });                  

​       }

​       static class ListTester extends Tester<FastTraversalLinkedList<Integer>> {

​              public ListTester(FastTraversalLinkedList<Integer> container, 

​              List<Test<FastTraversalLinkedList<Integer>>> tests) {

​                     super(container, tests);

​              }

​              public static void run(FastTraversalLinkedList<Integer> list, 

​              List<Test<FastTraversalLinkedList<Integer>>> tests) {

​                     new ListTester(list, tests).timedTest();

​              }             

​       }      

​       public static void main(String[] args) {

​              Tester.defaultParams = TestParam.array(

​                     10, 5000, 100, 5000, 1000, 1000, 10000, 200);

​              if(args.length > 0)

​                     Tester.defaultParams = TestParam.array(args);

​              ListTester.run(new FastTraversalLinkedList<Integer>(), tests);

​              Tester.fieldWidth = 12;

​              Tester<FastTraversalLinkedList<Integer>> qTest = 

​              new Tester<FastTraversalLinkedList<Integer>>(

​                     new FastTraversalLinkedList<Integer>(), qTests);

​              qTest.setHeadline("Queue tests");

​              qTest.timedTest();         

​       }

} 

 

 

public class SetPerformance34 {

​       static CountingGenerator.String cgs = new CountingGenerator.String(5);

​       static CountingGenerator.String cgs2 = new CountingGenerator.String(5);

​       static List<Test<Set<String>>> tests = new ArrayList<Test<Set<String>>>();

​              static {

​              tests.add(new Test<Set<String>>("add") {

​                     int test(Set<String> set, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   set.clear();

​                                   for(int j = 0; j < size; j++) 

​                                          set.add(cgs.next());

​                            }

​                            return loops * size;

​                     }

​              });

​              tests.add(new Test<Set<String>>("contains") {

​                     int test(Set<String> set, TestParam tp) {

​                            int loops = tp.loops;

​                            int span = tp.size * 2;

​                            for(int i = 0; i < loops; i++)

​                                   for(int j = 0; j < span; j++)

​                                          set.contains(cgs2.next());

​                            return loops * span;

​                     }

​              });

​              tests.add(new Test<Set<String>>("iterate") {

​                     int test(Set<String> set, TestParam tp) {

​                            int loops = tp.loops * 10;

​                            for(int i = 0; i < loops; i++) {

​                                   Iterator<String> it = set.iterator();

​                                   while(it.hasNext()) it.next();

​                            }

​                            return loops * set.size();

​                     }

​              });

​       }

​       public static void main(String[] args) {

​              if(args.length < 0)

​                     Tester.defaultParams = TestParam.array(args);

​              Tester.fieldWidth = 10;

​              Tester.run(new TreeSet<String>(), tests);

​              Tester.run(new HashSet<String>(), tests);

​              Tester.run(new LinkedHashSet<String>(), tests);      

​       }

}      

 

public class MapPerformance35 {

​       static List<Test<Map<Integer,Integer>>> tests = new ArrayList<Test<Map<Integer,Integer>>>();

​       static {

​              tests.add(new Test<Map<Integer,Integer>>("put") {

​                     int test(Map<Integer,Integer> map, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   map.clear();

​                                   for(int j = 0; j < size; j++) 

​                                          map.put(j, j);

​                            }

​                            return loops * size;

​                     }

​              });

​              tests.add(new Test<Map<Integer,Integer>>("get") {

​                     int test(Map<Integer,Integer> map, TestParam tp) {

​                            int loops = tp.loops;

​                            int span = tp.size * 2;

​                            for(int i = 0; i < loops; i++)

​                                   for(int j = 0; j < span; j++)

​                                          map.get(j);

​                            return loops * span;

​                     }

​              });

​              tests.add(new Test<Map<Integer,Integer>>("iterate") {

​                     int test(Map<Integer,Integer> map, TestParam tp) {

​                            int loops = tp.loops * 10;

​                            for(int i = 0; i < loops; i++) {

​                                   Iterator it = map.entrySet().iterator();

​                                   while(it.hasNext()) it.next();

​                            }

​                            return loops * map.size();

​                     }

​              });

​       }

​       public static void main(String[] args) {

​              if(args.length > 0)

​                     Tester.defaultParams = TestParam.array(args);

​              else

​                     Tester.defaultParams = TestParam.array(10, 500, 100, 500, 500, 100);

​              Tester.run(new SlowMap<Integer,Integer>(), tests);

​              Tester.run(new TreeMap<Integer,Integer>(), tests);

​              Tester.run(new HashMap<Integer,Integer>(), tests);

​              Tester.run(new LinkedHashMap<Integer,Integer>(), tests);

​              Tester.run(new IdentityHashMap<Integer,Integer>(), tests);

​              Tester.run(new WeakHashMap<Integer,Integer>(), tests);

​              Tester.run(new Hashtable<Integer,Integer>(), tests);

​       }

}      

 

  class SlowMap36a<K,V> extends AbstractMap<K,V> { 

​       protected List<MapEntry<K,V>> entryList = new ArrayList<MapEntry<K,V>>();

​       private EntrySet entries = new EntrySet();

​       public Set<Map.Entry<K,V>> entrySet() { return entries; }

​       private class EntrySet extends AbstractSet<Map.Entry<K,V>> {

​              public int size() { return entryList.size(); }

​              public Iterator<Map.Entry<K,V>> iterator() {

​                     return new Iterator<Map.Entry<K,V>>() {

​                            private int index = -1;

​                            public boolean hasNext() {

​                                   return index < entryList.size() - 1; 

​                            }

​                            @SuppressWarnings("unchecked")

​                            public Map.Entry<K,V> next() {

​                                   int i = ++index;

​                                   return entryList.get(i);    

​                            }

​                            public void remove() {

​                                   entryList.remove(index--);          

​                            }                           

​                     };

​              }                           

​       }      

​       public V put(K key, V value) {

​              V oldValue = get(key);              Iterator<MapEntry<K,V>> it = entryList.iterator();

​              while(it.hasNext()) {

​                     MapEntry<K,V> me = it.next();

​                     if(me.getKey().equals(key))

​                            me.setValue(value);

​              }

​              entryList.add(new MapEntry<K,V>(key, value));       

​              return oldValue;

​       }

​       public V get(Object key) {         Iterator<MapEntry<K,V>> it = entryList.iterator();

​              while(it.hasNext()) {

​                     MapEntry<K,V> me = it.next();

​                     if(me.getKey().equals(key))

​                            return me.getValue(); 

​              }

​              return null;

​       }      

}

 class SlowMap36b<K,V> extends SlowMap36a<K,V> { 

​             private List<MapEntry<Integer,V>> hashEntryList = new ArrayList<MapEntry<Integer,V>>();  

​       public List<MapEntry<Integer,V>> hashEntryList() { return hashEntryList; }

​             private final MapEntryKeyComp<K,V> comp1 = new MapEntryKeyComp<K,V>();

​       private final MapEntryKeyComp<Integer,V> comp2 = new MapEntryKeyComp<Integer,V>();

​             @Override

​       public V put(K key, V value) {

​              V oldValue = get(key);              Iterator<MapEntry<K,V>> it = entryList.iterator();

​              while(it.hasNext()) {

​                     MapEntry<K,V> me = it.next();

​                     if(me.getKey().equals(key)) {

​                            me.setValue(value);

​                     }

​              }

​              entryList.add(new MapEntry<K,V>(key, value));

​              hashEntryList.add(new MapEntry<Integer,V>(key.hashCode(), value));

​                           Collections.sort(entryList, comp1);

​              Collections.sort(hashEntryList, comp2);

​              return oldValue;

​       }

​             @Override

​       public V get(Object key) {                      MapEntry<Integer,V> sub = new MapEntry<Integer,V>(key.hashCode(), null); 

​              int i = Collections.binarySearch(hashEntryList, sub, comp2);

​              if(i >= 0) return hashEntryList.get(i).getValue();

​              return null;            

​       }      

}

 class MapEntryKeyComp<K,V> implements Comparator<MapEntry<K,V>> {

​       public int compare(MapEntry<K,V> me1, MapEntry<K,V> me2) {

​              return me1.getKey().hashCode() - me2.getKey().hashCode();

​       }

} 

public class MapPerformance36 {

​       static List<Test<Map<Integer,Integer>>> tests = 

​              new ArrayList<Test<Map<Integer,Integer>>>();

​       static {

​              tests.add(new Test<Map<Integer,Integer>>("put") {

​                     int test(Map<Integer,Integer> map, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   map.clear();

​                                   for(int j = 0; j < size; j++) 

​                                          map.put(j, j);

​                            }

​                            return loops * size;

​                     }

​              });

​              tests.add(new Test<Map<Integer,Integer>>("get") {

​                     int test(Map<Integer,Integer> map, TestParam tp) {

​                            int loops = tp.loops;

​                            int span = tp.size * 2;

​                            for(int i = 0; i < loops; i++)

​                                   for(int j = 0; j < span; j++)

​                                          map.get(j);

​                            return loops * span;

​                     }

​              });

​              tests.add(new Test<Map<Integer,Integer>>("iterate") {

​                     int test(Map<Integer,Integer> map, TestParam tp) {

​                            int loops = tp.loops * 10;

​                            for(int i = 0; i < loops; i++) {

​                                   Iterator it = map.entrySet().iterator();

​                                   while(it.hasNext()) it.next();

​                            }

​                            return loops * map.size();

​                     }

​              });

​       }

​       public static void main(String[] args) {

​              if(args.length > 0)

​                     Tester.defaultParams = TestParam.array(args);

​              else

​                     Tester.defaultParams = TestParam.array(10, 100, 50, 50, 100, 20);

​              print("Tesing SlowMap36a:");

​              SlowMap36a<String,String> m = new SlowMap36a<String,String>();

​              m.putAll(Countries.capitals(15));

​              print("m: " + m);

​              print("m.get(\"BURUNDI\"): " + m.get("BURUNDI"));

​              print("m.entrySet(): " + m.entrySet());

​              print("m.keySet(): " + m.keySet());              

​              print("m.values() = " + m.values());

​              print("Two different maps: ");

​              SlowMap36a<String,String> m2 = new SlowMap36a<String,String>();

​              print("m.equals(m2): " + m.equals(m2)); 

​              m2.putAll(Countries.capitals(15));

​              print("Maps with same entries: ");

​              print("m.equals(m2): " + m.equals(m2));

​              m.clear();

​              print("After m.clear(), m.isEmpty(): " + 

​                     m.isEmpty() + ", m = " + m);       

​              m2.keySet().clear();

​              print("After m2.keySet().clear(), m2.isEmpty(): " 

​                     + m2.isEmpty() + ", m2 = " + m2);

​              print();

​              print("Testing SlowMap36b:");

​              SlowMap36b<String,String> m3 = new SlowMap36b<String,String>();

​              m3.putAll(Countries.capitals(15));

​              print("m3: " + m3);

​              print("m3.get(\"BURUNDI\"): " + m3.get("BURUNDI"));

​              print("m3.entrySet(): " + m3.entrySet());

​              print("m3.hashEntryList(): " + m3.hashEntryList());

​              m3.clear();

​              print("After m3.clear(), m3.isEmpty(): " + 

​                     m3.isEmpty() + ", m3 = " + m3); 

​              m3.keySet().clear();

​              print("After m3.keySet().clear(), m3.isEmpty(): " 

​                     + m3.isEmpty() + ", m3 = " + m3);

​              print();

​              print("Comparative time tests:");         

​              Tester.run(new SlowMap<Integer,Integer>(), tests);

​              Tester.run(new SlowMap17<Integer,Integer>(), tests);

​              Tester.run(new SlowMap36a<Integer,Integer>(), tests);

​              Tester.run(new SlowMap36b<Integer,Integer>(), tests);

​              Tester.run(new HashMap<Integer,Integer>(), tests);

​              Tester.run(new TreeMap<Integer,Integer>(), tests);        

​              Tester.run(new LinkedHashMap<Integer,Integer>(), tests);

​              Tester.run(new IdentityHashMap<Integer,Integer>(), tests);

​              Tester.run(new WeakHashMap<Integer,Integer>(), tests);

​              Tester.run(new Hashtable<Integer,Integer>(), tests);                     

​       }

}      

 

class SimpleHashMap37a<K,V> extends AbstractMap<K,V> {

​                   static final int SIZE = 997;

​                   @SuppressWarnings("unchecked")

​       LinkedList<MapEntry<K,V>>[] buckets =

​              new LinkedList[SIZE];

​       public V put(K key, V value) {

​              V oldValue = null;

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null)

​                     buckets[index] = new LinkedList<MapEntry<K,V>>();

​              LinkedList<MapEntry<K,V>> bucket = buckets[index];

​              MapEntry<K,V> pair = new MapEntry<K,V>(key, value);

​              boolean found = false;

​              ListIterator<MapEntry<K,V>> it = bucket.listIterator();

​              while(it.hasNext()) {

​                     MapEntry<K,V> iPair = it.next();

​                     if(iPair.getKey().equals(key)) {

​                            oldValue = iPair.getValue();

​                            it.set(pair);                         found = true;

​                            break;

​                     }

​              }      

​              if(!found)

​                     buckets[index].add(pair);

​              return oldValue;

​       }

​       public V get(Object key) {

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null) return null;

​              for(MapEntry<K,V> iPair : buckets[index])

​                     if(iPair.getKey().equals(key))

​                            return iPair.getValue();

​              return null;

​       }

​       public Set<Map.Entry<K,V>> entrySet() {

​              Set<Map.Entry<K,V>> set = new HashSet<Map.Entry<K,V>>();

​              for(LinkedList<MapEntry<K,V>> bucket : buckets) {

​                     if(bucket == null) continue;

​                     for(MapEntry<K,V> mpair : bucket)

​                            set.add(mpair);

​              }

​              return set;

​       }

​       public static void main(String[] args) {

​              SimpleHashMap37a<String,String> m =

​                     new SimpleHashMap37a<String,String>();

​              m.putAll(Countries.capitals(25));

​              System.out.println(m);

​              System.out.println(m.get("ERITREA"));

​              System.out.println(m.entrySet());

​       }

}

 

class SimpleHashMap37b<K,V> extends AbstractMap<K,V> {

​                   static final int SIZE = 997;

​                   @SuppressWarnings("unchecked")

​       ArrayList<MapEntry<K,V>>[] buckets =

​              new ArrayList[SIZE];

​       public V put(K key, V value) {

​              V oldValue = null;

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null)

​                     buckets[index] = new ArrayList<MapEntry<K,V>>();

​              ArrayList<MapEntry<K,V>> bucket = buckets[index];

​              MapEntry<K,V> pair = new MapEntry<K,V>(key, value);

​              boolean found = false;

​              ListIterator<MapEntry<K,V>> it = bucket.listIterator();

​              while(it.hasNext()) {

​                     MapEntry<K,V> iPair = it.next();

​                     if(iPair.getKey().equals(key)) {

​                            oldValue = iPair.getValue();

​                            it.set(pair);                         found = true;

​                            break;

​                     }

​              }      

​              if(!found)

​                     buckets[index].add(pair);

​              return oldValue;

​       }

​       public V get(Object key) {

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null) return null;

​              for(MapEntry<K,V> iPair : buckets[index])

​                     if(iPair.getKey().equals(key))

​                            return iPair.getValue();

​              return null;

​       }

​       public Set<Map.Entry<K,V>> entrySet() {

​              Set<Map.Entry<K,V>> set = new HashSet<Map.Entry<K,V>>();

​              for(ArrayList<MapEntry<K,V>> bucket : buckets) {

​                     if(bucket == null) continue;

​                     for(MapEntry<K,V> mpair : bucket)

​                            set.add(mpair);

​              }

​              return set;

​       }

​       public static void main(String[] args) {

​              SimpleHashMap37b<String,String> m =

​                     new SimpleHashMap37b<String,String>();

​              m.putAll(Countries.capitals(25));

​              System.out.println(m);

​              System.out.println(m.get("ERITREA"));

​              System.out.println(m.entrySet());

​       }

}

 

public class MapPerformance37 {

​       static List<Test<Map<Integer,Integer>>> tests = new ArrayList<Test<Map<Integer,Integer>>>();

​       static {

​              tests.add(new Test<Map<Integer,Integer>>("put") {

​                     int test(Map<Integer,Integer> map, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   map.clear();

​                                   for(int j = 0; j < size; j++) 

​                                          map.put(j, j);

​                            }

​                            return loops * size;

​                     }

​              });

​              tests.add(new Test<Map<Integer,Integer>>("get") {

​                     int test(Map<Integer,Integer> map, TestParam tp) {

​                            int loops = tp.loops;

​                            int span = tp.size * 2;

​                            for(int i = 0; i < loops; i++)

​                                   for(int j = 0; j < span; j++)

​                                          map.get(j);

​                            return loops * span;

​                     }

​              });

​              tests.add(new Test<Map<Integer,Integer>>("iterate") {

​                     int test(Map<Integer,Integer> map, TestParam tp) {

​                            int loops = tp.loops * 10;

​                            for(int i = 0; i < loops; i++) {

​                                   Iterator it = map.entrySet().iterator();

​                                   while(it.hasNext()) it.next();

​                            }

​                            return loops * map.size();

​                     }

​              });

​       }

​       public static void main(String[] args) {

​              if(args.length > 0)

​                     Tester.defaultParams = TestParam.array(args);

​              else

​                     Tester.defaultParams = TestParam.array(10, 1000, 100, 1000, 1000, 100);

​              Tester.run(new SimpleHashMap37a<Integer,Integer>(), tests);

​              Tester.run(new SimpleHashMap37b<Integer,Integer>(), tests);

​              Tester.run(new TreeMap<Integer,Integer>(), tests);

​              Tester.run(new HashMap<Integer,Integer>(), tests);

​              Tester.run(new LinkedHashMap<Integer,Integer>(), tests);

​              Tester.run(new IdentityHashMap<Integer,Integer>(), tests);

​              Tester.run(new WeakHashMap<Integer,Integer>(), tests);

​              Tester.run(new Hashtable<Integer,Integer>(), tests);       

​       }

}      

 

public class HashMaps38 {

​       static List<Test<Map<Integer,String>>> tests = 

​              new ArrayList<Test<Map<Integer,String>>>();

​       static CountingGenerator.String cgs = new CountingGenerator.String(5);

​       static {

​              tests.add(new Test<Map<Integer,String>>("put") {

​                     int test(Map<Integer,String> map, TestParam tp) {

​                            int loops = tp.loops;

​                            int size = tp.size;

​                            for(int i = 0; i < loops; i++) {

​                                   map.clear();

​                                   for(int j = 0; j < size; j++) 

​                                          map.put(j, cgs.next());

​                            }

​                            return loops * size;

​                     }

​              });

​              tests.add(new Test<Map<Integer,String>>("get") {

​                     int test(Map<Integer,String> map, TestParam tp) {

​                            int loops = tp.loops;

​                            int span = tp.size * 2;

​                            for(int i = 0; i < loops; i++)

​                                   for(int j = 0; j < span; j++)

​                                          map.get(j);

​                            return loops * span;

​                     }

​              });

​              tests.add(new Test<Map<Integer,String>>("iterate") {

​                     int test(Map<Integer,String> map, TestParam tp) {

​                            int loops = tp.loops * 10;

​                            for(int i = 0; i < loops; i++) {

​                                   Iterator it = map.entrySet().iterator();

​                                   while(it.hasNext()) it.next();

​                            }

​                            return loops * map.size();

​                     }

​              });

​       }

​       public static void main(String[] args) {

​              HashMap<Integer,String> map1 = new HashMap<Integer,String>();          

​              println("map1: " + map1);

​              map1.putAll(new CountingMapData(16));

​              println("map1: " + map1);    

​              HashMap<Integer,String> map2 = new HashMap<Integer,String>(64);

​              println("map2: " + map2);

​              map2.putAll(map1);

​              println("map2: " + map2);

​              HashMap<Integer,String> map3 = new HashMap<Integer,String>(1028);

​              println("map3: " + map3);

​              map2.putAll(map1);

​              println("map3: " + map3);

​              if(args.length > 0)

​                     Tester.defaultParams = TestParam.array(args);

​              else

​                     Tester.defaultParams = TestParam.array(10, 1000, 100, 1000, 1000, 1000);

​              println("Comparative time tests:");             

​              Tester.run(map1, tests);

​              Tester.run(map2, tests);

​              Tester.run(map3, tests);

​       }

} 

 

 class Prime {

​       public static int firstPrimeAfter(int n) {

​              for(int i = n + 1; i > n; i++) {

​                     int factors = 0;

​                     for(int j = 1; j < (i + 2)                       if((i % j) == 0) factors++;

​                     }

​                     if(factors < 2) return i;

​              }

​              return 0;

​       }

}

 

public class SimpleHashMap39<K,V> extends AbstractMap<K,V> {

​                   static final int SIZE = 997;

​             private int capacity = SIZE;

​                   @SuppressWarnings("unchecked")    

​       LinkedList<MapEntry<K,V>>[] buckets = new LinkedList[SIZE];

​       public int capacity() { return capacity; }

​                   @SuppressWarnings("unchecked")

​       private void rehash() {

​              capacity = Prime.firstPrimeAfter(capacity * 2);

​              LinkedList<MapEntry<K,V>>[] oldBuckets = buckets;            

​              buckets = new LinkedList[capacity];

​              for(LinkedList<MapEntry<K,V>> bucket : oldBuckets) {

​                     if(bucket == null) continue;

​                     for(MapEntry<K,V> mpair : bucket)

​                            this.put(mpair.getKey(), mpair.getValue());

​              }                    

​       }

​       public V put(K key, V value) {

​                           if(this.size() > 0.75 * capacity) rehash();

​              V oldValue = null;

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null)

​                     buckets[index] = new LinkedList<MapEntry<K,V>>();

​              LinkedList<MapEntry<K,V>> bucket = buckets[index];

​              MapEntry<K,V> pair = new MapEntry<K,V>(key, value);

​              boolean found = false;

​              ListIterator<MapEntry<K,V>> it = bucket.listIterator();

​              while(it.hasNext()) {

​                     MapEntry<K,V> iPair = it.next();

​                     if(iPair.getKey().equals(key)) {

​                            oldValue = iPair.getValue();

​                            it.set(pair);                         found = true;

​                            break;

​                     }

​              }      

​              if(!found)

​                     buckets[index].add(pair);

​              return oldValue;

​       }

​       public V get(Object key) {

​              int index = Math.abs(key.hashCode()) % SIZE;

​              if(buckets[index] == null) return null;

​              for(MapEntry<K,V> iPair : buckets[index])

​                     if(iPair.getKey().equals(key))

​                            return iPair.getValue();

​              return null;

​       }

​       public Set<Map.Entry<K,V>> entrySet() {

​              Set<Map.Entry<K,V>> set = new HashSet<Map.Entry<K,V>>();

​              for(LinkedList<MapEntry<K,V>> bucket : buckets) {

​                     if(bucket == null) continue;

​                     for(MapEntry<K,V> mpair : bucket)

​                            set.add(mpair);

​              }

​              return set;

​       }

​       public static void main(String[] args) {

​              RandomGenerator.Integer rgi = new RandomGenerator.Integer(10000);

​              print("Testing map m of <String,String>: the basics:");

​              SimpleHashMap39<String,String> m = new SimpleHashMap39<String,String>();

​              m.putAll(Countries.capitals(10));

​              print("m: " + m);

​              print("m.get(\"CHAD\") " + m.get("CHAD"));

​              print("m.size() = " + m.size());

​              print("m.capacity() = " + m.capacity());

​              print("Testing rehash() for a map m2 of <Integer,Integer>:");

​              SimpleHashMap39<Integer,Integer> m2 = new SimpleHashMap39<Integer,Integer>();

​              print("m2: " + m2);

​              print("m2.size() = " + m2.size());

​              print("m2.capacity() = " + m2.capacity());

​              m2.putAll(MapData.map(rgi, rgi, 996));

​              print("after m2.putAll(MapData.map(rgi, rgi, 996): ");

​              print("m2.size() = " + m2.size());

​              print("m2.capacity() = " + m2.capacity());

​              m2.putAll(MapData.map(rgi, rgi, 2000));

​              print("after m2.putAll(MapData.map(rgi, rgi, 2000): ");

​              print("m2.size() = " + m2.size());

​              print("m2.capacity() = " + m2.capacity());

​              m2.putAll(MapData.map(rgi, rgi, 1500));

​              print("after m2.putAll(MapData.map(rgi, rgi, 1500): ");

​              print("m2.size() = " + m2.size());

​              print("m2.capacity() = " + m2.capacity());

​       }

}

 

public class TwoStrings40 implements Comparable<TwoStrings40> {

​       private String first = "";

​       private String second = "";

​       public TwoStrings40(String s1, String s2) {

​              first = s1;

​              second = s2;

​       }

​             public int compareTo(TwoStrings40 ts) {

​              return first.compareTo(ts.first);

​       }

​             public static class Comp2 implements Comparator<TwoStrings40> {

​              public int compare(TwoStrings40 ts1, TwoStrings40 ts2) {

​                     return ts1.second.compareTo(ts2.second);

​              }

​       }

​       public String toString() {

​              return first + " & " + second;

​       }

​       static void printArray(TwoStrings40[] sa) {

​              printnb("(");

​              for(int i = 0; i < sa.length - 1; i++) 

​                     printnb(sa[i] + ", ");

​              print(sa[sa.length - 1] + ")");       

​       }

​       public static void main(String[] args) {

​              RandomGenerator.String rgs = new RandomGenerator.String(4);

​              TwoStrings40[] array = new TwoStrings40[5];

​              List<TwoStrings40> list = new ArrayList<TwoStrings40>();

​              for(int i = 0; i < array.length; i++) {

​                     String s1 = rgs.next();

​                     String s2 = rgs.next();

​                     array[i] = new TwoStrings40(s1, s2);

​                     list.add(new TwoStrings40(s1, s2));

​              }

​              printnb("Array: ");

​              printArray(array);

​              print("List: " + list);

​              Arrays.sort(array);

​              Collections.sort(list, null);

​              print();

​              print("Sorted by first word:");

​              printnb("Array: ");

​              printArray(array);

​              print("List: " + list);

​              TwoStrings40.Comp2 comp = new TwoStrings40.Comp2();

​              Arrays.sort(array, comp);

​              Collections.sort(list, comp);

​              print();

​              print("Sorted by second word:");

​              printnb("Array: ");

​              printArray(array);

​              print("List: " + list);

​       }

}

 

public class TwoStrings41 implements Comparable<TwoStrings41> {

​       private String first = "";

​       private String second = "";

​       public TwoStrings41(String s1, String s2) {

​              first = s1;

​              second = s2;

​       }

​             public int compareTo(TwoStrings41 ts) {

​              return first.compareTo(ts.first);

​       }

​             public static class Comp2 implements Comparator<TwoStrings41> {

​              public int compare(TwoStrings41 ts1, TwoStrings41 ts2) {

​                     return ts1.second.compareTo(ts2.second);

​              }

​       }

​       public String toString() {

​              return first + " & " + second;

​       }

​       static void printArray(TwoStrings41[] sa) {

​              printnb("(");

​              for(int i = 0; i < sa.length - 1; i++) 

​                     printnb(sa[i] + ", ");

​              print(sa[sa.length - 1] + ")");       

​       }

​       public static void main(String[] args) {

​              RandomGenerator.String rgs = new RandomGenerator.String(4);

​              RandomGenerator.Integer rgi = new RandomGenerator.Integer(100);

​              Set<TwoStrings41> set = new HashSet<TwoStrings41>();

​              Map<TwoStrings41,Integer> map = new HashMap<TwoStrings41,Integer>();

​              for(int i = 0; i < 4; i++) {

​                     String s1 = rgs.next();

​                     String s2 = rgs.next();

​                     set.add(new TwoStrings41(s1, s2));

​                     map.put(new TwoStrings41(s1, s2), rgi.next());

​              }

​              print("Set: " + set);

​              print("Map: " + map);

​              print("map.keySet(): " + map.keySet());

​              print("Sorted by first String:");

​              Set<TwoStrings41> treeSet = new TreeSet<TwoStrings41>(set);

​              Map<TwoStrings41,Integer> treeMap = 

​                     new TreeMap<TwoStrings41,Integer>(map);

​              print("TreeSet: " + treeSet);

​              print("TreeMap: " + treeMap);

​              print("Sorted by second String:");

​              TwoStrings41.Comp2 comp = new TwoStrings41.Comp2();

​              Set<TwoStrings41> treeSet2 = 

​                     new TreeSet<TwoStrings41>(comp);

​              Map<TwoStrings41,Integer> treeMap2 = 

​                     new TreeMap<TwoStrings41,Integer>(comp);

​              treeSet2.addAll(treeSet);

​              treeMap2.putAll(treeMap);

​              print("TreeSet2: " + treeSet2);

​              print("TreeMap2: " + treeMap2);        

​       }

}

 

public class TwoStrings42 implements Comparable<TwoStrings42> {

​       private String first = "";

​       private String second = "";

​       public TwoStrings42(String s1, String s2) {

​              first = s1;

​              second = s2;

​       }

​             public int compareTo(TwoStrings42 ts) {

​              return first.compareToIgnoreCase(ts.first);

​       }

​             public static class Comp2 implements Comparator<TwoStrings42> {

​              public int compare(TwoStrings42 ts1, TwoStrings42 ts2) {

​                     return ts1.second.compareToIgnoreCase(ts2.second);

​              }

​       }

​       public String toString() {

​              return first + " & " + second;

​       }

​       static void printArray(TwoStrings42[] sa) {

​              printnb("(");

​              for(int i = 0; i < sa.length - 1; i++) 

​                     printnb(sa[i] + ", ");

​              print(sa[sa.length - 1] + ")");       

​       }

​       public static void main(String[] args) {

​              RandomGenerator.String rgs = new RandomGenerator.String(4);

​              TwoStrings42[] array = new TwoStrings42[5];

​              List<TwoStrings42> list = new ArrayList<TwoStrings42>();

​              for(int i = 0; i < array.length; i++) {

​                     String s1 = rgs.next();

​                     String s2 = rgs.next();

​                     array[i] = new TwoStrings42(s1, s2);

​                     list.add(new TwoStrings42(s1, s2));

​              }

​              printnb("Array: ");

​              printArray(array);

​              print("List: " + list);

​              Arrays.sort(array);

​              Collections.sort(list, null);

​              print();

​              print("Sorted by first word:");

​              printnb("Array: ");

​              printArray(array);

​              print("List: " + list);

​              TwoStrings42.Comp2 comp = new TwoStrings42.Comp2();

​              Arrays.sort(array, comp);

​              Collections.sort(list, comp);

​              print();

​              print("Sorted by second word:");

​              printnb("Array: ");

​              printArray(array);

​              print("List: " + list); 

​       }

}