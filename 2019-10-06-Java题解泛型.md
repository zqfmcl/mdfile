---
title: Java题解泛型
date: 2019-10-06 10:00:00
tags: 题解
 
---

## 第十五章 泛型

class Robot {

​       private String name;

​       public Robot(String name) { this.name = name; }

​       public String toString() { 

​              return name;

​       }

}

 

public class HolderEx2<T> {

​       private T x, y, z;

​       public HolderEx2(T x, T y, T z) { 

​              this.x = x;

​              this.y = y;

​              this.z = z;

​        }

​       public void setX(T x) { this.x = x; }

​       public void setY(T y) { this.y = y; }

​       public void setZ(T z) { this.z = z; }

​       public T getX() { return x; }

​       public T getY() { return y; }

​       public T getZ() { return z; }

​       public String toString() {

​              return x + ", " + y + ", " + z;

​       }

​       public static void main(String[] args) {

​              Robot a = new Robot("bot1");

​              Robot b = new Robot("bot2");

​              Robot c = new Robot("bot3");

​              HolderEx2<Robot> hEx2 = 

​                     new HolderEx2<Robot>(a, b, c);

​              System.out.println("Holding: " + hEx2);

​       }

}

 

class Robot {}

class Amphibian {}

class Vehicle {}

 

class SixTuple<A,B,C,D,E,F>

extends FiveTuple<A,B,C,D,E> {

  public final F sixth;

  public SixTuple(A a, B b, C c, D d, E e, F f) {

​    super(a, b, c, d, e);

​    sixth = f;

  }

  public String toString() {

​    return "(" + first + ", " + second + ", " +

​      third + ", " + fourth + ", " + fifth + ", " + sixth +")";

  }

} 

 

public class SixTupleTest {

​       static SixTuple<Robot, Vehicle, Amphibian, String, Integer, Double> f() {

​              return new SixTuple<Robot, Vehicle, Amphibian, String, Integer, Double>( 

​              new Robot(), new Vehicle(), new Amphibian(), "hi", 47, 11.1);

​       }

​       public static void main(String[] args) {

​              SixTuple<Robot, Vehicle, Amphibian, String, Integer, Double> st = f();

​              System.out.println(st);

​              System.out.println(f());         

​       }

} 

 

interface Selector {

​       boolean end();

​       Object current();

​       void next();

}

 

public class GenericSequence<E> {    

​       private List<E> list = new ArrayList<E>();

​       private int next = 0;

​       public GenericSequence(List<E> list) { this.list = list; }

​       public void add(E e) { list.add(e); }

​       private class SequenceSelector implements Selector {

​              private int i = 0;

​              public boolean end() { return i == list.size(); }

​              public Object current() { return list.get(i); }

​              public void next() { if(i < list.size()) i++; } 

​       }

​       public Selector selector() {

​              return new SequenceSelector();

​       }

​       public static void main(String[] args) {

​              List<String> ls = new ArrayList<String>();

​              GenericSequence<String> gs = new GenericSequence<String>(ls);

​              for(int i = 0; i < 10; i++)

​                     gs.add(Integer.toString(i));

​              Selector selector = gs.selector();

​              while(!selector.end()) {

​                     System.out.print(selector.current() + " ");

​                     selector.next();

​              }

​       }

}

public class LinkedStack5<T> {

​             private class Node {

​              T item;

​              Node next;

​              Node() { item = null; next = null; }

​              Node(T item, Node next) {

​                     this.item = item;

​                     this.next = next;

​              }

​              boolean end() { return item == null && next == null; }

​       }

​       private Node top = new Node();      public void push(T item) {

​              top = new Node(item, top);

​       }

​       public T pop() {

​              T result = top.item;

​              if(!top.end())

​                     top = top.next;

​              return result;

​       }

​       public static void main(String[] args) {

​              LinkedStack5<String> lss = new LinkedStack5<String>();

​              for(String s: "Phasers on stun!".split(" ")) 

​                     lss.push(s);

​              String s;

​              while((s = lss.pop()) != null)

​                     System.out.println(s);

​       }

}

 

public class RandomList6<T> {

​       private ArrayList<T> storage = new ArrayList<T>();

​       private Random rand = new Random(47);

​       public void add(T item) { storage.add(item); }

​       public T select() {

​              return storage.get(rand.nextInt(storage.size()));

​       }

​       public static void main(String[] args) {

​              RandomList6<String> rs = new RandomList6<String>();

​              for(String s : ("The quick brown fox jumped over " +

​                     "the lazy brown dog").split(" "))

​                     rs.add(s);

​              for(int i = 0; i < 11; i++)

​                     System.out.print(rs.select() + " ");

​              System.out.println();

​              RandomList6<Integer> ri = new RandomList6<Integer>();

​              for(int i = 0; i < 11; i++)

​                     ri.add(i);               for(int i = 0; i < 11; i++)

​                     System.out.print(ri.select() + " "); 

​              System.out.println();

​              RandomList6<Pet> rp = new RandomList6<Pet>();

​              for(Pet p : Pets.arrayList(10))

​                     rp.add(p);

​              for(int i = 0; i < 11; i++)

​                     System.out.print(rp.select() + " ");      

​       }

}

 

public class Fibonacci7 implements Generator<Integer>, Iterable<Integer> {

​       private int count = 0;

​       private int m;

​       public Integer next() { return fib(count++); }

​       private int fib(int n) {

​              if(n < 2) return 1;

​              return fib(n - 2) + fib(n - 1);

​       }

​       public Fibonacci7() {}

​       public Fibonacci7(int m) { this.m = m; }

​       public Iterator<Integer> iterator() {

​              return new Iterator<Integer>() {

​                     public boolean hasNext() { return m > 0; }

​                     public Integer next() {

​                            m--;

​                            return Fibonacci7.this.next();

​                     }

​                     public void remove() {                             throw new UnsupportedOperationException();

​                     }

​              };

​       }

 

​       public static void main(String[] args) {

​              Fibonacci7 gen = new Fibonacci7();

​              for(int i = 0; i < 18; i++)

​                     System.out.print(gen.next() + " ");

​              System.out.println();

​              Iterator it = new Fibonacci7(20).iterator();

​              while(it.hasNext())

​                     System.out.print(it.next() + " ");

​       }

​       

}

 

public class StoryCharacterGenerator 

​       implements Generator<StoryCharacter>,  Iterable<StoryCharacter> {

​       private Class[] types = { DarthVader.class, JabbaTheHut.class, 

​              LukeSkywalker.class, Yoda.class };

​       private static Random rand = new Random();

​       public StoryCharacterGenerator() {}

​             private int size = 0;

​       public StoryCharacterGenerator(int sz) { size = sz; }

​       public StoryCharacter next() {

​              try {

​                     return 

​                     (StoryCharacter)types[rand.nextInt(types.length)].newInstance();

​                           } catch(Exception e) {

​                     throw new RuntimeException(e);

​              }

​       }      

​       class StoryCharacterIterator implements Iterator<StoryCharacter> {

​              int count = size;

​              public boolean hasNext() { return count > 0; }

​              public StoryCharacter next() {

​                     count--;

​                     return StoryCharacterGenerator.this.next();

​              }

​              public void remove() {                      throw new UnsupportedOperationException();

​              }

​       }

​       public Iterator<StoryCharacter> iterator() {

​              return new StoryCharacterIterator();

​       }

​       public static void main(String[] args) {

​              StoryCharacterGenerator gen = new StoryCharacterGenerator();

​              for(int i = 0; i < 5; i++)

​                     System.out.println(gen.next());

​              for(StoryCharacter s : new StoryCharacterGenerator(5))

​                     System.out.println(s); 

​       }

}

 

 

 

 

  public class GenericMethods9 {

​       public <T, U, V> void f(T x, U y, V z) {

​              System.out.println(x.getClass().getName() +

​              " " + y.getClass().getName() +

​              " " + z.getClass().getName());

​       }

​       public static void main(String[] args) {

​              GenericMethods9 gm = new GenericMethods9();

​              gm.f("", 1, 1.0);

​              gm.f(1.0F, 'c', gm);

​       }

}

 

  public class GenericMethods10 {

​       public <T, U> void f(T x, U y, Integer z) {

​              System.out.println(x.getClass().getName() +

​              " " + y.getClass().getName() +

​              " " + z.getClass().getName());

​       }

​       public static void main(String[] args) {

​              GenericMethods10 gm = new GenericMethods10();

​              gm.f("", 1, 1);

​              gm.f(1.0F, 'c', 1);

​       }

}

 

class A { public String toString() { return "A"; } }

 

class B { public String toString() { return "B"; } }

 

class C extends B { 

​       public String toString() { return "C"; }

}  

 

public class New11 {

​       public static void main(String[] args) {

​              A a = new A();

​              B b = new B();

​              C c = new C();

​              List<C> lc = New.list();

​              lc.add(new C());

​              Map<A,List<? extends B>> mab = New.map();

​              mab.put(a,lc);

​              LinkedList<B> llb = New.lList();

​              llb.add(new B());

​              Set<A> sa = New.set();

​              sa.add(new A());

​              Queue<B> qb = New.queue();

​              qb.add(new B());

​              println(lc);

​              println(mab);

​              println(llb);

​              println(sa);

​              println(qb);

​       }

}

 

public class LimitsOfInference12 {

​       static void f(Map<Person, List<? extends Pet>> petPeople) {}

​       public static void main(String[] args) {

​              f(New.<Person, List<? extends Pet>>map()); 

​       }

}

 

public class Generators13 {

​       public static <T> Collection<T> fill(Collection<T> coll, Generator<T> gen, int n) {

​              for(int i = 0; i < n; i++) coll.add(gen.next());

​              return coll;

​       }

​       public static <T> List<T> fill(List<T> l, Generator<T> gen, int n) {

​              for(int i = 0; i < n; i++) l.add(gen.next());

​              return l;

​       }

​       public static <T> Queue<T> fill(Queue<T> q, Generator<T> gen, int n) {

​              for(int i = 0; i < n; i++) q.add(gen.next());

​              return q;

​       }

​       public static <T> Set<T> fill(Set<T> s, Generator<T> gen, int n) {

​              for(int i = 0; i < n; i++) s.add(gen.next());

​              return s;

​       }

​             public static <T> LinkedList<T> fill(LinkedList<T> ll, Generator<T> gen, int n) {

​              for(int i = 0; i < n; i++) ll.add(gen.next());

​              return ll;

​       }

​       public static void main(String[] args) {

​              Collection<Coffee> coffee = fill(new ArrayList<Coffee>(), new CoffeeGenerator(), 4);

​              for(Coffee c : coffee) System.out.println(c);

​              Collection<Integer> fnumbers = fill(new ArrayList<Integer>(), new Fibonacci(), 12);

​              for(int i : fnumbers) System.out.print(i + ", ");

​              println();

​              List<Coffee> coffeeList = fill(new ArrayList<Coffee>(), new CoffeeGenerator(), 5);

​              println("List type: " + coffeeList.getClass());

​              println("coffeeList:" + coffeeList);        

​              Queue<Coffee> coffeeQueue = fill(new ArrayDeque<Coffee>(), new CoffeeGenerator(), 5);

​              println("Queue type: " + coffeeQueue.getClass());

​              println("coffeeQueue: " + coffeeQueue); 

​              Set<Coffee> coffeeSet = fill(new HashSet<Coffee>(), new CoffeeGenerator(), 5);

​              println("Set type: " + coffeeSet.getClass());

​              println("coffeeSet: " + coffeeSet);

​              LinkedList<Coffee> coffeeLinkedList = fill(new LinkedList<Coffee>(), new CoffeeGenerator(), 5);

​              println("LinkedList type: " + coffeeLinkedList.getClass());

​              println("coffeeLinkedList: " + coffeeLinkedList);

​       }

}

 

public class BasicGeneratorDemo14  {     

​       public static void main(String[] args) {

​              Generator<CountedObject> gen = 

​                     new BasicGenerator<CountedObject>(CountedObject.class);

​              for(int i = 0; i < 5; i++)

​                     System.out.println(gen.next());

​       }

}

public class TupleTest15 {

​       static TwoTuple<String,Integer> f() {

​              return tuple("hi", 47);

​       }

​       static TwoTuple f2() { return tuple("hi", 47); }

​       static ThreeTuple<Amphibian,String,Integer> g() {

​              return tuple(new Amphibian(), "hi", 47);

​       }

​       static FourTuple<Vehicle,Amphibian,String,Integer> h() {

​              return tuple(new Vehicle(), new Amphibian(), "hi", 47);

​       }

​       static FiveTuple<Vehicle,Amphibian,String,Integer,Double> k() {

​              return tuple(new Vehicle(), new Amphibian(), "hi", 47,

​              11.1);

​       }

​       public static void main(String[] args) {

​              TwoTuple<String,Integer> ttsi = f();

​                           TwoTuple<String,Integer> ttsi2 = f2();

​              System.out.println(ttsi);

​              System.out.println(f2());

​              System.out.println(g());

​              System.out.println(h());

​              System.out.println(k());

​       }

}

 

public class TupleTest16 {

​       static TwoTuple<String,Integer> f() {

​              return tuple("hi", 47);

​       }

​       static TwoTuple f2() { return tuple("hi", 47); }

​       static ThreeTuple<Amphibian,String,Integer> g() {

​              return tuple(new Amphibian(), "hi", 47);

​       }

​       static FourTuple<Vehicle,Amphibian,String,Integer> h() {

​              return tuple(new Vehicle(), new Amphibian(), "hi", 47);

​       }

​       static FiveTuple<Vehicle,Amphibian,String,Integer,Double> k() {

​              return tuple(new Vehicle(), new Amphibian(), "hi", 47,

​              11.1);

​       }

​             static org.greggordon.util.SixTuple<Robot,Vehicle,Amphibian,String,Integer,Double> m() {

​              return tuple(new Robot(), new Vehicle(), new Amphibian(), "hi", 47, 11.1);

​       }

​       public static void main(String[] args) {

​              TwoTuple<String,Integer> ttsi = f();

​              System.out.println(ttsi);

​              System.out.println(f2());

​              System.out.println(g());

​              System.out.println(h());

​              System.out.println(k());

​              System.out.println(m());

​       }

}

 

public class Sets17 {     

​       public static <T> Set<T> union(Set<T> a, Set<T> b) {          

​              try {

​                     if(a instanceof EnumSet) {

​                            Set<T> result = ((EnumSet<T>)a).clone();

​                            result.addAll(b);

​                                return result;

​                            }

​              } catch(Exception e) {

​                     throw new RuntimeException(e);

​              }

​              Set<T> result = new HashSet<T>(a);

​                  result.addAll(b);

​                  return result;

​       }      

​      public static <T> Set<T> intersection(Set<T> a, Set<T> b) {

​              try {

​                     if(a instanceof EnumSet) {

​                            Set<T> result = ((EnumSet<T>)a).clone();

​                            result.retainAll(b);

​                                return result;

​                            }

​              } catch(Exception e) {

​                     throw new RuntimeException(e);

​              }

​                  Set<T> result = new HashSet<T>(a);

​                  result.retainAll(b);

​                  return result;

​      }      

​           public static <T> Set<T>  difference(Set<T> superset, Set<T> subset) {

​              try {

​                     if(superset instanceof EnumSet) {

​                            Set<T> result = ((EnumSet<T>)superset).clone();

​                            result.removeAll(subset);

​                                return result;

​                            }

​              } catch(Exception e) {

​                     throw new RuntimeException(e);

​              }

​                  Set<T> result = new HashSet<T>(superset);

​                  result.removeAll(subset);

​                  return result;

​      }

​           public static <T> Set<T> complement(Set<T> a, Set<T> b) {

​                  return difference(union(a, b), intersection(a, b));

​      }

​       public static void main(String[] args) {

​              Set<Watercolors> set1 =

​                     EnumSet.range(BRILLIANT_RED, VIRIDIAN_HUE);

​              Set<Watercolors> set2 =

​                     EnumSet.range(CERULEAN_BLUE_HUE, BURNT_UMBER);

​              print("set1: " + set1);

​              print("set2: " + set2);

​              print("union(set1, set2): " + union(set1, set2));

​              Set<Watercolors> subset = intersection(set1, set2);

​              print("intersection(set1, set2): " + subset);

​              print("difference(set1, set2): " + 

​                     difference(set1, set2));

​              print("difference(set2, subset): " + 

​                     difference(set2, subset));

​              print("complement(set1, set2): " + 

​                     complement(set1, set2));

​       }

} 

 

class BigFish {

​       private static long counter = 0;

​       private final long id = ++counter;

​       private BigFish() {}

​       public String toString() {

​              return "BigFish" + id;

​       }

​       public static Generator<BigFish> generator() {

​              return new Generator<BigFish>() {

​                     public BigFish next() {

​                            return new BigFish();

​                     }      

​              };

​       }

}

 

class LittleFish {

​       private static long counter = 0;

​       private final long id = ++counter;

​       private LittleFish() {}

​       public String toString() {

​              return "LittleFish" + id;

​       }

​       public static Generator<LittleFish> generator =

​              new Generator<LittleFish>() {

​                     public LittleFish next() {

​                            return new LittleFish();

​                     }

​              };

}

 

public class Ocean18 {

​       public static void eat(BigFish bf, LittleFish lf) {

​              System.out.println(bf + " eats " + lf);

​       }

​       public static void main(String[] args) {

​              Random rand = new Random();

​              List<BigFish> hunters = new ArrayList<BigFish>();

​              Generators.fill(hunters, BigFish.generator(), 3);

​              Queue<LittleFish> school = new LinkedList<LittleFish>();

​              Generators.fill(school, LittleFish.generator, 15);

​              for(LittleFish f : school)

​                     eat(hunters.get(rand.nextInt(hunters.size())), f);

​       }

}

 

 

class Item {

​       private final int id;

​       private String description;

​       private String destination;

​       private double price;

​       public Item(int idNumber, String what, String whereTo, double price) {

​              id = idNumber;

​              description = what;

​              destination = whereTo;

​              this.price = price;

​              System.out.println(toString());

​       } 

​       public String toString() {

​              return id + ", " + description + ", " + "$" + price + ", to: " +

​                     destination;

​       }

​       public void priceChange(double change) {

​              price += change;

​       }

​       public static Generator<Item> generator = 

​              new Generator<Item>() {

​                     private Random rand = new Random();

​                     public Item next() {

​                            return new Item(rand.nextInt(1000), 

​                            "Very nice ... ",  "Destination: ...", 

​                            Math.round(rand.nextDouble() * 1000.0)); 

​                     }

​              };

}

 

class Shelf extends ArrayList<Item> {

​       public Shelf(int nItems) {

​              Generators.fill(this, Item.generator, nItems);

​       }

}

 

class StorageArea extends ArrayList<Shelf> {

​       public StorageArea(int nShelves, int nItems) {

​              for(int i = 0; i < nShelves; i++)

​                     add(new Shelf(nItems));

​       }

}

 

class Deck extends ArrayList<StorageArea> {

​       public Deck(int nStorageAreas, int nShelves, int nItems) {

​              for(int i = 0; i < nStorageAreas; i++)

​                     add(new StorageArea(nShelves, nItems));

​       }

}

 

class Office {}

 

public class CargoShip19 extends ArrayList<Deck> {

​       private Office office;

​       public CargoShip19(int nDecks, int nStorageAreas, int nShelves, int nItems) {

​              for(int i = 0; i < nDecks; i++)

​                     add(new Deck(nStorageAreas, nShelves, nItems));

​       }      

​       public String toString() {

​              StringBuilder result = new StringBuilder();

​              for(Deck d : this)

​                     for(StorageArea sa : d)

​                            for(Shelf s : sa)

​                                   for(Item i : s) {

​                                          result.append(i);

​                                          result.append('\n');

​                                   }

​              return result.toString();

​       }

​       public static void main(String[] args) {

​              System.out.println(new CargoShip19(3, 4, 3, 10));

​       }

}

interface A {

​       void f();

​       void g();

}

 

class A3 implements A {

​       public void f() { System.out.println("A3.f()"); }

​       public void g() { System.out.println("A3.g()"); }

​       public void h() { System.out.println("A3.h()"); }

}

 

class G {

​       public static <T extends A> void j(T x) { 

​              x.f();

​              x.g();

​       }

}

 

public class Ex20 {

​       public static void main(String[] args) {

​              A3 a3 = new A3();

​              G.j(a3);    

​       }

}

public class ClassTypeCapture21<T> {

​       Class<?> kind;

​       Map<String,Class<?>> map;

​       public ClassTypeCapture21(Class<?> kind) {

​              this.kind = kind;

​       }

​       public ClassTypeCapture21(Class<?> kind, Map<String,Class<?>> map) {

​              this.kind = kind;

​              this.map = map;

​       }

​       public boolean f(Object arg) {

​              return kind.isInstance(arg);

​       }

​       public void addType(String typename, Class<?> kind) {

​              map.put(typename, kind);

​       }

​       public Object createNew(String typename) 

​              throws IllegalAccessException, InstantiationException {

​              if(map.containsKey(typename))

​                     return map.get(typename).newInstance();                

​              System.out.println(typename + " class not available");

​              return null;

​       }

​       public static void main(String[] args) {

​              ClassTypeCapture21<Building> ctt1 = new ClassTypeCapture21<Building>(Building.class);

​              println(ctt1.f(new Building()));

​              println(ctt1.f(new House()));

​              ClassTypeCapture21<House> ctt2 = new ClassTypeCapture21<House>(House.class);

​              println(ctt2.f(new Building()));

​              println(ctt2.f(new House()));

​              ClassTypeCapture21<Building> ct = 

​              new ClassTypeCapture21<Building>(Building.class, new HashMap<String, Class<?>>());

​              ct.addType("House", House.class);

​              ct.addType("Building", Building.class);

​              println("ct.map = " + ct.map);

​              try {

​                     Building b = (Building)ct.createNew("Building");

​                     House h = (House)ct.createNew("House");

​                     print("b.getClass().getName(): ");

​                     println(b.getClass().getName());

​                     print("h.getClass().getName(): ");

​                     println(h.getClass().getName());

​                     print("House h is instance House: ");

​                     println(h instanceof House);

​                     print("House h is instance of Building: ");

​                     println(h instanceof Building);

​                     print("Building b is instance of House: ");

​                     println(b instanceof House);

​                     ct.createNew("String");             } catch(IllegalAccessException e) {

​                     println("IllegalAccessException in main");

​              } catch(InstantiationException e) {

​                     println("InstantiationException in main");

​              }             

​       }

}

 

class Building {}

class House extends Building {

​       private String location;

​       private Integer area;

​       public House() { location = null; }

​       public House(Integer area) { this.area = area; }

​       public House(String location) {

​              this.location = location;

​       }

​       public House(String location, Integer area) {

​              this.location = location;

​              this.area = area;

​       }

​       public String toString() {

​              return "House" + ((location == null) ? "" :  " in " + location) +

​                     ((area != null) ? (", "+ area + " sqft") : "");

​       }

}

 

public class ClassTypeCreator22<T> {

​       Class<?> kind;

​       public ClassTypeCreator22(Class<?> kind) {

​              this.kind = kind;

​       }

​       public Object createNew(String typename) 

​              throws   IllegalAccessException, 

​                     InstantiationException, 

​                     ClassNotFoundException {

​              return Class.forName(typename).newInstance();

​       }      

​             public Object createNew(String typename, Object... args) 

​              throws   IllegalAccessException, 

​                     InstantiationException, 

​                     ClassNotFoundException,

​                     NoSuchMethodException,

​                     InvocationTargetException {

​              switch(args.length) {

​              case 1 : return Class.forName(typename).getConstructor(args[0].getClass()).newInstance(args[0]);

​              case 2 : return Class.forName(typename).getConstructor(args[0].getClass(), args[1].getClass()).

​                     newInstance(args[0], args[1]);

​              }

​              return null;

​       }

​       public static void main(String[] args) {

​              ClassTypeCreator22<Building> ctcb = new ClassTypeCreator22<Building>(Building.class);

​              ClassTypeCreator22<House> ctch = new ClassTypeCreator22<House>(House.class);

​              try {

​                     Building b = (Building)ctcb.createNew("Building");

​                                         println("House constructors:");

​                     Constructor[] ctors = House.class.getConstructors();

​                     for(Constructor ctor : ctors) println(ctor);

​                                         House h = (House)ctch.createNew("House", "Hawaii");

​                     House h2 = (House)ctch.createNew("House", 3000);

​                     House h3 = (House)ctch.createNew("House", "Manila", 5000);

​                     println("Constructed House objects:");

​                     println(h);

​                     println(h2);

​                     println(h3);

​              } catch(IllegalAccessException e) {

​                     println("IllegalAccessException in main");

​              } catch(InstantiationException e) {

​                     println("InstantiationException in main");

​              } catch(ClassNotFoundException e) {

​                     println("ClassNotFoundException in main");

​              } catch(NoSuchMethodException e) {

​                     println("NoSuchMethodException in main");

​              } catch(InvocationTargetException e) {

​                     println("InvocationTargetException in main");

​              }             

​       }

}

 

 

 

 

 interface FactoryI<T> {

​       T create(Integer i);

}

 

class Foo2<T> {

​       private T x;

​       public void get() { System.out.println(x); }

​       public <F extends FactoryI<T>> Foo2(F factory, Integer i) {

​              x = factory.create(i);

​       }

}

 

class IntegerFactory implements FactoryI<Integer> {

​       public Integer create(Integer i) {

​              return new Integer(i);

​       }

}

 

class Widget {

​       int i;

​       public static class Factory implements FactoryI<Widget> {

​              public Widget create(Integer i) {

​                     Widget w = new Widget();

​                     w.i = i;

​                     return w;

​              }

​       }

​       public String toString() {

​              return "Widget " + i;     

​       }

}

 

public class FactoryConstraint23 {

​       public static void main(String[] args) {

​              Foo2 f1 = new Foo2<Integer>(new IntegerFactory(), 1);

​              Foo2 f2 = new Foo2<Widget>(new Widget.Factory(), 2);

​              f1.get();

​              f2.get();

​              }

}

 

interface Factory<T> {

​       T create();

}

 

class Building {}

 

class House extends Building {}

 

class BuildingFactory implements Factory<Building> {

​       public Building create() {

​              return new Building();

​       }

}

 

class HouseFactory implements Factory<House> {

​       public House create() {

​              return new House();

​       }

}

 

public class ClassTypeCapture24<T> {

​       Class<?> kind;

​       public ClassTypeCapture24(Class<?> kind) {

​              this.kind = kind;

​       }

​       Map<String,Factory> map;  

​       public ClassTypeCapture24(Class<?> kind, Map<String,Factory> map) {

​              this.kind = kind;

​              this.map = map;

​       }

​       public boolean f(Object arg) {

​              return kind.isInstance(arg);

​       }

​       public void addType(String typename, Factory factory) {

​              map.put(typename, factory);

​       }

​       public Object createNew(String typename) 

​              throws IllegalAccessException, InstantiationException {

​              if(map.containsKey(typename))

​                     return map.get(typename).create();                  

​              System.out.println(typename + " class not available");

​              return null;

​       }

​       public static void main(String[] args) {

​              ClassTypeCapture24<Building> ctt1 = 

​                     new ClassTypeCapture24<Building>(Building.class);

​              println(ctt1.f(new Building()));

​              println(ctt1.f(new House()));

​              ClassTypeCapture24<House> ctt2 = 

​                     new ClassTypeCapture24<House>(House.class);

​              println(ctt2.f(new Building()));

​              println(ctt2.f(new House()));

​              ClassTypeCapture24<Building> ct = 

​              new ClassTypeCapture24<Building>(

​                     Building.class, new HashMap<String,Factory>());

​              ct.addType("House", new HouseFactory());

​              ct.addType("Building", new BuildingFactory());

​              println("ct.map = " + ct.map);

​              try {

​                     Building b = (Building)ct.createNew("Building");

​                     House h = (House)ct.createNew("House");

​                     print("b.getClass().getName(): ");

​                     println(b.getClass().getName());

​                     print("h.getClass().getName(): ");

​                     println(h.getClass().getName());

​                     print("House h is instance House: ");

​                     println(h instanceof House);

​                     print("House h is instance of Building: ");

​                     println(h instanceof Building);

​                     print("Building b is instance of House: ");

​                     println(b instanceof House);

​                     ct.createNew("String");             } catch(IllegalAccessException e) {

​                     println("IllegalAccessException in main");

​              } catch(InstantiationException e) {

​                     println("InstantiationException in main");

​              }             

​       }

}

interface A {}

 

interface B {} 

 

class C implements A, B {

​       public String toString() { return "C"; }

}

 

public class Ex25 {

​       <T extends A> void a(T t) { System.out.println("a(" + t + ")"); }

​       <T extends B> void b(T t) { System.out.println("b(" + t + ")"); }

​       public static void main(String[] args) {

​              C c = new C();

​              Ex25 ex = new Ex25();

​              ex.a(c);

​              ex.b(c);

​       }

}

 

 public class Ex26 {

​       public static void main(String[] args) {

​              Number[] numbers = new Integer[3];

​              numbers[0] = new Integer(0);

​              numbers[1] = new Integer(1);

​              numbers[2] = new Integer(2);

​                                        try {                     numbers[1] = new Double(3.4);

​              } catch(Exception e) {

​                     System.out.println(e);

​              }

​              for(Number n : numbers)

​                     System.out.println(n);

​                                                                               for(Number n : numbers)

​                     System.out.println(n.getClass().getSimpleName());    

​       }      

}

 

 

 

 

​    import java.util.*;

 

public class Ex27 {

​       public static void main(String[] args) {

​                                        List<? extends Number> nlist = new ArrayList<Integer>();

​                                        nlist.add(null);             Number x = nlist.get(0);            System.out.println(nlist);

​       }      

}

 

public class Ex28 {

​       class Generic1<T> {

​              T t;

​              void take(T t) { this.t = t; }

​       }

​             class Generic2<T> {

​              T t;

​              T give() { return t; }

​       }

​       <T> void contra(Generic1<? super T> g1t, T t) {

​              g1t.take(t);

​       }

​       <T> T co(Generic2<? extends T> g2t) {

​              return g2t.give();

​       }

​       public static void main(String[] args) {

​              Ex28 e28 = new Ex28();

​              e28.contra(e28.new Generic1<Pet>(), new Cat("kitty"));

​              e28.co(e28.new Generic2<Pet>());             

​       }

}

public class Ex29 {

​       static void f1(Holder<List<?>> holder) {

​              println("Calling methods for the Holder: ");

​              println("holder: " + holder);

​              println("holder.get(): " + holder.get());

​              println("Calling holder.set(Arrays.asList(1,2,3)");

​              holder.set(Arrays.asList(1,2,3));

​              println("holder.get(): " + holder.get());

​              int[] ia = {1,2,3};

​              println("int[] ia = {1,2,3}");

​              println("holder.equals(ia): " + holder.equals(ia));

​              List iaList = Arrays.asList(ia);

​              println("List iaList = Arrays.asList(ia)");

​              println("holder.equals(iaList): " + holder.equals(iaList));

​              List<Integer> l = new ArrayList<Integer>();

​              for(int i = 1; i < 4; i++) l.add(i);

​              println("l = List<Integer>() and add 1,2,3");

​              println("holder.equals(l): " + holder.equals(l));

​              println();

​                                   

​              println("Calling methods for the List: ");

​              println("holder.get(): " + holder.get());

​              println("holder.get().getClass(): " + holder.get().getClass());

​                                                     List<?> list = holder.get();

​              println("list: " + list); 

​                           List list1 = holder.get();                                       println("list1.getClass(): " + list1.getClass());

​              println("list.equals(list1): " + list.equals(list1));

​                           println("list.contains(1): " + list.contains(1));              

​              Collection<Integer> c = new HashSet<Integer>();

​              for(int i = 1; i < 4; i++) c.add(i);

​              println("list.containsAll(c): " + list.containsAll(c));       

​              println("list.equals(c): " + list.equals(c));

​              println("list = " + list);

​              println("c = " + c);

​              println("c.getClass(): " + c.getClass());              println("list.get(0) = " + list.get(0));

​              println("list.hashCode() = " + list.hashCode());

​              println("list.indexOf(2) = " + list.indexOf(2));      

​              ListIterator li = list.listIterator();

​              println("After ListIterator li = list.listIterator():");

​              println("li.next() = " + li.next());

​                                                                                            println("list.size() = " + list.size());

​              println("list.subList(1,2) = " + list.subList(1,2));

​              Object[] oa = list.toArray();

​              println("After Object[] oa = list.toArray():");

​              print("oa = ");

​              for(Object o : oa) print(o + " ");

​              println(); 

​                                        Number[] na = list.toArray(new Number[3]);

​              println("After Number[] na = list.toArray(new Number[3]):");

​              print("na = ");

​              for(Number n : na) print(n + " ");

​              println();

​       }

​       static void f2(List<Holder<?>> list) {

​              println("Calling methods for the List: ");

​              println("list = " + list);

​              println("Adding Integer, String, Double");

​              list.add(new Holder<Integer>(1));

​              list.add(new Holder<String>("two"));

​              list.add(new Holder<Double>(3.0));

​              println("list = " + list);

​              println("Elements of list: ");

​              for(Holder h : list) 

​                     println("h.get() = " + h.get());

​              println("Adding Float");

​              list.add(3, new Holder<Float>(4.0f));

​              println("list = " + list);

​              println("Elements of list: ");

​              for(Holder h : list) 

​                     println("h.get() = " + h.get());

​              println("list.clear()");

​              list.clear();

​              println("list = " + list);

​              Collection<Holder<?>> c = 

​                     new ArrayList<Holder<?>>();

​              c.add(new Holder<String>("one"));

​              c.add(new Holder<Float>(2.0f));

​              c.add(new Holder<Double>(3.0));

​              list.addAll(c);

​              println("Adding String, Float, Double");

​              println("list = " + list);

​              println("Elements of list: ");

​              for(Holder h : list) 

​                     println("h.get() = " + h.get().getClass().getSimpleName() 

​                            + " " + h.get());

​              list.add(3, new Holder<String>("four"));

​              println("Elements of list: ");

​              for(Holder h : list) 

​                     println("h.get() = " + h.get().getClass().getSimpleName() 

​                            + " " + h.get());

​              Object listClone = ((ArrayList)list).clone();

​              println("((ArrayList)list).clone() = " +  listClone);

​              println("((ArrayList)list).clone().getClass() = " +

​                     ((ArrayList)list).clone().getClass());

​                                        println("Replacing element with h4, new Holder<Integer>(4)");

​              Holder<Integer> h4 = new Holder<Integer>(4);

​              list.set(3, h4);

​              println("Elements of list Holders: ");

​              for(Holder h : list) 

​                     println(h.get().getClass().getSimpleName() 

​                            + " " + h.get());

​              println("list.contains(list.set(3, h4): " + 

​                            list.contains(list.set(3, h4)));

​              println("list.contains(4): " + list.contains(4));

​              println("list.contains(h4): " + list.contains(h4));

​              println("Adding null member to list");        

​              list.add(null);

​              println("list.contains(null): " + list.contains(null));

​              println("list.get(0).get(): " + list.get(0).get());

​              println("list.indexOf(h4) = " + list.indexOf(h4));

​              println("list.indexOf(null) = " + list.indexOf(null));

​              println("list.isEmpty(): " + list.isEmpty());

​              println("list.lastIndexOf(null) = " + list.lastIndexOf(null));  

​              println("Removing index 0");

​              list.remove(0);

​              println("Elements of list Holders: ");

​              for(Holder h : list) {

​                     if(h == null) println("null");

​                     else

​                     println(h.get().getClass().getSimpleName() 

​                            + " " + h.get());      

​                     }

​              println("Removing null");

​              println("Elements of list Holders: ");

​              for(Holder h : list) {

​                     if(h == null) println("null");

​                     else

​                     println(h.get().getClass().getSimpleName() 

​                            + " " + h.get());      

​                     }

​                                        println("list.size() = " + list.size());

​              Object[] oa = list.toArray();

​              print("list.toArray() = ");

​              for(int i = 0; i < oa.length; i++) 

​                     print(oa[i] + " ");

​              println();

​              Holder[] ha = ((ArrayList<Holder<?>>)list).toArray(new Holder[4]);

​              println("(ArrayList<Holder<?>>list).toArray(new Holder[4]) = ");

​              for(int i = 0; i < ha.length; i++)

​                     print(ha[i] + " ");

​              println();

​              println("Holder[4] Holders are holding: ");

​              for(Holder h : ha) {

​                     if(h == null) println("null");

​                     else println(h.get());

​              }

​              println();         

​       

​              println("Calling methods for the Holder: ");

​              println("list = " + list);

​              print("Three Holders (one null) in list:");

​              for(int i = 0; i < list.size(); i++) {

​                     if(list.get(i) == null) println("null"); 

​                     else

​                     println(list.get(i).getClass().getSimpleName());

​              }

​              list.remove(3);

​              println("Holders are holding:");

​              for(Holder h : list) println(h.get());

​              Holder<?> h1 = list.get(0);

​              Holder<?> h2 = list.get(1);

​              Holder<?> h3 = list.get(2);

​              println(list.get(0).getClass() + ": " 

​                     + list.get(0).get().getClass().getSimpleName() + ", " 

​                     + list.get(0).get());

​              println(list.get(1).getClass() + ": " 

​                     + list.get(1).get().getClass().getSimpleName() + ", " 

​                     + list.get(1).get());

​              println(list.get(2).getClass() + ": " 

​                     + list.get(2).get().getClass().getSimpleName() + ", "

​                     + list.get(2).get());

​                                                     

​       }      

​       public static void main(String[] args) {

​              println("new Holder<List<?>> holder");

​              f1(new Holder<List<?>>());

​              println();

​              println("List<Holder<?>> list = new ArrayList<Holder<?>>();");

​              List<Holder<?>> list = new ArrayList<Holder<?>>();

​              f2(list);

​       }

}

public class Holders30 {

​       public static void main(String[] args) {

​              Holder<Character> charHolder = new Holder<Character>();

​              Holder<Byte> byteHolder = new Holder<Byte>();

​              Holder<Short> shortHolder = new Holder<Short>();

​              Holder<Integer> intHolder = new Holder<Integer>();

​              Holder<Long> longHolder = new Holder<Long>();

​              Holder<Float> floatHolder = new Holder<Float>();

​              Holder<Double> doubleHolder = new Holder<Double>();

​                           charHolder.set('a');

​              print(charHolder.get() + ", ");

​              println(charHolder.get().getClass());

​              char c = charHolder.get();

​              println("char c = charHolder.get() = " + c);

​              byte b = 1;

​              byteHolder.set(b);

​              print(byteHolder.get() + ", ");

​              println(byteHolder.get().getClass());

​              byte bb = byteHolder.get();

​              println("byte bb = byteHolder.get() = " + bb);                

​              short s = 1;

​              shortHolder.set(s);

​              print(shortHolder.get() + ", ");

​              println(shortHolder.get().getClass());

​              short ss = shortHolder.get();

​              println("short ss = shortHolder.get() = " + ss);

​              intHolder.set(1);

​              print(intHolder.get() + ". ");

​              println(intHolder.get().getClass());

​              int i = intHolder.get();

​              println("int i = intHolder.get() = " + i);

​              long l = 2;

​              longHolder.set(l);

​              print(longHolder.get() + ", ");

​              println(longHolder.get().getClass());

​              long ll = longHolder.get();

​              println("long ll = longHolder.get() = " + ll);

​              float f = 1f;

​              floatHolder.set(f);

​              print(floatHolder.get() + ", ");

​              println(floatHolder.get().getClass());

​              float ff = floatHolder.get();

​              println("float ff = floatHolder.get() = " + ff);

​              double d = 1.1;

​              doubleHolder.set(d);

​              print(doubleHolder.get() + ", ");

​              println(doubleHolder.get().getClass());

​              double dd = doubleHolder.get();

​              println("double dd = doubleHolder.get() = " + dd);        

​       }             

​              

}

 

 

 

 

  interface Payable { float getPay(); }

 

class Employee implements Payable {

​       private float weeklyPay;

​       public float getPay() {

​              return weeklyPay;

​       }             

} 

 

class Hourly extends Employee {

​       public String name;

​       protected float hourlyPay;

​       public int hoursWorked;

​       Hourly(String s, float pay, int hours) {

​              name = s;

​              hourlyPay = pay;

​              hoursWorked = hours;

​       }

​       public float getPay() {

​              System.out.println("Pay " + name + 

​                     " $" + hourlyPay * hoursWorked);

​              return hourlyPay * hoursWorked;      

​       }

}

 

public class MultipleInterfaceVariants31 {

​       public static void main(String[] args) {

​              Hourly h = new Hourly("Joe", 50.00f, 40);

​              h.getPay();

​       }

}

class FixedSizeStack<T> {

​       private int index = 0;

​       private Object[] storage;

​       public FixedSizeStack(int size) {

​              storage = new Object[size];

​       }

​       int getIndex() { return index; } 

​       public void push(T item) { storage[index++] = item; }

​       @SuppressWarnings("unchecked")

​       public T pop() { return (T)storage[--index]; }

}

 

public class GenericCast32 {

​       public static final int SIZE = 10;

​       public static void main(String[] args) {

​              FixedSizeStack<String> strings = 

​                     new FixedSizeStack<String>(SIZE);

​              for(String s : "A B C D E F G H I J".split(" "))

​                     strings.push(s);

​                                        if(strings.getIndex() < SIZE) strings.push("oops");

​              for(int i = 0; i < SIZE; i++) {

​                     String s = strings.pop();

​                     System.out.print(s + " ");

​              }                                  

​       }             

​              

}

 

class VariableSizeStack<T> { 

​       private ArrayList<T> storage = new ArrayList<T>();

​           public int count() {

​              return storage.size();

​           } 

​           public void push(T item) { 

​              storage.add(item); 

​           }

​           public T pop() { 

​              return storage.remove(storage.size() - 1);

​           }

}

 

public class GenericCast33 {

​      public static void main(String[] args) {

​               VariableSizeStack<String> strings =

​                          new VariableSizeStack<String>();

​               for(String s : "A B C D E F G H I J".split(" "))

​                          strings.push(s);

​              int currentCount = strings.count();

​              for(int i = 0; i < currentCount; i++) {

​                   String s = strings.pop();

​                   System.out.print(s + " ");

​              }                }      }

abstract class SelfBoundedType<T extends SelfBoundedType<T>> {

​       abstract T f(T arg);

​       T g(T arg) { 

​              System.out.println("g(T arg)");

​              return f(arg); 

​       }      

}

 

class D extends SelfBoundedType<D> {

​       D f(D arg) { 

​              System.out.println("f(D arg)");

​              return arg; 

​       }      

}

 

 

public class Ex34 {

​       public static void main(String[] args) {

​              D d = new D();

​              d.f(d).g(d);

​       }

}

 

public class CheckedList35 {

​       @SuppressWarnings("unchecked")

​       static void oldStyleMethod(List probablyMocha) {

​              probablyMocha.add(new Breve());

​       }

​       public static void main(String[] args) {

​              List<Mocha> mocha1 = new ArrayList<Mocha>();

​              oldStyleMethod(mocha1);                List<Mocha> mocha2 = Collections.checkedList(

​                     new ArrayList<Mocha>(), Mocha.class);

​              try {

​                     oldStyleMethod(mocha2);                } catch(Exception e) {

​                     System.out.println(e);

​              }

​                           List<Coffee> coffee = Collections.checkedList(

​                     new ArrayList<Coffee>(), Coffee.class);

​              coffee.add(new Mocha());

​              coffee.add(new Breve());             

​       }

}      

 

 

 

 

​    import java.util.*;

 

interface Processor<T,E extends Exception, E2 extends Exception> {

​       void process(List<T> resultCollector) throws E,E2;

}

 

class ProcessRunner<T,E extends Exception, E2 extends Exception> 

extends ArrayList<Processor<T,E,E2>> {

​       List<T> processAll() throws E,E2 {

​              List<T> resultCollector = new ArrayList<T>();

​              for(Processor<T,E,E2> processor : this)

​                     processor.process(resultCollector);

​              return resultCollector;

​       }

}

 

class Failure1 extends Exception {}

 

class Failure3 extends Exception {}

 

class Processor1 implements Processor<String,Failure1,Failure3> {

​       static int count = 3;

​       public void

​       process(List<String> resultCollector) throws Failure1, Failure3 {

​              if(count-- > 1)

​                     resultCollector.add("Hep!");

​              else

​                     resultCollector.add("Ho!");

​              if(count < 0)

​                     throw new Failure1();

​              if(count < -1)

​                     throw new Failure3();

​       }

}

 

class Processor1b implements Processor<String,Failure1,Failure3> {

​       static int count = 3;

​       public void

​       process(List<String> resultCollector) throws Failure1, Failure3 {

​              if(count-- > 1)

​                     resultCollector.add("Hep!");

​              else

​                     resultCollector.add("Ho!");

​              if(count < 0)

​                     throw new Failure1();

​              if(count == 1)

​                     throw new Failure3();

​       }

}

 

class Failure2 extends Exception {}

 

class Processor2 implements Processor<Integer,Failure2,Failure3> {

​       static int count = 2;

​       public void

​       process(List<Integer> resultCollector) throws Failure2, Failure3 {

​              if(count-- == 0)

​                     resultCollector.add(47);

​              else {

​                     resultCollector.add(11);

​              }

​              if(count < 0)

​                     throw new Failure2();

​              if(count < -1)

​                     throw new Failure3();

​       }

}

 

class Processor2b implements Processor<Integer,Failure2,Failure3> {

​       static int count = 2;

​       public void

​       process(List<Integer> resultCollector) throws Failure2, Failure3 {

​              if(count-- == 0)

​                     resultCollector.add(47);

​              else {

​                     resultCollector.add(11);

​              }

​              if(count < 0)

​                     throw new Failure2();

​              if(count == 1)

​                     throw new Failure3();

​       }

}

 

public class ThrowGenericException36 {

​       public static void main(String[] args) {

​              ProcessRunner<String,Failure1,Failure3> runner =

​                     new ProcessRunner<String,Failure1,Failure3>();

​              for(int i = 0; i < 3; i++)

​                     runner.add(new Processor1());

​              try {

​                     System.out.println(runner.processAll());

​              } catch(Failure1 e) {

​                     System.out.println(e);

​              } catch(Failure3 e) {

​                     System.out.println(e);

​              }

​              ProcessRunner<String,Failure1,Failure3> runnerb =

​                     new ProcessRunner<String,Failure1,Failure3>();

​              for(int i = 0; i < 3; i++)

​                     runnerb.add(new Processor1b());

​              try {

​                     System.out.println(runnerb.processAll());

​              } catch(Failure1 e) {

​                     System.out.println(e);

​              } catch(Failure3 e) {

​                     System.out.println(e);

​              }

​              ProcessRunner<Integer,Failure2,Failure3> runner2 =

​                     new ProcessRunner<Integer,Failure2,Failure3>();

​              for(int i = 0; i < 3; i++)

​                     runner2.add(new Processor2());

​              try {

​                     System.out.println(runner2.processAll());

​              } catch(Failure2 e) {

​                     System.out.println(e);

​              } catch(Failure3 e) {

​                     System.out.println(e);

​              }

​              ProcessRunner<Integer,Failure2,Failure3> runner2b =

​                     new ProcessRunner<Integer,Failure2,Failure3>();

​              for(int i = 0; i < 3; i++)

​                     runner2b.add(new Processor2b());

​              try {

​                     System.out.println(runner2b.processAll());

​              } catch(Failure2 e) {

​                     System.out.println(e);

​              } catch(Failure3 e) {

​                     System.out.println(e);

​              }

​       }

​       

}      

 

class TimeStampedImp implements TimeStamped {

​       private final long timeStamp;

​       public TimeStampedImp() {

​              timeStamp = new Date().getTime();

​       }

​       public long getStamp() { return timeStamp; }

}

 

interface SerialNumbered { long getSerialNumber(); }

 

class SerialNumberedImp implements SerialNumbered {

​       private static long counter = 1;

​       private final long serialNumber = counter++;

​       public long getSerialNumber() { return serialNumber; }

}

 

 

interface Color { String getColor();  }

 

class Colored implements Color {

​       private String color = "blue";

​       public void setColor(String col) { color = col; }

​       public String getColor() { return color; }

}

 

interface Basic {

​       public void set(String val);

​       public String get();

}

 

class BasicImp implements Basic {

​       private String value;

​       public void set(String val) { value = val; }

​       public String get() { return value; }

}

 

class Mixin extends BasicImp 

implements TimeStamped, SerialNumbered, Color {

​       private TimeStamped timeStamp = new TimeStampedImp();

​       private SerialNumbered serialNumber = new SerialNumberedImp();

​       private Colored color = new Colored();

​       public long getStamp() { return timeStamp.getStamp(); }

​       public long getSerialNumber() { 

​              return serialNumber.getSerialNumber(); 

​       }

​       public String getColor() { return color.getColor(); }

}

 

 

public class Mixins37 {

​       public static void main(String[] args) {

​              Mixin mixin1 = new Mixin(), mixin2 = new Mixin();

​              mixin1.set("test string 1");

​              mixin2.set("test string 2");

​              System.out.println(mixin1.get() + " " + mixin1.getStamp() 

​                     + " " + mixin1.getSerialNumber() + " " + 

​                     mixin1.getColor());

​              System.out.println(mixin2.get() + " " + mixin2.getStamp() 

​                     + " " + mixin2.getSerialNumber() + " " + 

​                     mixin2.getColor());

​       }

}

 

class BasicCoffee {

​       private static long counter = 0;

​      private final long id = counter++;

​       private String value;

​       public void set(String val) { value = val; }

​       public String get() { return value; }

​      public String toString() {

​                  return getClass().getSimpleName() + " " + id;

​      }

}

 

class Decorator extends BasicCoffee {

​       protected BasicCoffee basicCoffee;

​       public Decorator(BasicCoffee basicCoffee) { 

​              this.basicCoffee = basicCoffee; 

​       }

​       public void set(String val) { basicCoffee.set(val); }

​       public String get() { return basicCoffee.get(); }

}

 

class SteamedMilk extends Decorator {

​       private final String steamedMilk = "steamedMilk";

​       public SteamedMilk(BasicCoffee basicCoffee) {

​              super(basicCoffee);

​       }

​       public String getSteamedMilk() { return steamedMilk; }

}

 

class Foam extends Decorator {

​       private final String foam = "foam";

​       public Foam(BasicCoffee basicCoffee) {

​              super(basicCoffee);

​       }

​       public String getFoam() { return foam; }

}

 

class Chocolate extends Decorator {

​       private final String chocolate = "chocolate";

​       public Chocolate(BasicCoffee basicCoffee) {

​              super(basicCoffee);

​       }

​       public String getChocolate() { return chocolate; }

}

 

class Caramel extends Decorator {

​       private final String caramel = "caramel";

​       public Caramel(BasicCoffee basicCoffee) {

​              super(basicCoffee);

​       }

​       public String getCaramel() { return caramel; }

}

 

class WhippedCream extends Decorator {

​       private final String whippedCream = "whippedCream";

​       public WhippedCream(BasicCoffee basicCoffee) {

​              super(basicCoffee);

​       }

​       public String getWhippedCream() { return whippedCream; }

}

 

public class CoffeeDecoration38 {

​       public static void main(String[] args) {

​              SteamedMilk sm = new SteamedMilk(new BasicCoffee());

​              SteamedMilk sm2 = new SteamedMilk(

​                     new Foam(new BasicCoffee()));

​              Chocolate c = new Chocolate(new BasicCoffee());

​              WhippedCream wc = new WhippedCream(new Caramel(

​                     new Chocolate(new Foam(new SteamedMilk(

​                     new BasicCoffee())))));

​       }

}

 

class MixinProxy implements InvocationHandler {

​       Map<String,Object> delegatesByMethod;

​       public MixinProxy(TwoTuple<Object,Class<?>>... pairs) {

​              delegatesByMethod = new HashMap<String,Object>();

​              for(TwoTuple<Object,Class<?>> pair : pairs) {

​                     for(Method method : pair.second.getMethods()) {

​                            String methodName = method.getName();

​                                                                                  if(!delegatesByMethod.containsKey(methodName))

​                                   delegatesByMethod.put(methodName, pair.first);

​                     }

​              }

​       }

​       public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {

​              String methodName = method.getName();

​              Object delegate = delegatesByMethod.get(methodName);

​              return method.invoke(delegate, args);

​       }

​       @SuppressWarnings("unchecked")

​       public static Object newInstance(TwoTuple... pairs) {

​              Class[] interfaces = new Class[pairs.length];

​              for(int i = 0; i < pairs.length; i++) {

​                     interfaces[i] = (Class)pairs[i].second;

​              }

​              ClassLoader cl = pairs[0].first.getClass().getClassLoader();

​              return Proxy.newProxyInstance(cl, interfaces, new MixinProxy(pairs));

​       }

}

 

public class DynamicProxyMixin39 {

​       public static void main(String[] args) {

​              Object mixin = MixinProxy.newInstance(tuple(new BasicImp(), Basic.class), 

​                     tuple(new TimeStampedImp(), TimeStamped.class),

​                     tuple(new SerialNumberedImp(), SerialNumbered.class),

​                     tuple(new Colored(), Color.class));

​              Basic b = (Basic)mixin;

​              TimeStamped t = (TimeStamped)mixin;

​              SerialNumbered s = (SerialNumbered)mixin;

​              b.set("Hello");

​              Color c = (Color)mixin;

​              System.out.println(b.get());

​              System.out.println(t.getStamp());

​              System.out.println(s.getSerialNumber());

​              System.out.println(c.getColor());         

​       }

 

public class Apply40 {

​       public static <T,S extends Iterable<? extends T>> void apply(S seq, Method f, Object... args) {

​              try {

​                     for(T t : seq)

​                            f.invoke(t, args);

​              } catch(Exception e) {

​                                         throw new RuntimeException(e);

​              }

​       }

}

 

class FilledList<T> extends ArrayList<T> { 

​       public FilledList(Class<? extends T> type, int size) {

​              try {

​                     for(int i = 0; i < size; i++)

​                                                       add(type.newInstance());

​              } catch(Exception e) {

​                     throw new RuntimeException(e);

​              }

​       }

}

 

class ApplyTest40 {

​       public static void main(String[] args) throws Exception {

​                           List<Pet> pets = Pets.arrayList(10);

​              print("Random pets: " + pets);

​                           Apply40.apply(pets, Pet.class.getMethod("speak"));

​                           Apply40.apply(new FilledList<Pet>(Dog.class, 5), Pet.class.getMethod("speak"));

​       }

}

 

interface Addable<T> { void add(T t); }

 

public class Fill41 {

​             public static <T> void fill(Addable<T> addable, 

​       Class<? extends T> classToken, int size) {

​              for(int i = 0; i < size; i++) 

​                     try {

​                            addable.add(classToken.newInstance());

​                     } catch(Exception e) {

​                            throw new RuntimeException(e);

​                     }

​       }

​             public static <T> void fill(Addable<T> addable, 

​       Generator<T> generator, int size) {

​              for(int i = 0; i < size; i++)

​                     addable.add(generator.next());

​       }

}

 

  class AddableCollectionAdapter<T> implements Addable<T> {

​       private Collection<T> c;

​       public AddableCollectionAdapter(Collection<T> c) {

​              this.c = c;

​       }

​       public void add(T item) { c.add(item); }

}

 

 class Adapter {

​       public static <T> 

​       Addable<T> collectionAdapter(Collection<T> c) {

​              return new AddableCollectionAdapter<T>(c);          

​       }

}

 

  class AddableSimpleQueue<T>

extends SimpleQueue<T> implements Addable<T> {

​       public void add(T item) { super.add(item); }

}

 

class Fill41Test {

​       public static void main(String[] args) {

​                           List<Pet> pets = new ArrayList<Pet>();

​              Fill41.fill(

​                     new AddableCollectionAdapter<Pet>(pets),

​                     Pet.class, 3);

​                           Fill41.fill(Adapter.collectionAdapter(pets), Manx.class, 2);

​              for(Pet p : pets) print(p);

​              print("---------------");

​                           AddableSimpleQueue<Pet> petQueue = 

​                     new AddableSimpleQueue<Pet>();

​              Fill41.fill(petQueue, Pug.class, 4);

​              Fill41.fill(petQueue, Gerbil.class, 1);

​              for(Pet p : petQueue) print(p);            

​       }

}

 

 interface Combiner<T> { T combine(T x, T y); }

interface UnaryFunction<R,T> { R function(T x); }

interface Collector<T> extends UnaryFunction<T,T> {

​       T result();  }

 

class Food {

​       private String foodName = "";

​       public Food() { foodName = ""; } 

​       public Food(String name) { foodName = name; }

​       public void set(String name) { foodName = name; }

​       public String get() { return foodName; }

​       public void eat() { foodName = ""; }

​       public String toString() { return "Food: " + foodName; }

}

 

class Drink {

​       private String drinkName = "";

​       public Drink() { drinkName= ""; }

​       public Drink(String name) { drinkName = name; }

​       public void set(String name) { drinkName = name; }

​       public String get() { return drinkName; }

​       public void eat() { drinkName = ""; }

​       public String toString() { return "Drink: " + drinkName; } 

}

 

public class Functional42 {

​                   public static <T> T

​       reduce(Iterable<T> seq, Combiner<T> combiner) {

​              Iterator<T> it = seq.iterator();

​              if(it.hasNext()) {

​                     T result = it.next();

​                     while(it.hasNext())

​                            result = combiner.combine(result, it.next());

​                     return result;

​              }

​                           return null;   } 

​                               public static <T> Collector<T>

​       forEach(Iterable<T> seq, Collector<T> func) {

​              for(T t : seq) func.function(t);

​              return func;

​       }      

​       static class MealMaker implements Combiner<Food> {

​              public Food combine(Food f1, Food f2) {

​                     return new Food(f1.get() + " " + f2.get());

​              }

​       }

​       static class DrinkMaker implements Combiner<Drink> {

​              public Drink combine(Drink d1, Drink d2) {

​                     return new Drink(d1.get() + " " + d2.get());

​              }

​       }

​       static class CookedMeal

​       implements Collector<Food> {

​              private Food f = new Food("");

​              public Food function(Food x) {

​                     f = new Food(f.get() + " " + x.get());

​                     return f;

​              }

​              public Food result() { return new Food("cooked " + f.get()); }

​       }      

​       public static void main(String[] args) {

​              List<Food> lf = Arrays.asList(new Food("bread"),

​                     new Food("ham"), new Food("cheese"));

​              Food meal = reduce(lf, new MealMaker());

​              print(meal);

​              List<Drink> ld = Arrays.asList(new Drink("water"),

​                     new Drink("orange juice"), new Drink("lemon"));

​              Drink drink = reduce(ld, new DrinkMaker());

​              print(drink);

​              print(forEach(lf, new CookedMeal()).result());

 

​              

​       }

}