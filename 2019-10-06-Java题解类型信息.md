---
title: Java题解类型信息
date: 2019-10-06 10:00:00
tags: 题解
 
---

## 第十四章 类型信息

class Toy {

​                         Toy(int i) {}

}

 

class FancyToy extends Toy 

​       implements HasBatteries, Waterproof, Shoots {

​              FancyToy() { super(1); }

}

 

public class ToyTest1 {

​       static void printInfo(Class cc) {

​              print("Class name: " + cc.getName() +

​                     " is interface? [" + cc.isInterface() + "]");

​              print("Simple name: " + cc.getSimpleName());

​              print("Canonical name: " + cc.getCanonicalName());

​       }

​       public static void main(String[] args) {

​              Class c = null;

​              try {

​                     c = Class.forName("typeinfo.toys.FancyToy");

​              } catch(ClassNotFoundException e) {

​                     print("Can't find FancyToy");

​                     System.exit(1);

​              }

​              printInfo(c);

​              for(Class face : c.getInterfaces())

​                     printInfo(face);

​              Class up = c.getSuperclass();

​              Object obj = null;

​              try {

​                                                             obj = up.newInstance();

​              } catch(InstantiationException e) {

​                     print("Cannot instantiate");

​                     System.exit(1);

​              } catch(IllegalAccessException i) {

​                     print("Cannot access");

​                     System.exit(1);

​              }

​              printInfo(obj.getClass());

​       }

}

 

 

interface HasBatteries {}

interface Waterproof {}

interface Shoots {}

interface Flies {}

 

class Toy {

​                   Toy() {}

​       Toy(int i) {}

}

 

class FancyToy extends Toy 

​       implements HasBatteries, Waterproof, Shoots, Flies {

​              FancyToy() { super(1); }

}

 

public class ToyTest2 {

​       static void printInfo(Class cc) {

​              print("Class name: " + cc.getName() +

​                     " is interface? [" + cc.isInterface() + "]");

​              print("Simple name: " + cc.getSimpleName());

​              print("Canonical name: " + cc.getCanonicalName());

​       }

​       public static void main(String[] args) {

​              Class c = null;

​              try {

​                     c = Class.forName("typeinfo.toys.FancyToy");

​              } catch(ClassNotFoundException e) {

​                     print("Can't find FancyToy");

​                     System.exit(1);

​              }

​              printInfo(c);

​              for(Class face : c.getInterfaces())

​                     printInfo(face);

​              Class up = c.getSuperclass();

​              Object obj = null;

​              try {

​                                         obj = up.newInstance();

​              } catch(InstantiationException e) {

​                     print("Cannot instantiate");

​                     System.exit(1);

​              } catch(IllegalAccessException i) {

​                     print("Cannot access");

​                     System.exit(1);

​              }      

​              printInfo(obj.getClass());

​       }

}

 

abstract class Shape {

​       void draw() { System.out.println(this + ".draw()"); }

​       abstract public String toString();

}

 

class Circle extends Shape {

​       public String toString() { return "Circle"; }

}

 

class Square extends Shape {

​       public String toString() { return "Square"; }

}

 

class Triangle extends Shape {

​       public String toString() { return "Triangle"; }

}

 

class Rhomboid extends Shape {

​       public String toString() { return "Rhomboid"; }

}

 

public class Shapes3 {

​       public static void main(String[] args) {

​                           List<Shape> shapeList = Arrays.asList(

​                     new Circle(), new Square(), new Triangle(), new Rhomboid()

​              );

​                           for(Shape shape : shapeList)

​                     shape.draw();

​              Rhomboid r = new Rhomboid();

​              ((Shape)r).draw();

​                                 }

}

 

abstract class Shape {

​       void draw() { System.out.println(this + ".draw()"); }

​       abstract public String toString();

}

 

class Circle extends Shape {

​       public String toString() { return "Circle"; }

}

 

class Square extends Shape {

​       public String toString() { return "Square"; }

}

 

class Triangle extends Shape {

​       public String toString() { return "Triangle"; }

}

 

class Rhomboid extends Shape {

​       public String toString() { return "Rhomboid"; }

}

 

public class Shapes4 {

​       public static void main(String[] args) {

​                           List<Shape> shapeList = Arrays.asList(

​                     new Circle(), new Square(), new Triangle(), new Rhomboid()

​              );

​                           for(Shape shape : shapeList)

​                     shape.draw();

​              Rhomboid r = new Rhomboid();

​                           Shape s = (Shape)r;

​              s.draw();

​                           if(s instanceof Circle) 

​                     ((Circle)s).draw();

​              else if(!(s instanceof Circle))

​                     System.out.println("(Shape)r is not a Circle");           

​       }

}

 

abstract class Shape {

​       void draw() { System.out.println(this + ".draw()"); }

​       abstract public String toString();

}

 

class Circle extends Shape {

​       public String toString() { return "Circle"; }

}

 

class Square extends Shape {

​       public String toString() { return "Square"; }

}

 

class Triangle extends Shape {

​       public String toString() { return "Triangle"; }

}

 

public class Shapes5 {

​       public static void rotate(Shape s) {

​                     if(!(s instanceof Circle))

​                            System.out.println(s + " rotate");

​              }                    

​       public static void main(String[] args) {

​                           List<Shape> shapeList = Arrays.asList(

​                     new Circle(), new Square(), new Triangle(), new Rhomboid()

​              );

​                           for(Shape shape : shapeList)

​                     shape.draw(); 

​              System.out.println();     

​              for(Shape shape : shapeList)

​                     rotate(shape);

​       }

}

 

abstract class Shape {

​       void draw() { System.out.println(this + ".draw()"); }

​       abstract public String toString();

}

 

class Circle extends Shape {

​       boolean flag = false;

​       public String toString() { 

​              return (flag ? "H" : "Unh") + "ighlighted " + "Circle"; 

​       }

}

 

class Square extends Shape {

​       boolean flag = false;

​       public String toString() { 

​              return (flag ? "H" : "Unh") + "ighlighted " + "Square"; 

​       }

}

 

class Triangle extends Shape {

​       boolean flag = false;

​       public String toString() { 

​              return (flag ? "H" : "Unh") + "ighlighted " + "Triangle"; 

​       }

}

 

public class Shapes6 {

​       public static void setFlag(Shape s) {

​                     if(s instanceof Triangle)

​                            ((Triangle)s).flag = true; 

​              }                    

​       public static void main(String[] args) {

​                           List<Shape> shapeList = Arrays.asList(

​                     new Circle(), new Square(), new Triangle()

​              );

​              for(Shape shape : shapeList) {

​                     setFlag(shape);

​                     System.out.println(shape);

​              }

​       }

}

 

class Candy {

​       static { print("Loading Candy"); }

}

 

class Gum {

​       static { print("Loading Gum"); } 

}

 

class Cookie {

​       static { print("Loading Cookie"); }

}

 

public class SweetShop7 {

​       public static void main(String[] args) {

​              if(args.length < 1) {

​                     System.out.println("Usage: sweetName");

​                     System.exit(0);

​              }

​              Class c = null;

​              try {

​                     c = Class.forName(args[0]);

​                     print("Enjoy your " + args[0]);

​              } catch(ClassNotFoundException e) {

​                     print("Couldn't find " + args[0]);

​              }

​       }

}

 

 

 

 

  class A {}

 

class B extends A {}

 

class C extends B {}

 

public class Ex8 {

​       public static void Hierarchy(Object o) {

​              if(o.getClass().getSuperclass() != null) {             

​                     System.out.println(o.getClass() + " is a subclass of " + 

​                            o.getClass().getSuperclass()); 

​                     try {

​                            Hierarchy(o.getClass().getSuperclass().newInstance());

​                     } catch(InstantiationException e) {

​                            System.out.println("Unable to instantiate obj");

​                     } catch(IllegalAccessException e) {

​                            System.out.println("Unable to access");

​                     }

​              } 

​       }             

​       public static void main(String[] args) {

​              Hierarchy(new C());

​       }

}

  class A { int i; String s; }

 

class B extends A { int j; float f; }

 

class C extends B { int k; B b;}

 

public class Ex9 {

​       public static void Hierarchy(Object o) {

​              Object[] fields = o.getClass().getDeclaredFields();

​              if(fields.length == 0)

​                     System.out.println(o.getClass() + " has no fields");

​              if(fields.length > 0) {

​                     System.out.println("Field(s) of " + o.getClass() + ":");

​                     for(Object obj : fields) 

​                            System.out.println(" " + obj);

​              }

​              if(o.getClass().getSuperclass() != null) {                    

​                     System.out.println(o.getClass() + " is a subclass of " + 

​                            o.getClass().getSuperclass()); 

​                     try {

​                            Hierarchy(o.getClass().getSuperclass().newInstance());

​                     } catch(InstantiationException e) {

​                            System.out.println("Unabloe to instantiate obj");

​                     } catch(IllegalAccessException e) {

​                            System.out.println("Unable to access");

​                     }

​              } 

​       }             

​       public static void main(String[] args) {

​              Hierarchy(new C());

​       }

}

 

 

 

 

  public class Ex10 {     

​       public static void main(String[] args) {

​              char[] c = new char[10];

​                           System.out.println("Superclass of char[] c: " + 

​                     c.getClass().getSuperclass());

​              System.out.println("char[] c instanceof Object: " + 

​                     (c instanceof Object));

​       }

}

​             package typeinfo.pets;

​       public class Gerbil extends Rodent {

​              public Gerbil(String name) { super(name); }

​              public Gerbil() { super(); }

​       } 

​             "typeinfo.pets.Gerbil" 

​             if(pet instanceof Gerbil) counter.count("Gerbil"); 

​             Gerbil.class 

public class Ex11 {

​       public static void main(String[] args) {

​              TypeCounter counter = new TypeCounter(Pet.class);

​              for(Pet pet : Pets.createArray(20)) {

​                     printnb(pet.getClass().getSimpleName() + " ");

​                     counter.count(pet);

​              }      

​              print();

​              print(counter);

​       }

}

public class Ex12 {

​       public static void main(String[] args) {

​              TypeCounter counter = new TypeCounter(Coffee.class);

​              for(Coffee coffee : new CoffeeGenerator(20)) {

​                     printnb(coffee.getClass().getSimpleName() + " ");

​                     counter.count(coffee);

​              }

​              print();

​              print(counter);

​       }

}

 

public class Ex13 {

​       public static void main(String[] args) {

​              TypeCounter counter = new TypeCounter(Part.class);

​              List<Part> partList = new ArrayList<Part>();

​              for(int i = 0; i < 20; i++)              

​                     partList.add(Part.createRandom());

​              for(Part part : partList) {

​                     printnb(part.getClass().getSimpleName() + " ");

​                     counter.count(part);

​              }

​              print();

​              print(counter);

​       }

}

 

class Part {

​       public String toString() {

​              return getClass().getSimpleName();

​       }

​       static List<Class<? extends Part>> partClasses = 

​              new ArrayList<Class<? extends Part>>();

​       static {

​                                        partClasses.add(FuelFilter.class);

​              partClasses.add(AirFilter.class);

​              partClasses.add(CabinAirFilter.class);

​              partClasses.add(OilFilter.class);

​              partClasses.add(FanBelt.class);

​              partClasses.add(PowerSteeringBelt.class);

​              partClasses.add(GeneratorBelt.class);

​       }

​       private static Random rand = new Random();

​       public static Part createRandom() {

​              int n = rand.nextInt(partClasses.size());

​              try {

​                     return partClasses.get(n).newInstance();

​              } catch(InstantiationException e) {

​                     throw new RuntimeException(e);

​              } catch(IllegalAccessException e) {

​                     throw new RuntimeException(e);

​              }

​       } 

}

 

class Filter extends Part {}

 

class FuelFilter extends Filter {

​             public static class Factory implements typeinfo.factory.Factory<FuelFilter> {

​              public FuelFilter create() { return new FuelFilter(); }

​       }

}

 

class AirFilter extends Filter {

​       public static class Factory implements typeinfo.factory.Factory<AirFilter> {

​              public AirFilter create() { return new AirFilter(); }

​       }

}

 

class CabinAirFilter extends Filter {

​       public static class Factory implements typeinfo.factory.Factory<CabinAirFilter> {

​              public CabinAirFilter create() { return new CabinAirFilter(); }

​       }

}

 

class OilFilter extends Filter {

​       public static class Factory implements typeinfo.factory.Factory<OilFilter> {

​              public OilFilter create() { return new OilFilter(); }

​       }

}

 

class Belt extends Part {}

 

class FanBelt extends Belt {

​       public static class Factory implements typeinfo.factory.Factory<FanBelt> {

​              public FanBelt create() { return new FanBelt(); }

​       }

}

 

class GeneratorBelt extends Belt {

​       public static class Factory implements typeinfo.factory.Factory<GeneratorBelt> {

​              public GeneratorBelt create() { return new GeneratorBelt(); }

​       }

}

 

class PowerSteeringBelt extends Belt {

​       public static class Factory implements typeinfo.factory.Factory<PowerSteeringBelt> {

​              public PowerSteeringBelt create() { return new PowerSteeringBelt(); }

​       }

}

 

public class RegisteredClasses14 {

​       public static void main(String[] args) {

​              for(int i = 0; i < 10; i++)

​                     System.out.println(Part.createRandom());

​       }

}

 

public class RegisteredPetFactories15 {

​       public static void main(String[] args) {

​              for(int i = 0; i < 10; i++)

​                     System.out.println(PetFactory.createRandom());

​       }

}

class Coffee {

​       private static long counter = 0;

​       private final long id = counter++;

​       public String toString() {

​              return getClass().getSimpleName() + " " + id;

​       }

​       static List<Factory<? extends Coffee>> coffeeFactories =

​              new ArrayList<Factory<? extends Coffee>>();

​       static {

​              coffeeFactories.add(new Latte.Factory());

​              coffeeFactories.add(new Mocha.Factory());

​              coffeeFactories.add(new Cappuccino.Factory());

​              coffeeFactories.add(new Americano.Factory());

​              coffeeFactories.add(new Breve.Factory());

​       }

​       private static Random rand = new Random();

​       public static Coffee createRandom() {

​              int n = rand.nextInt(coffeeFactories.size());

​              return coffeeFactories.get(n).create();

​       }

}

 

class Latte extends Coffee {

​       public static class Factory implements typeinfo.factory.Factory<Latte> {

​              public Latte create() { return new Latte(); }

​       }

}

 

class Mocha extends Coffee {

​       public static class Factory implements typeinfo.factory.Factory<Mocha> {

​              public Mocha create() { return new Mocha(); }

​       }

}

 

class Cappuccino extends Coffee {

​       public static class Factory implements typeinfo.factory.Factory<Cappuccino> {

​              public Cappuccino create() { return new Cappuccino(); }

​       }

}

 

class Americano extends Coffee {

​       public static class Factory implements typeinfo.factory.Factory<Americano> {

​              public Americano create() { return new Americano(); }

​       }

}

 

class Breve extends Coffee {

​       public static class Factory implements typeinfo.factory.Factory<Breve> {

​              public Breve create() { return new Breve(); }

​       }

}

 

public class RegisteredCoffeeFactories16 {

​       public static void main(String[] args) {

​              for(int i = 0; i < 15; i++)

​                     System.out.println(Coffee.createRandom());

​       }

}

 

public class ShowMethods17 {

​       private static String usage =

​              "usage:\n" +

​              "ShowMethods qualified.class.name\n" +

​              "To show all methods in class or:\n" +

​              "ShowMethods qualified.class.name word\n" +

​              "To search for methods involving 'word'";

​       private static Pattern p = Pattern.compile("(\\w+\\.)|\\s*final|\\s*native");

​       public static void main(String[] args) {

​              if(args.length < 1) {

​                     print(usage);

​                     System.exit(0);

​              }

​              int lines = 0;

​              try {

​                     Class<?> c = Class.forName(args[0]);

​                     Method[] methods = c.getMethods();

​                     Constructor[] ctors = c.getConstructors();

​                     if(args.length == 1) {

​                            for(Method method : methods) {

​                                   print(p.matcher(method.toString()).replaceAll(""));

​                            }

​                            for(Constructor ctor : ctors)

​                                   print(p.matcher(ctor.toString()).replaceAll(""));

​                            lines = methods.length + ctors.length;

​                     } else {

​                            for(Method method : methods)

​                                   if(method.toString().indexOf(args[1]) != -1) {

​                                          print(p.matcher(method.toString()).replaceAll(""));

​                                          lines++;

​                                   }

​                            for(Constructor ctor : ctors) 

​                                   if(ctor.toString().indexOf(args[1]) != -1) {

​                                          print(p.matcher(ctor.toString()).replaceAll(""));

​                                          lines++;

​                            }

​                     }

​              } catch(ClassNotFoundException e) {

​                     print("No such class: " + e);

​              }

​       }

}

 

class ShowMethods18 {

​       private static String usage =

​              "usage:\n" +

​              "ShowMethods qualified.class.name\n" +

​              "To show all methods in class or:\n" +

​              "ShowMethods qualified.class.name word\n" +

​              "To search for methods involving 'word'";

​       private static Pattern p = Pattern.compile("\\w+\\.");

​       public static void main(String[] args) {

​              if(args.length < 1) {

​                     print(usage);

​                     System.exit(0);

​              }

​              int lines = 0;

​              try {

​                     Class<?> c = Class.forName(args[0]);

​                     Method[] methods = c.getMethods();

​                     Constructor[] ctors = c.getConstructors();

​                     if(args.length == 1) {

​                            for(Method method : methods) {

​                                   print(p.matcher(method.toString()).replaceAll(""));

​                            }

​                            for(Constructor ctor : ctors)

​                                   print(p.matcher(ctor.toString()).replaceAll(""));

​                            lines = methods.length + ctors.length;

​                     } else {

​                            for(Method method : methods)

​                                   if(method.toString().indexOf(args[1]) != -1) {

​                                          print(p.matcher(method.toString()).replaceAll(""));

​                                          lines++;

​                                   }

​                            for(Constructor ctor : ctors) 

​                                   if(ctor.toString().indexOf(args[1]) != -1) {

​                                          print(p.matcher(ctor.toString()).replaceAll(""));

​                                          lines++;

​                            }

​                     }

​              } catch(ClassNotFoundException e) {

​                     print("No such class: " + e);

​              }

​       }

}

 

interface HasBatteries {}

interface Waterproof {}

interface Shoots {}

 

class Toy {

​       Toy() {

​              print("Creating Toy() object");      

​       }

​       Toy(int i) {

​              print("Creating Toy(" + i + ") object");

​       }

}

 

class FancyToy extends Toy 

​       implements HasBatteries, Waterproof, Shoots {

​              FancyToy() { super(1); }

}

 

public class ToyTest19 {

​       public static void main(String[] args) {

​                           try {

​                     Toy.class.getDeclaredConstructor(int.class).newInstance(1);

​                           } catch(NoSuchMethodException e) {

​                     print("No such method: " + e);

​              } catch(InstantiationException e) {

​                     print("Unable make Toy: " + e);

​              } catch(IllegalAccessException e) {

​                     print("Unable access: " + e);

​              } catch(InvocationTargetException e) {

​                     print("Target invocation problem: " + e);

​              }

​       }

}

 

public class ClassInfo {

​       public static void main(String[] args) {

​              if(args.length < 1) {

​                     println("Usage: name of class");

​                     System.exit(0);

​              }

​              Class<?> c = null;

​              try {

​                     c = Class.forName(args[0]);

​              } catch(ClassNotFoundException e) {

​                     println("No such class: " + e);

​              }

​              println("c: " + c);

​              println("c.getAnnotations(): ");

​              if(c.getAnnotations().length == 0) println("none");

​              for(Annotation a : c.getAnnotations())

​                     println(a);

​              println("c.getCanonicalName(): " + c.getCanonicalName());

​              println("c.getClasses(): ");

​              if(c.getClasses().length == 0) println("none");

​              for(Class cl : c.getClasses())

​                     println(cl);

​              println("c.getClassLoader(): " + c.getClassLoader());

​              println("c.getConstructors(): ");

​              if(c.getConstructors().length == 0) println("none");

​              for(Constructor ctor : c.getConstructors())

​                     println(ctor);

​              println("c.getDeclaredAnnotations(): ");

​              if(c.getDeclaredAnnotations().length == 0) println("none");

​              for(Annotation a : c.getDeclaredAnnotations())

​                     println(a);

​              println("c.getDeclaredClasses(): ");

​              if(c.getDeclaredClasses().length == 0) println("none");

​              for(Class cl : c.getDeclaredClasses())

​                     println(cl);

​              println("c.getDeclaredConstructors(): ");

​              if(c.getDeclaredConstructors().length == 0) println("none");

​              for(Constructor ctor : c.getDeclaredConstructors())

​                     println(ctor);

​              println("c.getDeclaredFields(): ");

​              if(c.getDeclaredFields().length == 0) println("none");

​              for(Field f : c.getDeclaredFields())

​                     println(f);

​              println("c.getDeclaredMethods(): ");

​              if(c.getDeclaredMethods().length == 0) println("none");

​              for(Method m : c.getDeclaredMethods())

​                     println(m);

​              println("c.getDeclaringClass(): " + c.getDeclaringClass());

​              println("c.getEnclosingConstructor(): " + c.getEnclosingConstructor());

​              println("c.getEnclosingMethod(): " + c.getEnclosingMethod());

​              println("c.getEnumConstants(): " + c.getEnumConstants());

​              println("c.getDeclaredFields(): ");

​              if(c.getFields().length == 0) println("none");

​              for(Field f : c.getFields())

​                     println(f);

​              println("c.getGenericInterfaces(): ");

​              if(c.getGenericInterfaces().length == 0) println("none");

​              for(Type t : c.getGenericInterfaces())

​                     println(t);

​              println("c.getGenericSuperclass(): " + c.getGenericSuperclass());

​              println("c.getInterfaces(): ");

​              if(c.getInterfaces().length == 0) println("none");

​              for(Class i : c.getInterfaces())

​                     println(i);

​              println("c.getMethods(): ");

​              if(c.getMethods().length == 0) println("none");

​              for(Method m : c.getMethods())

​                     println(m);

​              println("c.getModifiers(): " + c.getModifiers());

​              println("c.getName(): " + c.getName());

​              println("c.getPackage(): " + c.getPackage());

​              println("c.getProtectionDomain(): " + c.getProtectionDomain());

​              print("c.getSigners(): ");

​              if(c.getSigners() == null)

​                     println(c.getSigners());

​              if(c.getSigners() != null) {

​                     println();

​                     if(c.getSigners().length == 0) println("none");

​                     if(c.getSigners().length > 0) {

​                            for(Object s : c.getSigners()) 

​                                   println(s);

​                     }

​              }

​              println("c.getSimpleName(): " + c.getSimpleName());

​              println("c.getSuperclass(): " + c.getSuperclass());

​              println("c.getTypeParameters(): " + c.getTypeParameters());

​              println("c.isAnnotation(): " + c.isAnnotation());

​              println("c.isAnnotationPresent(Documented.class): " + c.isAnnotationPresent(Documented.class));

​              println("c.isAnonymousClass(): " + c.isAnonymousClass());

​              println("c.isArray(): " + c.isArray());

​              println("c.isAssignableFrom(ClassInfo.class): " + c.isAssignableFrom(ClassInfo.class));

​              println("c.isAssignableFrom(Object.class): " + c.isAssignableFrom(Object.class));

​              println("c.isEnum(): " + c.isEnum());

​              println("c.isInstance(Object.class): " + c.isInstance(Object.class));

​              println("c.isInterface(): " + c.isInterface());

​              println("c.isLocalClass(): " + c.isLocalClass());

​              println("c.isMemberClass(): " + c.isMemberClass());

​              println("c.isPrimitive(): " + c.isPrimitive());

​              println("c.isSynthetic(): " + c.isSynthetic());         

​       }

}

 

interface Interface {

​       void doSomething();

​       void somethingElse(String arg);

}

 

class RealObject implements Interface {

​       public void doSomething() { print("doSomething"); }

​       public void somethingElse(String arg) {

​              print("somethingElse " + arg);

​       }

}

 

class SimpleProxy implements Interface {

​       private Interface proxied;

​       private static int doCount = 0;

​       private static int sECount = 0;

​       public SimpleProxy(Interface proxied) {

​              this.proxied = proxied;

​       }

​       public void doSomething() { 

​              long timeIn = new Date().getTime();

​              print("Time called doSomething() " + doCount + ": " + timeIn + " msecs");

​              print("on " + new Date());

​              doCount++;

​              proxied.doSomething();

​              print("Call-return time = " + ((new Date().getTime()) - timeIn) + " msecs");

​       }

​       public void somethingElse(String arg) {

​              long timeIn = new Date().getTime();

​              print("Time called somethingElse() " + sECount + ": " + timeIn + " msecs");

​              print("on " + new Date());

​              sECount++;

​              proxied.somethingElse(arg);

​              print("Call-return time = " + ((new Date().getTime()) - timeIn) + " msecs");

​       }

}

 

class SimpleProxyDemo21 {

​       public static void consumer(Interface iface) {

​              iface.doSomething();

​              iface.somethingElse("bonobo");

​       }

​       public static void main(String[] args) {

​              consumer(new RealObject());

​              print();

​              consumer(new SimpleProxy(new RealObject()));

​              print();

​              consumer(new SimpleProxy(new RealObject()));

​              print();

​              consumer(new SimpleProxy(new RealObject()));                                   

​       }

}

 

interface Interface {

​       void doSomething();

​       void somethingElse(String arg);

}

 

class RealObject implements Interface {

​       public void doSomething() { print("doSomething"); }

​       public void somethingElse(String arg) {

​              print("somethingElse " + arg);

​       }

}

 

class SimpleProxy implements Interface {

​       private Interface proxied;

​       private static int doCount = 0;

​       private static int sECount = 0;

​       public SimpleProxy(Interface proxied) {

​              this.proxied = proxied;

​       }

​       public void doSomething() { 

​              long timeIn = new Date().getTime();

​              print("Time called doSomething() " + doCount + ": " + timeIn + " msecs");

​              print("on " + new Date());

​              doCount++;

​              proxied.doSomething();

​              print("Call-return time = " + ((new Date().getTime()) - timeIn) + " msecs");

​       }

​       public void somethingElse(String arg) {

​              long timeIn = new Date().getTime();

​              print("Time called somethingElse() " + sECount + ": " + timeIn + " msecs");

​              print("on " + new Date());

​              sECount++;

​              proxied.somethingElse(arg);

​              print("Call-return time = " + ((new Date().getTime()) - timeIn) + " msecs");

​       }

}

 

class SimpleProxyDemo21 {

​       public static void consumer(Interface iface) {

​              iface.doSomething();

​              iface.somethingElse("bonobo");

​       }

​       public static void main(String[] args) {

​              consumer(new RealObject());

​              print();

​              consumer(new SimpleProxy(new RealObject()));

​              print();

​              consumer(new SimpleProxy(new RealObject()));

​              print();

​              consumer(new SimpleProxy(new RealObject()));                                   

​       }

}

 

class DynamicProxyHandler implements InvocationHandler {

​       private Object proxied;

​       public DynamicProxyHandler(Object proxied) {

​              this.proxied = proxied;

​       }

​       public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {

System.out.println("**** proxy: " + proxy.getClass() +

​                     ", method: " + method + ", args: " + args);

​              if(args != null)

​                     for(Object arg : args)

​                            System.out.println("  " + args);

​              return method.invoke(proxied, args);

​       }

}

 

class SimpleDynamicProxy23 {

​       public static void consumer(Interface iface) {

​              iface.doSomething();

​              iface.somethingElse("bonobo");

​       }

​       public static void main(String[] args) {

​              RealObject real = new RealObject();

​              consumer(real);

​                           Interface proxy = (Interface)Proxy.newProxyInstance(

​                     Interface.class.getClassLoader(),

​                     new Class[]{ Interface.class },

​                     new DynamicProxyHandler(real));

​              consumer(proxy);         

​       }

}

class Part {

​       public String toString() {

​              return getClass().getSimpleName();

​       }

​       static List<Factory<? extends Part>> partFactories = 

​              new ArrayList<Factory<? extends Part>>();

​       static {

​                                        partFactories.add(new FuelFilter.Factory());

​              partFactories.add(new AirFilter.Factory());

​              partFactories.add(new CabinAirFilter.Factory());

​              partFactories.add(new OilFilter.Factory());

​              partFactories.add(new FanBelt.Factory());

​              partFactories.add(new PowerSteeringBelt.Factory());

​              partFactories.add(new GeneratorBelt.Factory());

​              partFactories.add(new NullPart.Factory());

​       }

​       private static Random rand = new Random();

​       public static Part createRandom() {

​              int n = rand.nextInt(partFactories.size());

​              return partFactories.get(n).create();            

​       } 

​       

​       

}

 

class NullPart extends Part implements Null {

​       private NullPart() { super(); } 

​       public static final Part NULL = new NullPart();

​       public static class Factory implements typeinfo.factory.Factory<NullPart> {

​              public NullPart create() { return (NullPart)NULL; }

​       }

​       public String toString() { return "NULL"; }

}

 

class Filter extends Part {}

 

 

class FuelFilter extends Filter {

​             public static class Factory implements typeinfo.factory.Factory<FuelFilter> {

​              public FuelFilter create() { return new FuelFilter(); }

​       }

}

 

class AirFilter extends Filter {

​       public static class Factory implements typeinfo.factory.Factory<AirFilter> {

​              public AirFilter create() { return new AirFilter(); }

​       }

}

 

class CabinAirFilter extends Filter {

​       public static class Factory implements typeinfo.factory.Factory<CabinAirFilter> {

​              public CabinAirFilter create() { return new CabinAirFilter(); }

​       }

}

 

class OilFilter extends Filter {

​       public static class Factory implements typeinfo.factory.Factory<OilFilter> {

​              public OilFilter create() { return new OilFilter(); }

​       }

}

 

class Belt extends Part {}

 

class FanBelt extends Belt {

​       public static class Factory implements typeinfo.factory.Factory<FanBelt> {

​              public FanBelt create() { return new FanBelt(); }

​       }

}

 

class GeneratorBelt extends Belt {

​       public static class Factory implements typeinfo.factory.Factory<GeneratorBelt> {

​              public GeneratorBelt create() { return new GeneratorBelt(); }

​       }

}

 

class PowerSteeringBelt extends Belt {

​       public static class Factory implements typeinfo.factory.Factory<PowerSteeringBelt> {

​              public PowerSteeringBelt create() { return new PowerSteeringBelt(); }

​       }

}

 

public class RegisteredFactories24 {

​       public static void main(String[] args) {

​              for(int i = 0; i < 10; i++)

​                     System.out.println(Part.createRandom());

​       }

}

 

public class Finder25 {

​       public static void main(String[] args) throws Exception {

​              A a = SecretMaker.makeSecret();

​              println("a is of class type: " + a.getClass().getName());

​              for(Method m : a.getClass().getDeclaredMethods()) {

​                     m.setAccessible(true);

​                     m.invoke(a);

​              }

​       }

}

 

class Instrument {

​       void play(Note n) { print("Instrument.play() " + n); }

​       public String toString() { return "Instrument"; }

​       void adjust() { print("Adjusting Instrument"); }

}

 

class Wind extends Instrument {

​       void play(Note n) { print("Wind.play() " + n); }

​       public String toString() { return "Wind"; }

​       void adjust() { print("Adjusting Wind"); }

​       void clearSpitValve() { print("Wind clearing spit valve"); }

}

 

class Percussion extends Instrument {

​       void play(Note n) { print("Percussion.play() " + n); }

​       public String toString() { return "Percussion"; }

​       void adjust() { print("Adjusting Percussion"); } 

}

 

class Stringed extends Instrument {

​       void play(Note n) { print("Stringed.play() " + n); }

​       public String toString() { return "Stringed"; }

​       void adjust() { print("Adjusting Stringed"); } 

}

 

class Keyboard extends Instrument {

​       void play(Note n) { print("Keyboard.play() " + n); }

​       public String toString() { return "Keyboard"; }

​       void adjust() { print("Adjusting Keyboard"); } 

}

 

class Brass extends Wind {

​       void play(Note n) { print("Brass.play() " + n); }

​       public String toString() { return "Brass"; }

​       void adjust() { print("Adjusting Brass"); }

​       void clearSpitValve() { print("Brass clearing spit valve"); }

}

 

class Woodwind extends Wind {

​       void play(Note n) { print("Woodwind.play() " + n); }

​       public String toString() { return "Woodwind"; }

​       void clearSpitValve() { print("Woodwind clearing spit valve"); }

}

 

class Piano extends Keyboard {

​       void play(Note n) { print("Piano.play() " + n); }

​       public String toString() { return "Piano"; }

}

 

public class Music26 {

​                   public static void tune(Instrument i) {

​                           i.play(Note.MIDDLE_C);

​       }

​       public static void tuneAll(Instrument[] e) {

​              for(Instrument i : e)

​                     tune(i);

​       }

​       private static RandomInstrumentGenerator gen = new RandomInstrumentGenerator();    

​       public static void main(String[] args) {

​                           Instrument[] orchestra = new Instrument[20];

​                           for(int i = 0; i < orchestra.length; i++)

​                     orchestra[i] = gen.next();

​              for(Instrument i : orchestra) {

​                     if(i instanceof Wind)                         ((Wind)i).clearSpitValve();

​                     i.adjust();

​              }

​              tuneAll(orchestra);

​       }

}

 

class Instrument {

​       void play(Note n) { print("Instrument.play() " + n); }

​       public String toString() { return "Instrument"; }

​       void adjust() { print("Adjusting Instrument"); }

}

 

class Wind extends Instrument {

​       void play(Note n) { print("Wind.play() " + n); }

​       public String toString() { return "Wind"; }

​       void adjust() { print("Adjusting Wind"); }

​       void clearSpitValve() { print("Wind clearing spit valve"); }

}

 

class Percussion extends Instrument {

​       void play(Note n) { print("Percussion.play() " + n); }

​       public String toString() { return "Percussion"; }

​       void adjust() { print("Adjusting Percussion"); } 

}

 

class Stringed extends Instrument {

​       void play(Note n) { print("Stringed.play() " + n); }

​       public String toString() { return "Stringed"; }

​       void adjust() { print("Adjusting Stringed"); } 

}

 

class Keyboard extends Instrument {

​       void play(Note n) { print("Keyboard.play() " + n); }

​       public String toString() { return "Keyboard"; }

​       void adjust() { print("Adjusting Keyboard"); } 

}

 

class Brass extends Wind {

​       void play(Note n) { print("Brass.play() " + n); }

​       public String toString() { return "Brass"; }

​       void adjust() { print("Adjusting Brass"); }

​       void clearSpitValve() { print("Brass clearing spit valve"); }

}

 

class Woodwind extends Wind {

​       void play(Note n) { print("Woodwind.play() " + n); }

​       public String toString() { return "Woodwind"; }

​       void clearSpitValve() { print("Woodwind clearing spit valve"); }

}

 

class Piano extends Keyboard {

​       void play(Note n) { print("Piano.play() " + n); }

​       public String toString() { return "Piano"; }

}

 

public class Music26 {

​                   public static void tune(Instrument i) {

​                           i.play(Note.MIDDLE_C);

​       }

​       public static void tuneAll(Instrument[] e) {

​              for(Instrument i : e)

​                     tune(i);

​       }

​       private static RandomInstrumentGenerator gen = new RandomInstrumentGenerator();    

​       public static void main(String[] args) {

​                           Instrument[] orchestra = new Instrument[20];

​                           for(int i = 0; i < orchestra.length; i++)

​                     orchestra[i] = gen.next();

​              for(Instrument i : orchestra) {

​                     if(i instanceof Wind)                         ((Wind)i).clearSpitValve();

​                     i.adjust();

​              }

​              tuneAll(orchestra);

​       }

}